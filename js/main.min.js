function loadData(t,e,a,r,n){t?console.log(t):(e.objects.usa.geometries.sort(function(t,e){return t.id<e.id?-1:t.id>e.id?1:0}),a.forEach(function(t){t.years.forEach(function(t){t.death_rate=+t.death_rate,t.deaths=+t.deaths,t.population=+t.population,t.year=parseYear(t.year)})}),r.forEach(function(t){t.years.forEach(function(t){t.median_income=+t.median_income/1e3,t.year=parseYear(t.year)})}),n.forEach(function(t){t.years.forEach(function(t){t.unemployment=+t.unemployment,t.year=parseYear(t.year)})}),dataLoaded=!0,createVis(e,a,r,n))}function createVis(t,e,a,r){choropleth=new Choropleth("choropleth",t,e),choropleth.eventHandler(handler).initVis(),scatterplot=new Scatterplot("scatterplot","median_income",e,a,r),scatterplot.eventHandler(handler).initVis(),yearSlider=new YearSlider("year-slider",[2002,2014]),yearSlider.eventHandler(handler).initVis(),handler.on("question-clicked",this,displaySliderDescription)}function updateFactor(t){dataLoaded&&(options={factor:t,duration:1e3},handler.broadcast({name:"update",options:options}))}function displaySliderDescription(){$("#slider-modal").modal()}function Choropleth(t,e,a){this.parentElem=t,this.topo=e,this.data=a,this.displayData={},this.sizeGroup="medium",this["default"]={duration:1e3}}function EventHandler(){this.listeners={}}function Regression(){this.xSeries=function(t){return t?(this._xSeries=t,this):this._xSeries},this.ySeries=function(t){return t?(this._ySeries=t,this):this._ySeries},this.reduceSum=function(t,e){return t+e},this.coefficients=function(){var t=this,e=1*this._xSeries.reduce(this.reduceSum)/this._xSeries.length,a=1*this._ySeries.reduce(this.reduceSum)/this._ySeries.length,r=this._xSeries.map(function(t){return Math.pow(t-e,2)}).reduce(this.reduceSum),n=this._ySeries.map(function(t){return Math.pow(t-a,2)}).reduce(this.reduceSum),i=this._xSeries.map(function(r,n){return(r-e)*(t._ySeries[n]-a)}).reduce(this.reduceSum),o=i/r,s=a-e*o,d=Math.pow(i,2)/(r*n);return[o,s,d]}}function Scatterplot(t,e,a,r,n){this.parentElem=t,this.data={death_rate:{data:a,name:"Deaths Per 100,000",format:formatIdentity,domain:[d3.min(a,function(t){return d3.min(t.years,function(t){return t.death_rate})}),d3.max(a,function(t){return d3.max(t.years,function(t){return t.death_rate})})]},median_income:{data:r,name:"Median Income (1000s)",shortName:"Median Income",format:formatCurrency,domain:[d3.min(r,function(t){return d3.min(t.years,function(t){return t.median_income})}),d3.max(r,function(t){return d3.max(t.years,function(t){return t.median_income})})]},unemployment:{data:n,name:"Unemployment Rate",shortName:"Unemployment Rate",format:formatPercent,domain:[d3.min(n,function(t){return d3.min(t.years,function(t){return t.unemployment})}),d3.max(n,function(t){return d3.max(t.years,function(t){return t.unemployment})})]}},this.factor=e,this.factorYear=parseYear("2014"),this.deathRateYear=parseYear("2014"),this.displayData={},this.regression=new Regression,this.sizeGroup="medium",this["default"]={duration:1e3}}function loadStackedArea(){var t={top:10,right:100,bottom:30,left:100},e=parseInt(d3.select("#treemap-area").style("width"))-t.left-t.right,a=.55*e-t.top-t.bottom,r=d3.time.format("%Y").parse,n=(d3.format(".0%"),d3.time.scale().range([0,e])),i=d3.scale.linear().range([a,0]),o=d3.scale.linear().domain([0,21e5]).range([a,0]),s=d3.scale.category20(),d=d3.svg.axis().scale(n).orient("bottom"),l=d3.svg.axis().orient("left").scale(o).tickFormat(d3.format(",.0f")),h=d3.svg.area().x(function(t){return n(t.date)}).y0(function(t){return i(t.y0)}).y1(function(t){return i(t.y0+t.y)}),c=d3.layout.stack().values(function(t){return t.values}),p=d3.select("#tree-title");p.selectAll("*").remove(),p.append("h3").text("Admission to Drug Treatment Programs by Subtance and Year");var u=d3.select("#treemap-area");u.selectAll("*").remove();var g=d3.select("#treemap-area").append("svg").attr("class","legend").attr("width",e+t.left+t.right).attr("height",a/9).attr("transform","translate("+t.left+",0)"),u=d3.select("#treemap-area").append("svg").attr("width",e+t.left+t.right).attr("height",a+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");d3.tsv("data/treatment2003_2013.tsv",function(i,o){if(i)throw i;s.domain(d3.keys(o[0]).filter(function(t){return"date"!==t})),o.forEach(function(t){t.date=r(t.date)});var p=c(s.domain().map(function(t){return{name:t,values:o.map(function(e){return{date:e.date,y:e[t]/21e5}})}}));n.domain(d3.extent(o,function(t){return t.date}));var m=g.selectAll("g").data(p).enter().append("svg:g").attr("class","legend").attr("transform","translate("+t.left+",0)");m.append("svg:rect").attr("x",function(t,a){return a*(.9*e)/p.length+25}).attr("y",10).attr("width",10).attr("height",10).style("fill",function(t){return s(t.name)}),m.append("svg:text").attr("x",function(t,a){return a*(.9*e)/p.length+30}).attr("y",30).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name});var y=u.selectAll(".browser").data(p).enter().append("g").attr("class","browser");y.append("path").attr("class","area").attr("d",function(t){return h(t.values)}).style("fill",function(t){return s(t.name)}).on("mouseover",f.show).on("mouseout",f.hide),y.call(f),u.append("g").attr("class","x axis").attr("transform","translate(0,"+a+")").call(d),u.append("g").attr("class","y axis").call(l)});var f=d3.tip().attr("class","d3-tip").html(function(t){function e(t){n="<tr><td>Year</td><td>Admissions to Treatment</td>";for(var e=0;e<r.length;e++)n+="<tr><td>"+t[e].date.getFullYear()+"</td><td>"+parseInt(21e5*t[e].y)+"</td></tr>";return n}var a=t.name.replace("_"," "),r=t.values,n="<table><th>Substance Type : "+a+"</th>"+e(r)+"</table>";return n})}function changeToOther(){var t=d3.select("#treemap-area");t.selectAll("*").remove();var e=d3.select("#tree-title");e.selectAll("*").remove(),change?(loadStackedArea(),change=!1):(loadTreemap(),change=!0)}function loadTreemap(){var t,e,r=0,n={top:25,right:100,bottom:30,left:100},i=parseInt(d3.select("#treemap-area").style("width"))-n.left-n.right,o=.66*i-n.top-n.bottom,s=d3.scale.linear().range([0,i]),d=d3.scale.linear().range([0,o]),l=d3.scale.category20(),h=d3.layout.treemap().round(!1).size([i,o]).sticky(!0).value(function(t){return t.size[r]}),c=d3.select("#tree-title");c.selectAll("*").remove(),c.append("h3").text("Proportional Admission to Drug Treatment Programs by Subtance and Year");var p=d3.select("#treemap-area");p.select("*").remove();var u=d3.select("#treemap-area").append("svg").attr("class","slider").attr("width",i).attr("height",o/9).attr("transform","translate("+n.left+","+n.top+")"),g=d3.select("#treemap-area").append("svg").attr("class","legend").attr("width",.9*i).attr("height",o/9).attr("transform","translate("+n.left+",0)");p=d3.select("#treemap-area").append("svg").attr("class","chart").attr("width",i).attr("height",o).attr("transform","translate("+n.left+","+n.top+")"),d3.json("data/betterTreeMapData.json",function(c){function f(t){a=[];for(var e=0;e<t.length;e++)a[e]=t[e].name;return a}function m(){value=Math.round(k.extent()[0]);if(d3.event.sourceEvent&&(value=Math.round(b.invert(d3.mouse(this)[0]-n.left)),console.log(value),k.extent([value,value])),value>2002&&value<2014){r=value-2003;var a=function(t){return t.size[r]};h.value(a).nodes(t),y(e)}Y.attr("cx",b(value))}function y(t){var a=i/t.dx,r=o/t.dy;s.domain([t.x,t.x+t.dx]),d.domain([t.y,t.y+t.dy]);var n=p.selectAll("g.cell").transition().duration(d3.event.altKey?7500:750).attr("transform",function(t){return"translate("+s(t.x)+","+d(t.y)+")"});n.select("rect").attr("width",function(t){return a*t.dx-1}).attr("height",function(t){return r*t.dy-1}),n.select("text").attr("x",function(t){return a*t.dx/2}).attr("y",function(t){return r*t.dy/2}).style("opacity",function(t){return a*t.dx>t.w?1:0}),e=t,"brush"!=d3.event.type&&d3.event.stopPropagation()}e=t=c;var x=h.nodes(t).filter(function(t){return!t.children}),v=p.selectAll("g").data(x).enter().append("svg:g").attr("class","cell").attr("transform",function(t){return"translate("+t.x+","+ +t.y+")"}).on("click",function(a){return y(e==a.parent?t:a.parent)});v.append("svg:rect").attr("width",function(t){return t.dx-1}).attr("height",function(t){return t.dy-1}).style("fill",function(t){return l(t.parent.name)}),v.append("svg:text").attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),t.dx>t.w?1:0}),d3.select(window).on("click",function(){y(t)});var S=g.selectAll("g").data(f(e.children)).enter().append("svg:g").attr("class","legend").attr("transform","translate("+n.left+",0)");S.append("svg:rect").attr("x",function(t,a){return a*(.8*i)/f(e.children).length+25}).attr("y",10).attr("width",10).attr("height",10).style("fill",function(t){return l(t)}),S.append("svg:text").attr("x",function(t,a){return a*(.8*i)/f(e.children).length+30}).attr("y",30).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.replace("_"," ")});var b=d3.scale.linear().domain([2003,2013]).range([0,i-n.left-n.right]).clamp(!0),k=d3.svg.brush().x(b).extent([0,0]).on("brush",m);u.append("rect").attr("class","slider_background").attr("height",4).attr("width",i-n.left-n.right).attr("transform","translate("+n.left+","+n.top+")"),u.append("g").attr("class","x axis").attr("transform","translate("+n.left+","+n.top+")").call(d3.svg.axis().scale(b).orient("bottom").tickFormat(function(t){return+t}).tickSize(0).tickPadding(12)).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");var w=u.append("g").attr("class","slider").call(k);w.select(".background").attr("height",100);var Y=w.append("circle").attr("class","handle").attr("transform","translate("+n.left+","+n.top+")").attr("r",9);w.call(k.event).transition().duration(750).call(k.extent([2013,2013])).call(k.event)})}function YearSlider(t,e){this.parentElem=t,this.range=e,this.years=d3.range(e[0],e[1]+1),this.topYear=e[1],this.bottomYear=e[1],this.colors={markers:{top:{hover:"#756BB1",normal:"#54278F"},bottom:{hover:"#6CD16C",normal:"#23A923"}}}}var formatYear=d3.time.format("%Y"),parseYear=formatYear.parse,formatPercent=d3.format("%"),formatCurrency=d3.format("$"),formatIdentity=function(t){return t};colorbrewer.Purples[6].unshift("#ffffff");var colors=d3.scale.quantile().range(colorbrewer.Purples[6]),dataLoaded=!1;d3_queue.queue().defer(d3.json,"data/topo_usa.json").defer(d3.json,"data/state_deaths.json").defer(d3.json,"data/state_income.json").defer(d3.json,"data/state_unemployment.json").await(loadData);var handler=new EventHandler;d3.select(window).on("resize",function(){handler.broadcast({name:"resize"})}),Choropleth.prototype.eventHandler=function(t){return t?(this._eventHandler=t,this._eventHandler.on("update",this,this.handleUpdate),this._eventHandler.on("resize",this,this.handleResize),this._eventHandler.on("mouseoverState",this,this.drawHighlight),this._eventHandler.on("mouseoutState",this,this.removeHighlight),this):this._eventHandler},Choropleth.prototype.initVis=function(){var t=this;return t.margin={top:40,right:20,bottom:20,left:20},t.keyHeight=80,t.keyRectHeight=20,t.svg=d3.select("#"+t.parentElem).append("svg").classed("us-map",!0),t.graph=t.svg.append("g"),t.key=t.svg.append("g").classed("key",!0),t.keyTitle=t.key.append("text").text("Deaths Per 100,000").classed("key-title",!0).attr("text-anchor","middle"),t.projection=d3.geo.albersUsa(),t.path=d3.geo.path().projection(t.projection),t.resize(),t},Choropleth.prototype.resize=function(){var t=this;return t.width=parseInt(d3.select("#"+t.parentElem).style("width"))-t.margin.left-t.margin.right,t.height=.8*t.width-t.margin.top-t.margin.bottom,t.sizeGroup=t.width>468?"medium":"small",t.svg.attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom+t.keyHeight),t.key.attr("transform","translate(0,10)"),t.keyTitle.attr("x",t.width/2).attr("y",10),t.graph.attr("transform","translate("+t.margin.left+","+t.margin.top+")"),t.keyWidth=Math.floor(1/6*t.width),t.projection.scale(1.35*t.width).translate([t.width/2,t.height/2]),t.update({duration:0}),t},Choropleth.prototype.keyLabelOffset=function(){return"medium"==this.sizeGroup?55:50},Choropleth.prototype.fontSize=function(){return"medium"==this.sizeGroup?"14px":"12px"},Choropleth.prototype.wrangleData=function(t){var e=this;t&&t.years?e.deathRateYear=t.years[0]:e.deathRateYear=parseYear("2014"),e.displayData=e.data.map(function(t){return{id:t.id,death_rate:t.years.reduce(function(t,a){return t+(a.year.getTime()==e.deathRateYear.getTime()?a.death_rate:0)},0)}})},Choropleth.prototype.update=function(t){var e=this;e.wrangleData(t);var a=t.duration?t.duration:e["default"].duration;colors.domain([0,1,5,10,15,20]),e.keyTitle.html('Deaths Per 100,000 <tspan class="death-rate-year">('+formatYear(e.deathRateYear)+")</tspan>");var r=e.key.selectAll("rect").data(colors.domain());r.enter().append("rect").classed("key-rect",!0),r.transition().duration(a).attr("x",function(t,a){return a*e.keyWidth}).attr("y",e.keyRectHeight).attr("width",e.keyWidth).attr("height",e.keyRectHeight).attr("fill",function(t){return colors(t)});var n=e.key.selectAll(".key-label").data(colors.domain());return n.enter().append("text").classed("key-label",!0),n.transition().duration(a).text(function(t,e){return e==colors.domain().length-1?t+"+":t}).attr("x",function(t,a){return a*e.keyWidth+2}).attr("y",e.keyLabelOffset()).attr("font-size",e.fontSize()),e.states=e.graph.selectAll("path").data(topojson.feature(e.topo,e.topo.objects.usa).features),e.states.enter().append("path").classed("state",!0).on("mouseover",function(t){e.highlightState(t)}).on("mouseout",function(t){e.unhighlightState(t)}),e.states.transition().duration(a).attr("d",e.path).attr("fill",function(t,a){return colors(e.displayData[a].death_rate)}),e},Choropleth.prototype.handleResize=function(t){this.resize()},Choropleth.prototype.handleUpdate=function(t){this.update(t.options)},Choropleth.prototype.highlightState=function(t){this.drawHighlight(t).eventHandler().broadcast({name:"mouseoverState",id:t.id},this)},Choropleth.prototype.unhighlightState=function(t){this.removeHighlight(t).eventHandler().broadcast({name:"mouseoutState",id:t.id},this)},Choropleth.prototype.drawHighlight=function(t){var e=this;return e.states.filter(function(e){return e.id==t.id}).classed("highlighted",!0),e},Choropleth.prototype.removeHighlight=function(t){var e=this;return this.states.filter(function(e){return e.id==t.id}).classed("highlighted",!1),e},EventHandler.prototype.on=function(t,e,a){var r=this.listeners[t];return r||(r=[]),r.push({listener:e,callback:a.bind(e)}),this.listeners[t]=r,this},EventHandler.prototype.broadcast=function(t,e){var a=this.listeners[t.name];return a&&a.forEach(function(a){a.listener!=e&&a.callback(t)}),this},Scatterplot.prototype.eventHandler=function(t){return t?(this._eventHandler=t,this._eventHandler.on("update",this,this.handleUpdate),this._eventHandler.on("resize",this,this.handleResize),this._eventHandler.on("mouseoverState",this,this.drawHighlight),this._eventHandler.on("mouseoutState",this,this.removeHighlight),this):this._eventHandler},Scatterplot.prototype.initVis=function(){var t=this;return t.margin={top:20,right:20,bottom:40,left:50},t.padding={x:10,y:10},t.svg=d3.select("#"+t.parentElem).append("svg"),t.graph=t.svg.append("g"),t.title=t.graph.append("text").text("What Factors Influence Drug Deaths?").attr("text-anchor","middle").attr("font-weight","bold"),t.scatter=t.graph.append("g").classed("scatter-plot",!0),t.bfl=t.graph.append("g").classed("best-fit",!0),t.x=d3.scale.linear(),t.y=d3.scale.linear(),t.xAxisG=t.graph.append("g").classed("axis x-axis",!0),t.yAxisG=t.graph.append("g").classed("axis y-axis",!0),t.xAxis=d3.svg.axis().scale(t.x).ticks(6).orient("bottom"),t.yAxis=d3.svg.axis().scale(t.y).orient("left"),t.xTitle=t.xAxisG.append("text").classed("axis-label",!0).attr("text-anchor","middle"),t.yTitle=t.yAxisG.append("text").classed("axis-label",!0).attr("transform","rotate(-90)").attr("text-anchor","middle").text("Deaths per 100,000"),t.stateTip=d3.tip().attr("class","d3-tip").direction("s").offset([5,0]).html(function(e){return"<h4>"+e.id+'</h4><p><span class="tip-header">Death Rate: <span class="death-rate">'+e.death_rate+'</span></span><br><span class="tip-header">'+t.data[t.factor].name+': <span class="factor">'+t.data[t.factor].format(e.factor)+"</span></span></p>"}),t.graph.call(t.stateTip),t.bflTip=d3.tip().attr("class","d3-tip").direction("s").offset([5,0]).html(function(e){return'<span class="tip-header">Death Rate <span class="tip-death-rate">('+formatYear(t.deathRateYear)+')</span></span><br><span class="tip-header">'+t.data[t.factor].shortName+' <span class="tip-factor">('+formatYear(t.factorYear)+')</span></span><br><span class="tip-header">Correlation: '+e.correlation.toFixed(2)+'</span><span class="more-info">Click for detailed information</span>'}),t.graph.call(t.bflTip),t.resize(),t},Scatterplot.prototype.labelFontSize=function(){return"medium"==this.sizeGroup?"10pt":"8pt"},Scatterplot.prototype.yAxisTicks=function(){return"medium"==this.sizeGroup?10:4},Scatterplot.prototype.resize=function(){var t=this;return t.width=parseInt(d3.select("#"+t.parentElem).style("width"))-t.margin.left-t.margin.right,t.height=t.width,t.sizeGroup=t.width>256?"medium":"small",t.svg.attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom),t.graph.attr("transform","translate("+t.margin.left+","+t.margin.top+")"),t.title.attr("x",t.width/2).attr("y",6).attr("font-size",t.labelFontSize()),t.x.range([t.padding.x,t.width-t.padding.x]),t.y.range([t.height-t.padding.y,t.padding.y]),t.xAxisG.attr("transform","translate(0, "+t.height+")"),t.xTitle.attr("x",t.width/2).attr("y",t.margin.bottom-2),t.yAxis.ticks(t.yAxisTicks()),t.yTitle.attr("x",-t.width/2).attr("y",.75*-t.margin.left),t.update(t["default"]),t},Scatterplot.prototype.wrangleData=function(t){var e=this;if(!t)var t={};return e.deathRateYear=t.years?t.years[0]:e.deathRateYear,e.factorYear=t.years?t.years[1]:e.factorYear,e.factor=t.factor?t.factor:e.factor,e.displayData=e.data[e.factor].data.reduce(function(t,a,r){if("United States"===a.id)return t;var n=e.data.death_rate.data[r],i=e.data[e.factor].data[r];return deathYearData=n.years.filter(function(t){return t.year.getTime()==e.deathRateYear.getTime()})[0],factorYearData=i.years.filter(function(t){return t.year.getTime()==e.factorYear.getTime()})[0],t.push({id:a.id,death_rate:deathYearData.death_rate,factor:factorYearData[e.factor]}),t},[]),e},Scatterplot.prototype.update=function(t){var e=this;e.wrangleData(t);var a=t.duration?t.duration:e["default"].duration;e.x.domain(e.data[e.factor].domain),e.y.domain([0,35]),e.xTitle.html(e.data[e.factor].name+' <tspan class="factor">('+formatYear(e.factorYear)+")</tspan>").attr("font-size",e.labelFontSize()),e.yTitle.html(e.data.death_rate.name+' <tspan class="death_rate">('+formatYear(e.deathRateYear)+")</tspan>").attr("font-size",e.labelFontSize()),e.xAxis.tickFormat(e.data[e.factor].format),e.xAxisG.transition().duration(a).call(e.xAxis),e.yAxisG.transition().duration(a).call(e.yAxis),e.dots=e.scatter.selectAll("circle").data(e.displayData),e.dots.enter().append("circle").attr("class",function(t){return"dot "+t.id.replace(" ","")}).attr("r",5).on("mouseover",e.highlightState.bind(e)).on("mouseout",e.unhighlightState.bind(e)),e.dots.transition().duration(a).attr("cx",function(t){return e.x(t.factor)}).attr("cy",function(t){return e.y(t.death_rate)}).attr("fill",function(t){return colors(t.death_rate)});var r=e.displayData.map(function(t){return t.factor}),n=e.displayData.map(function(t){return t.death_rate}),i=e.regression.xSeries(r).ySeries(n).coefficients(),o=[{x1:e.x.domain()[0],y1:i[1],x2:e.x.domain()[1],y2:i[0]*e.x.domain()[1]+i[1],correlation:Math.sqrt(i[2])}];e.regLine=e.bfl.selectAll("line").data(o),e.regLine.enter().append("line").classed("best-fit",!0).on("mouseover",function(t){e.highlightBFL(t)}).on("mouseout",function(t){e.unhighlightBFL(t)}),e.regLine.transition().duration(a).attr("x1",function(t){return e.x(t.x1)}).attr("y1",function(t){return e.y(t.y1)}).attr("x2",function(t){return e.x(t.x2)}).attr("y2",function(t){return e.y(t.y2)})},Scatterplot.prototype.handleResize=function(t){this.resize()},Scatterplot.prototype.handleUpdate=function(t){this.update(t.options)},Scatterplot.prototype.drawHighlight=function(t){var e=this;return e.dots.filter(function(e){return e.id==t.id}).classed("highlighted",!0).attr("r",10),e.stateTip.show(e.displayData[e.stateIndex(t)]),e},Scatterplot.prototype.removeHighlight=function(t){var e=this;return e.dots.filter(function(e){return e.id==t.id}).classed("highlighted",!1).attr("r",5),e.stateTip.hide(),e},Scatterplot.prototype.highlightBFL=function(t){this.regLine.classed("highlighted",!0),this.bflTip.show(t)},Scatterplot.prototype.unhighlightBFL=function(t){this.regLine.classed("highlighted",!1),this.bflTip.hide()},Scatterplot.prototype.highlightState=function(t){this.drawHighlight(t).eventHandler().broadcast({name:"mouseoverState",id:t.id},this)},Scatterplot.prototype.unhighlightState=function(t){this.removeHighlight(t).eventHandler().broadcast({name:"mouseoutState",id:t.id},this)},Scatterplot.prototype.stateIndex=function(t){for(var e=0;e<this.displayData.length;e++)if(this.displayData[e].id==t.id)return e;return 0};var change=!0;YearSlider.prototype.question=function(t){return t?(this.descriptiveText=t,this):this.descriptiveText},YearSlider.prototype.eventHandler=function(t){return t?(this._eventHandler=t,this._eventHandler.on("resize",this,this.handleResize),this):this._eventHandler},YearSlider.prototype.initVis=function(){var t=this;return t.margin={top:10,right:20,bottom:10,left:20},t.marker={radius:10},t.axis={tick:{height:10}},t.svg=d3.select("#"+t.parentElem).append("svg"),t.slider=t.svg.append("g"),t.x=d3.scale.linear().domain(t.range),t.yearsText=t.slider.append("g").classed("years",!0),t.topSlider=t.slider.append("g").classed("slider top",!0),t.bottomSlider=t.slider.append("g").classed("slider bottom",!0),t.topAxis=t.topSlider.append("g").classed("axis top-axis",!0),t.bottomAxis=t.bottomSlider.append("g").classed("axis bottom",!0),t.topAxisLine=t.topAxis.append("line").attr("stroke-width",4),t.bottomAxisLine=t.bottomAxis.append("line").attr("stroke-width",4),t.topText=t.topSlider.append("text").classed("axis-label top",!0).text("Death Rate").attr("text-anchor","middle"),t.bottomText=t.bottomSlider.append("text").classed("axis-label bottom",!0).text("Factor Data").attr("text-anchor","middle"),t.questionButton=t.slider.append("text").classed("slider question",!0).html("&#xf29c").on("click",function(e){t.questionClicked()}),t.yearsText.selectAll("text").data(t.years).enter().append("text").text(function(t){return t}).attr("text-anchor","middle").attr("transform","rotate(90)"),t.dragTopMarker=d3.behavior.drag().on("dragstart",function(e){t.topMarkerStartedDragging(e)}).on("drag",function(e){t.markerDragged(e)}).on("dragend",function(e){t.markerEndedDragging(e)}),t.dragBottomMarker=d3.behavior.drag().on("dragstart",function(e){t.bottomMarkerStartedDragging(e)}).on("drag",function(e){t.markerDragged(e)}).on("dragend",function(e){t.markerEndedDragging(e)}),t.resize(),t},YearSlider.prototype.resize=function(){var t=this;return t.width=parseInt(d3.select("#"+t.parentElem).style("width"))-t.margin.left-t.margin.right,t.height=1/3*t.width,t.svg.attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom),t.slider.attr("transform","translate("+t.margin.left+","+t.margin.top+")"),t.topText.attr("x",t.width/2).attr("y",-15),t.bottomText.attr("x",t.width/2).attr("y",25),t.x.range([0,t.width]),t.topSlider.attr("transform","translate(0,"+Math.floor(t.height/4)+")"),t.bottomSlider.attr("transform","translate(0,"+t.height/4*3+")"),t.topAxisLine.attr("x0",0).attr("x1",t.width),t.bottomAxisLine.attr("x0",0).attr("x1",t.width),t.yearsText.attr("transform","translate(0,"+t.height/2+")"),t.yearsText.selectAll("text").attr("y",function(e){return-t.x(e)+4}),t.questionButton.attr("x",t.width).attr("y",t.height+5),t.update(),t},YearSlider.prototype.update=function(){var t=this;t.updateMarkers(),t.updateText()},YearSlider.prototype.updateText=function(){var t=this,e=d3.max([t.topYear,t.bottomYear]),a=d3.min([t.topYear,t.bottomYear]);t.yearsText.selectAll("text").attr("font-weight",function(t){return t>=a&&e>=t?"bold":"lighter"})},YearSlider.prototype.updateMarkers=function(){var t=this,e=t.topSlider.selectAll("circle").data([t.topYear]);e.enter().append("circle").attr("r",t.marker.radius).on("mouseover",function(){t.changeMarkerColor(e,t.colors.markers.top.hover)}).on("mouseout",function(){t.changeMarkerColor(e,t.colors.markers.top.normal)}).call(t.dragTopMarker),e.transition().duration(250).attr("cx",t.x);var a=t.bottomSlider.selectAll("circle").data([t.bottomYear]);a.enter().append("circle").attr("r",t.marker.radius).on("mouseover",function(){t.changeMarkerColor(a,t.colors.markers.bottom.hover)}).on("mouseout",function(){t.changeMarkerColor(a,t.colors.markers.bottom.normal)}).call(t.dragBottomMarker),a.transition().duration(250).attr("cx",t.x)},YearSlider.prototype.changeMarkerColor=function(t,e){t.attr("fill",e)},YearSlider.prototype.handleResize=function(t){this.resize()},YearSlider.prototype.topMarkerStartedDragging=function(t){this.draggingSlider="topSlider",this.draggingYear="topYear",this.markerStartedDragging(t)},YearSlider.prototype.bottomMarkerStartedDragging=function(t){this.draggingSlider="bottomSlider",this.draggingYear="bottomYear",this.markerStartedDragging(t)},YearSlider.prototype.markerStartedDragging=function(t){this[this.draggingSlider].selectAll("circle").classed("dragging",!0)},YearSlider.prototype.markerDragged=function(t){var e=this,a=d3.min([d3.max([d3.event.x,0]),e.width]);e[e.draggingSlider].select("circle").attr("cx",a),e[e.draggingYear]=Math.round(e.x.invert(a)),e.updateText()},YearSlider.prototype.markerEndedDragging=function(t){this[this.draggingSlider].selectAll("circle").classed("dragging",!1),this.updateMarkers(),this.eventHandler().broadcast({name:"update",options:{years:[parseYear(this.topYear.toString()),parseYear(this.bottomYear.toString())]}})},YearSlider.prototype.questionClicked=function(){this.eventHandler().broadcast({name:"question-clicked",options:{}})};
//# sourceMappingURL=main.min.js.map
