function loadData(t,e,r,a,i){t?console.log(t):(e.objects.usa.geometries.sort(function(t,e){return t.id<e.id?-1:t.id>e.id?1:0}),r.forEach(function(t){t.years.forEach(function(t){t.death_rate=+t.death_rate,t.deaths=+t.deaths,t.population=+t.population,t.year=parseYear(t.year)})}),a.forEach(function(t){t.years.forEach(function(t){t.median_income=+t.median_income,t.year=parseYear(t.year)})}),i.forEach(function(t){t.years.forEach(function(t){t.unemployment=+t.unemployment,t.year=parseYear(t.year)})}),dataLoaded=!0,createVis(e,r,a,i))}function createVis(t,e,r,a){choropleth=new Choropleth("choropleth",t,e),choropleth.eventHandler(handler).initVis(),scatterplot=new Scatterplot("scatterplot","median_income",e,r,a),scatterplot.eventHandler(handler).initVis(),yearSlider=new YearSlider("year-slider",[2002,2014]),yearSlider.eventHandler(handler).initVis()}function updateFactor(t){dataLoaded&&(options={factor:t,duration:1e3},handler.broadcast({name:"update",options:options}))}function Choropleth(t,e,r){this.parentElem=t,this.topo=e,this.data=r,this.displayData={},this.sizeGroup="medium",this["default"]={duration:1e3}}function EventHandler(){this.listeners={}}function Regression(){this.xSeries=function(t){return t?(this._xSeries=t,this):this._xSeries},this.ySeries=function(t){return t?(this._ySeries=t,this):this._ySeries},this.reduceSum=function(t,e){return t+e},this.coefficients=function(){var t=this,e=1*this._xSeries.reduce(this.reduceSum)/this._xSeries.length,r=1*this._ySeries.reduce(this.reduceSum)/this._ySeries.length,a=this._xSeries.map(function(t){return Math.pow(t-e,2)}).reduce(this.reduceSum),i=this._ySeries.map(function(t){return Math.pow(t-r,2)}).reduce(this.reduceSum),n=this._xSeries.map(function(a,i){return(a-e)*(t._ySeries[i]-r)}).reduce(this.reduceSum),o=n/a,s=r-e*o,d=Math.pow(n,2)/(a*i);return[o,s,d]}}function Scatterplot(t,e,r,a,i){this.parentElem=t,this.data={death_rate:{data:r,name:"Deaths Per 100,000",domain:[d3.min(r,function(t){return d3.min(t.years,function(t){return t.death_rate})}),d3.max(r,function(t){return d3.max(t.years,function(t){return t.death_rate})})]},median_income:{data:a,name:"Median Income",domain:[d3.min(a,function(t){return d3.min(t.years,function(t){return t.median_income})}),d3.max(a,function(t){return d3.max(t.years,function(t){return t.median_income})})]},unemployment:{data:i,name:"Unemployment Rate",domain:[d3.min(i,function(t){return d3.min(t.years,function(t){return t.unemployment})}),d3.max(i,function(t){return d3.max(t.years,function(t){return t.unemployment})})]}},this.factor=e,this.factorYear=parseYear("2014"),this.deathRateYear=parseYear("2014"),this.displayData={},this.regression=new Regression,this["default"]={duration:1e3}}function YearSlider(t,e){this.parentElem=t,this.range=e,this.years=d3.range(e[0],e[1]+1),this.topYear=e[1],this.bottomYear=e[1],this.colors={markers:{top:{hover:"#756BB1",normal:"#54278F"},bottom:{hover:"#6CD16C",normal:"#23A923"}}}}var formatYear=d3.time.format("%Y"),parseYear=formatYear.parse;colorbrewer.Purples[6].unshift("#ffffff");var colors=d3.scale.quantile().range(colorbrewer.Purples[6]),dataLoaded=!1;d3_queue.queue().defer(d3.json,"data/topo_usa.json").defer(d3.json,"data/state_deaths.json").defer(d3.json,"data/state_income.json").defer(d3.json,"data/state_unemployment.json").await(loadData);var handler=new EventHandler;d3.select(window).on("resize",function(){handler.broadcast({name:"resize"})}),Choropleth.prototype.eventHandler=function(t){return t?(this._eventHandler=t,this._eventHandler.on("update",this,this.handleUpdate),this._eventHandler.on("resize",this,this.handleResize),this._eventHandler.on("mouseoverState",this,this.drawHighlight),this._eventHandler.on("mouseoutState",this,this.removeHighlight),this):this._eventHandler},Choropleth.prototype.initVis=function(){var t=this;return t.margin={top:100,right:20,bottom:20,left:20},t.keyHeight=80,t.keyRectHeight=20,t.svg=d3.select("#"+t.parentElem).append("svg").classed("us-map",!0),t.graph=t.svg.append("g"),t.key=t.svg.append("g").classed("key",!0),t.keyTitle=t.key.append("text").text("Deaths Per 100,000").classed("key-title",!0).attr("text-anchor","middle"),t.projection=d3.geo.albersUsa(),t.path=d3.geo.path().projection(t.projection),t.resize(),t},Choropleth.prototype.resize=function(){var t=this;return t.width=parseInt(d3.select("#"+t.parentElem).style("width"))-t.margin.left-t.margin.right,t.height=.8*t.width-t.margin.top-t.margin.bottom,t.sizeGroup=t.width>468?"medium":"small",t.svg.attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom+t.keyHeight),t.key.attr("transform","translate(0,10)"),t.keyTitle.attr("x",t.width/2).attr("y",10),t.graph.attr("transform","translate("+t.margin.left+","+t.margin.top+")"),t.keyWidth=Math.floor(1/6*t.width),t.projection.scale(1.35*t.width).translate([t.width/2,t.height/2]),t.update({duration:0}),t},Choropleth.prototype.keyLabelOffset=function(){return"medium"==this.sizeGroup?55:50},Choropleth.prototype.fontSize=function(){return"medium"==this.sizeGroup?"14px":"12px"},Choropleth.prototype.wrangleData=function(t){var e;e=t&&t.years?t.years[0]:parseYear("2014");var r=this;r.displayData=r.data.map(function(t){return{id:t.id,death_rate:t.years.reduce(function(t,r){return t+(r.year.getTime()==e.getTime()?r.death_rate:0)},0)}})},Choropleth.prototype.update=function(t){var e=this;e.wrangleData(t);var r=t.duration?t.duration:e["default"].duration;colors.domain([0,1,5,10,15,20]);var a=e.key.selectAll("rect").data(colors.domain());a.enter().append("rect").classed("key-rect",!0),a.transition().duration(r).attr("x",function(t,r){return r*e.keyWidth}).attr("y",e.keyRectHeight).attr("width",e.keyWidth).attr("height",e.keyRectHeight).attr("fill",function(t){return colors(t)});var i=e.key.selectAll(".key-label").data(colors.domain());return i.enter().append("text").classed("key-label",!0),i.transition().duration(r).text(function(t,e){return e==colors.domain().length-1?t+"+":t}).attr("x",function(t,r){return r*e.keyWidth+2}).attr("y",e.keyLabelOffset()).attr("font-size",e.fontSize()),e.states=e.graph.selectAll("path").data(topojson.feature(e.topo,e.topo.objects.usa).features),e.states.enter().append("path").classed("state",!0).on("mouseover",function(t){e.highlightState(t)}).on("mouseout",function(t){e.unhighlightState(t)}),e.states.transition().duration(r).attr("d",e.path).attr("fill",function(t,r){return colors(e.displayData[r].death_rate)}),e},Choropleth.prototype.handleResize=function(t){this.resize()},Choropleth.prototype.handleUpdate=function(t){this.update(t.options)},Choropleth.prototype.highlightState=function(t){this.drawHighlight(t).eventHandler().broadcast({name:"mouseoverState",id:t.id},this)},Choropleth.prototype.unhighlightState=function(t){this.removeHighlight(t).eventHandler().broadcast({name:"mouseoutState",id:t.id},this)},Choropleth.prototype.drawHighlight=function(t){return this.states.filter(function(e){return e.id==t.id}).classed("highlighted",!0),this},Choropleth.prototype.removeHighlight=function(t){return this.states.filter(function(e){return e.id==t.id}).classed("highlighted",!1),this},EventHandler.prototype.on=function(t,e,r){var a=this.listeners[t];return a||(a=[]),a.push({listener:e,callback:r.bind(e)}),this.listeners[t]=a,this},EventHandler.prototype.broadcast=function(t,e){var r=this.listeners[t.name];return r&&r.forEach(function(r){r.listener!=e&&r.callback(t)}),this},Scatterplot.prototype.eventHandler=function(t){return t?(this._eventHandler=t,this._eventHandler.on("update",this,this.handleUpdate),this._eventHandler.on("resize",this,this.handleResize),this._eventHandler.on("mouseoverState",this,this.drawHighlight),this._eventHandler.on("mouseoutState",this,this.removeHighlight),this):this._eventHandler},Scatterplot.prototype.initVis=function(){var t=this;return t.margin={top:20,right:20,bottom:40,left:70},t.padding={x:10,y:10},t.svg=d3.select("#"+t.parentElem).append("svg"),t.graph=t.svg.append("g"),t.title=t.graph.append("text").text("What Factors Influence Drug Deaths?").attr("text-anchor","middle").attr("font-weight","bold"),t.scatter=t.graph.append("g").classed("scatter-plot",!0),t.bfl=t.graph.append("g").classed("best-fit",!0),t.x=d3.scale.linear(),t.y=d3.scale.linear(),t.xAxisG=t.graph.append("g").classed("axis x-axis",!0),t.yAxisG=t.graph.append("g").classed("axis y-axis",!0),t.xAxis=d3.svg.axis().scale(t.x).ticks(6).orient("bottom"),t.yAxis=d3.svg.axis().scale(t.y).ticks(10).orient("left"),t.xTitle=t.xAxisG.append("text").classed("axis-label",!0).attr("text-anchor","middle"),t.yTitle=t.yAxisG.append("text").classed("axis-label",!0).attr("transform","rotate(-90)").attr("text-anchor","middle").text("Deaths per 100,000"),t.resize(),t},Scatterplot.prototype.handleResize=function(t){this.resize()},Scatterplot.prototype.resize=function(){var t=this;return t.width=parseInt(d3.select("#"+t.parentElem).style("width"))-t.margin.left-t.margin.right,t.height=t.width,t.svg.attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom),t.graph.attr("transform","translate("+t.margin.left+","+t.margin.top+")"),t.title.attr("x",t.width/2).attr("y",6),t.x.range([t.padding.x,t.width-t.padding.x]),t.y.range([t.height-t.padding.y,t.padding.y]),t.xAxisG.attr("transform","translate(0, "+t.height+")"),t.xTitle.attr("x",t.width/2).attr("y",t.margin.bottom-2),t.yTitle.attr("x",-t.width/2).attr("y",.75*-t.margin.left),t.update(t["default"]),t},Scatterplot.prototype.wrangleData=function(t){var e=this;if(!t)var t={};return e.deathRateYear=t.years?t.years[0]:e.deathRateYear,e.factorYear=t.years?t.years[1]:e.factorYear,e.factor=t.factor?t.factor:e.factor,e.displayData=e.data[e.factor].data.reduce(function(t,r,a){if("United States"===r.id)return t;var i=e.data.death_rate.data[a],n=e.data[e.factor].data[a];return deathYearData=i.years.filter(function(t){return t.year.getTime()==e.deathRateYear.getTime()})[0],factorYearData=n.years.filter(function(t){return t.year.getTime()==e.factorYear.getTime()})[0],t.push({id:r.id,death_rate:deathYearData.death_rate,factor:factorYearData[e.factor]}),t},[]),e},Scatterplot.prototype.handleUpdate=function(t){this.update(t.options)},Scatterplot.prototype.update=function(t){var e=this;e.wrangleData(t);var r=t.duration?t.duration:e["default"].duration;e.x.domain(e.data[e.factor].domain),e.y.domain([0,35]),e.xTitle.html(e.data[e.factor].name+' <tspan class="factor">('+formatYear(e.factorYear)+")</tspan>"),e.yTitle.html(e.data.death_rate.name+' <tspan class="death_rate">('+formatYear(e.deathRateYear)+")</tspan>"),e.xAxisG.transition().duration(r).call(e.xAxis),e.yAxisG.transition().duration(r).call(e.yAxis),e.dots=e.scatter.selectAll("circle").data(e.displayData),e.dots.enter().append("circle").attr("class",function(t){return"dot "+t.id.replace(" ","")}).attr("r",5).on("mouseover",e.highlightState.bind(e)).on("mouseout",e.unhighlightState.bind(e)),e.dots.transition().duration(r).attr("cx",function(t){return e.x(t.factor)}).attr("cy",function(t){return e.y(t.death_rate)}).attr("fill",function(t){return colors(t.death_rate)});var a=e.displayData.map(function(t){return t.factor}),i=e.displayData.map(function(t){return t.death_rate}),n=e.regression.xSeries(a).ySeries(i).coefficients(),o=[{x1:e.x.domain()[0],y1:n[1],x2:e.x.domain()[1],y2:n[0]*e.x.domain()[1]+n[1]}],s=e.bfl.selectAll("line").data(o);s.enter().append("line").classed("best-fit",!0),s.transition().duration(r).attr("x1",function(t){return e.x(t.x1)}).attr("y1",function(t){return e.y(t.y1)}).attr("x2",function(t){return e.x(t.x2)}).attr("y2",function(t){return e.y(t.y2)})},Scatterplot.prototype.drawHighlight=function(t){return this.dots.filter(function(e){return e.id==t.id}).classed("highlighted",!0).attr("r",10),this},Scatterplot.prototype.removeHighlight=function(t){return this.dots.filter(function(e){return e.id==t.id}).classed("highlighted",!1).attr("r",5),this},Scatterplot.prototype.highlightState=function(t){this.drawHighlight(t).eventHandler().broadcast({name:"mouseoverState",id:t.id},this)},Scatterplot.prototype.unhighlightState=function(t){this.removeHighlight(t).eventHandler().broadcast({name:"mouseoutState",id:t.id},this)},YearSlider.prototype.eventHandler=function(t){return t?(this._eventHandler=t,this._eventHandler.on("resize",this,this.handleResize),this):this._eventHandler},YearSlider.prototype.initVis=function(){var t=this;return t.margin={top:10,right:20,bottom:10,left:20},t.marker={radius:10},t.axis={tick:{height:10}},t.svg=d3.select("#"+t.parentElem).append("svg"),t.slider=t.svg.append("g"),t.topText=t.slider.append("text").text("Death Rate").attr("text-anchor","middle"),t.bottomText=t.slider.append("text").text("Factor Data").attr("text-anchor","middle"),t.x=d3.scale.linear().domain(t.range),t.yearsText=t.slider.append("g").classed("years",!0),t.topSlider=t.slider.append("g").classed("slider top",!0),t.bottomSlider=t.slider.append("g").classed("slider bottom",!0),t.topAxis=t.topSlider.append("g").classed("axis top-axis",!0),t.bottomAxis=t.bottomSlider.append("g").classed("axis bottom",!0),t.topAxisLine=t.topAxis.append("line").attr("stroke-width",4),t.bottomAxisLine=t.bottomAxis.append("line").attr("stroke-width",4),t.yearsText.selectAll("text").data(t.years).enter().append("text").text(function(t){return t}).attr("text-anchor","middle").attr("transform","rotate(90)"),t.dragTopMarker=d3.behavior.drag().on("dragstart",function(e){t.topMarkerStartedDragging(e)}).on("drag",function(e){t.markerDragged(e)}).on("dragend",function(e){t.markerEndedDragging(e)}),t.dragBottomMarker=d3.behavior.drag().on("dragstart",function(e){t.bottomMarkerStartedDragging(e)}).on("drag",function(e){t.markerDragged(e)}).on("dragend",function(e){t.markerEndedDragging(e)}),t.resize(),t},YearSlider.prototype.resize=function(){var t=this;return t.width=parseInt(d3.select("#"+t.parentElem).style("width"))-t.margin.left-t.margin.right,t.height=1/3*t.width,t.svg.attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom),t.slider.attr("transform","translate("+t.margin.left+","+t.margin.top+")"),t.topText.attr("x",t.width/2).attr("y",10),t.bottomText.attr("x",t.width/2).attr("y",100),t.x.range([0,t.width]),t.topSlider.attr("transform","translate(0,"+Math.floor(t.height/4)+")"),t.bottomSlider.attr("transform","translate(0,"+t.height/4*3+")"),t.topAxisLine.attr("x0",0).attr("x1",t.width),t.bottomAxisLine.attr("x0",0).attr("x1",t.width),t.yearsText.attr("transform","translate(0,"+t.height/2+")"),t.yearsText.selectAll("text").attr("y",function(e){return-t.x(e)+4}),t.update(),t},YearSlider.prototype.update=function(){var t=this;t.updateMarkers(),t.updateText()},YearSlider.prototype.updateText=function(){var t=this,e=d3.max([t.topYear,t.bottomYear]),r=d3.min([t.topYear,t.bottomYear]);t.yearsText.selectAll("text").attr("font-weight",function(t){return t>=r&&e>=t?"bold":"lighter"})},YearSlider.prototype.updateMarkers=function(){var t=this,e=t.topSlider.selectAll("circle").data([t.topYear]);e.enter().append("circle").attr("fill",t.colors.markers.top.normal).attr("r",t.marker.radius).on("mouseover",function(){t.changeMarkerColor(e,t.colors.markers.top.hover)}).on("mouseout",function(){t.changeMarkerColor(e,t.colors.markers.top.normal)}).call(t.dragTopMarker),e.transition().duration(250).attr("cx",t.x);var r=t.bottomSlider.selectAll("circle").data([t.bottomYear]);r.enter().append("circle").attr("fill",t.colors.markers.bottom.normal).attr("r",t.marker.radius).on("mouseover",function(){t.changeMarkerColor(r,t.colors.markers.bottom.hover)}).on("mouseout",function(){t.changeMarkerColor(r,t.colors.markers.bottom.normal)}).call(t.dragBottomMarker),r.transition().duration(250).attr("cx",t.x)},YearSlider.prototype.changeMarkerColor=function(t,e){t.attr("fill",e)},YearSlider.prototype.handleResize=function(t){this.resize()},YearSlider.prototype.topMarkerStartedDragging=function(t){this.draggingSlider="topSlider",this.draggingYear="topYear",this.markerStartedDragging(t)},YearSlider.prototype.bottomMarkerStartedDragging=function(t){this.draggingSlider="bottomSlider",this.draggingYear="bottomYear",this.markerStartedDragging(t)},YearSlider.prototype.markerStartedDragging=function(t){this[this.draggingSlider].selectAll("circle").classed("dragging",!0)},YearSlider.prototype.markerDragged=function(t){var e=this,r=d3.min([d3.max([d3.event.x,0]),e.width]);e[e.draggingSlider].select("circle").attr("cx",r),e[e.draggingYear]=Math.round(e.x.invert(r)),e.updateText()},YearSlider.prototype.markerEndedDragging=function(t){this[this.draggingSlider].selectAll("circle").classed("dragging",!1),this.updateMarkers(),this.eventHandler().broadcast({name:"update",options:{years:[parseYear(this.topYear.toString()),parseYear(this.bottomYear.toString())]}})},YearSlider.prototype.handleLagDragStart=function(t){},YearSlider.prototype.handleLagDrag=function(t){},YearSlider.prototype.handleLagDragEnd=function(t){};
//# sourceMappingURL=main.min.js.map
