{"version":3,"sources":["main.min.js"],"names":["loadData","error","topo","deaths","income","unemployment","console","log","objects","usa","geometries","sort","a","b","id","forEach","state","years","year","death_rate","population","parseYear","median_income","dataLoaded","createVis","choropleth","Choropleth","eventHandler","handler","initVis","scatterplot","Scatterplot","yearSlider","YearSlider","on","this","displaySliderDescription","updateFactor","factor","options","duration","broadcast","name","$","modal","parentElem","data","displayData","sizeGroup","EventHandler","listeners","Regression","xSeries","_xSeries","ySeries","_ySeries","reduceSum","prev","cur","coefficients","self","xBar","reduce","length","yBar","ssXX","map","d","Math","pow","ssYY","ssXY","i","slope","intercept","rSquare","format","formatIdentity","domain","d3","min","max","shortName","formatDecimal","formatPercent","factorYear","deathRateYear","regression","range","topYear","bottomYear","colors","markers","top","hover","normal","bottom","formatYear","time","parse","str","colorbrewer","Purples","unshift","scale","quantile","d3_queue","queue","defer","json","await","select","window","prototype","_eventHandler","handleUpdate","handleResize","drawHighlight","removeHighlight","vis","margin","right","left","keyHeight","keyRectHeight","svg","append","classed","graph","key","keyTitle","text","attr","projection","geo","albersUsa","path","resize","width","parseInt","style","height","keyWidth","floor","translate","update","keyLabelOffset","fontSize","wrangleData","getTime","keyRects","selectAll","enter","transition","keyLabels","states","topojson","feature","features","highlightState","unhighlightState","event","filter","eventName","listener","callback","push","bind","sender","padding","x","y","title","scatter","bfl","linear","xAxisG","yAxisG","xAxis","axis","ticks","orient","yAxis","xTitle","yTitle","stateTip","tip","direction","offset","html","call","bflTip","correlation","toFixed","labelFontSize","yAxisTicks","current","factorData","deathYearData","factorYearData","tickFormat","dots","replace","coeff","bflData","x1","y1","x2","y2","sqrt","regLine","show","hide","stateIndex","question","descriptiveText","marker","radius","tick","slider","topText","bottomText","yearsText","topSlider","bottomSlider","topAxis","bottomAxis","topAxisLine","bottomAxisLine","questionButton","questionClicked","dragTopMarker","behavior","drag","topMarkerStartedDragging","markerDragged","markerEndedDragging","dragBottomMarker","bottomMarkerStartedDragging","updateMarkers","updateText","maxYear","minYear","topMarker","changeMarkerColor","bottomMarker","color","draggingSlider","draggingYear","markerStartedDragging","round","invert","toString"],"mappings":"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","file":"main.min.js","sourcesContent":["  \n// convert year strings to date objects\nvar formatYear = d3.time.format('%Y');\nvar parseYear = formatYear.parse;\n\nvar formatPercent = d3.format('%');\nvar formatDecimal = d3.format('.2');\nvar formatIdentity = function(str) { return str; };\n\n// universal color scale\ncolorbrewer.Purples[6].unshift('#ffffff');\nvar colors = d3.scale.quantile()\n  .range(colorbrewer.Purples[6]);\n    \n/***---------------------***\n *** LOAD AND PARSE DATA ***\n ***---------------------***/\n  \n// load all data before cleaning\nvar dataLoaded = false;\nd3_queue.queue()\n  .defer(d3.json, 'data/topo_usa.json')\n  .defer(d3.json, 'data/state_deaths.json')\n  .defer(d3.json, 'data/state_income.json')\n  .defer(d3.json, 'data/state_unemployment.json')\n  .await(loadData);\n  \n// globals for data\nfunction loadData(error, topo, deaths, income, unemployment) {\n  if (error) {\n    console.log(error);\n  } else {\n    topo.objects.usa.geometries.sort(function(a,b) {\n      if (a.id < b.id) return -1;\n      if (a.id > b.id) return 1;\n      return 0;\n    });\n    \n    // convert death data from strings to numbers and dates\n    deaths.forEach(function(state) {\n      state.years.forEach(function(year) {\n        year.death_rate = +year.death_rate;\n        year.deaths = +year.deaths;\n        year.population = +year.population;\n        year.year = parseYear(year.year);\n      });\n    });\n    // convert income data from strings to numbers and dates\n    income.forEach(function(state) {\n      state.years.forEach(function(year) {\n        year.median_income = +year.median_income / 1000,\n        year.year = parseYear(year.year)\n      });\n    });\n    \n    unemployment.forEach(function(state) {\n      state.years.forEach(function(year) {\n        year.unemployment = +year.unemployment;\n        year.year = parseYear(year.year);\n      })\n    })\n    // update data loading status\n    dataLoaded = true;\n    // create visualizations\n    createVis(topo, deaths, income, unemployment);\n  }\n}\n\n/***--------------------------------***\n *** DRAW AND UPDATE VISUALIZATIONS ***\n ***--------------------------------***/\n\nvar handler = new EventHandler();\nd3.select(window).on('resize', function() {handler.broadcast({name: 'resize'})});\n\n// creates and initializes all visualizations \nfunction createVis(topo, deaths, income, unemployment) {\n  \n  choropleth = new Choropleth('choropleth', topo, deaths);\n  choropleth.eventHandler(handler).initVis();\n  \n  scatterplot = new Scatterplot('scatterplot', 'median_income', deaths, income, unemployment);\n  scatterplot.eventHandler(handler).initVis();\n  \n  yearSlider = new YearSlider('year-slider', [2002, 2014]);\n  yearSlider.eventHandler(handler).initVis();\n  handler.on('question-clicked', this, displaySliderDescription);\n}\n\n// update visualizations based on selected options\nfunction updateFactor(factor) {\n  if (dataLoaded) {\n    // build options\n    options = {\n      factor: factor,\n      duration: 1000\n    };\n    \n    handler.broadcast({ name: 'update', options: options});\n  }\n}\n\nfunction displaySliderDescription() {\n  $('#slider-modal').modal();\n}\n/*--------------------*\n *** INITIALIZATION ***\n *--------------------*/\n\n/**\n * Creates a new choropleth\n *\n * @param parentElem  The dom element within which the visualization should be\n *                    appended\n * @param topo        The topojson data for the choropleth's map\n * @param data        The death data with which to color the map\n * @return Choropleth\n */\nfunction Choropleth(parentElem, topo, data) {\n  this.parentElem = parentElem;\n  this.topo = topo;\n  this.data = data;\n  this.displayData = {};\n  \n  this.sizeGroup = \"medium\";\n  this.default = {\n    duration: 1000\n  };\n}\n\n/**\n * If an event handler is specified sets the choropleth's handler and adds \n * the choropleth's listener callbacks. Returns the choropleth\n * If no event handler is specified returns the choropleth's current handler.\n *\n * @param handler The event handler to use with the choropleth\n * @return Choropleth|EventHandler\n */\nChoropleth.prototype.eventHandler = function(handler) {\n  if (handler) {\n    this._eventHandler = handler;\n    this._eventHandler.on('update', this, this.handleUpdate);\n    this._eventHandler.on('resize', this, this.handleResize);\n    this._eventHandler.on('mouseoverState', this, this.drawHighlight);\n    this._eventHandler.on('mouseoutState', this, this.removeHighlight);\n    return this;\n  }\n  \n  return this._eventHandler;\n}\n\n/**\n * Creates SVG and initializes visualization variables.\n *\n * @return Choropleth\n */\nChoropleth.prototype.initVis = function() {\n  var vis = this;\n  \n  /* DRAWING PARAMETERS */\n  vis.margin = { top: 100, right: 20, bottom: 20, left: 20 };\n  vis.keyHeight = 80;\n  vis.keyRectHeight = 20;\n  \n  /* ** CREATE DRAWING AREA ** */\n  vis.svg = d3.select('#'+vis.parentElem).append('svg')\n    .classed('us-map', true);\n  vis.graph = vis.svg.append('g');\n  vis.key = vis.svg.append('g').classed('key', true);\n  vis.keyTitle = vis.key.append('text')\n    .text('Deaths Per 100,000')\n    .classed('key-title', true)\n    .attr('text-anchor', 'middle');\n      \n  /*** MAP DRAWING FUNCTIONS ***/\n  vis.projection = d3.geo.albersUsa();\n  vis.path = d3.geo.path()\n    .projection(vis.projection);\n  \n  vis.resize();\n  // return vis for chaining\n  return vis;\n}\n\n\n/*------------*\n *** SIZING ***\n *------------*/\n\n/**\n * Resizes the visualization and redraws it within its parent element.\n *\n * @return Choropleth\n */\nChoropleth.prototype.resize = function() {\n  var vis = this;\n  \n  /* set width and height based on container */\n  vis.width = parseInt(d3.select('#'+vis.parentElem).style('width')) - vis.margin.left - vis.margin.right;\n  vis.height = vis.width * .8 - vis.margin.top - vis.margin.bottom;\n  vis.sizeGroup = (vis.width > 468) ? 'medium' : 'small';\n  \n  /* update margin transformations */\n  vis.svg.attr('width', vis.width + vis.margin.left + vis.margin.right)\n    .attr('height', vis.height + vis.margin.top + vis.margin.bottom + vis.keyHeight);\n    \n  vis.key.attr('transform', 'translate(0,10)');\n  vis.keyTitle.attr('x', vis.width/2)\n    .attr('y', 10);\n      \n  vis.graph.attr('transform', 'translate('+ vis.margin.left +','+ vis.margin.top +')');\n  \n  /* Rescale drawing parameters */\n  vis.keyWidth = Math.floor((1/6)*vis.width);\n  vis.projection.scale(vis.width * 1.35)\n    .translate([vis.width/2, vis.height/2]);\n    \n  vis.update({ duration: 0 });\n  \n  return vis;\n}\n\n/**\n * Returns the correct offset based on the visualization's current size group\n *\n * @return Number\n */\nChoropleth.prototype.keyLabelOffset = function() {\n  if (this.sizeGroup == 'medium') {\n    return 55;\n  } else {\n    return 50;\n  }\n}\n\n/**\n * Returns the correct font size based on the visualizations current size group\n *\n * @return String\n */\nChoropleth.prototype.fontSize = function() {\n  if (this.sizeGroup == \"medium\") {\n    return '14px';\n  } else {\n    return '12px';\n  }\n}\n\n/*---------------------------*\n *** DRAWING VISUALIZATION ***\n *---------------------------*/\n \n/**\n * Coerces data into an array the state's ID and death rate.\n * Accepted Options:\n *  years: Array of date objects, first date should be the year for death rate \n *\n * @param options The options for wrangling data\n */\nChoropleth.prototype.wrangleData = function(options) {\n  var deathRateYear;\n  if (!options || !options.years) {\n    deathRateYear = parseYear('2014');\n  } else {\n    deathRateYear = options.years[0];\n  }\n  \n  var vis = this;\n  // empty object to hold filtered data\n  vis.displayData = vis.data.map(function(state) {\n    // filter out years falling beyond given date range\n    return {\n      id: state.id,\n      death_rate: state.years.reduce(function(prev, year) {\n        return prev + (year.year.getTime() == deathRateYear.getTime() ? year.death_rate : 0);\n      }, 0)\n    };\n  });\n}\n\n\n/**\n * Updates the visualization according to the new data year\n * Accepted Options:\n *  years:    An array of year objects where the first year corresponds with \n *            death rate data\n *  duration: The duration (in milliseconds) that transitions should last\n *\n * @param options Options for redrawing the visualization \n * @return Choropleth\n */\nChoropleth.prototype.update = function(options) {\n  var vis = this;\n  vis.wrangleData(options);\n  \n  var duration = options.duration ? options.duration : vis.default.duration;\n  // change colors domain\n  colors.domain([0, 1, 5, 10, 15, 20]);\n  var keyRects = vis.key.selectAll('rect').data(colors.domain());\n  keyRects.enter().append('rect')\n    .classed('key-rect', true);\n  keyRects.transition().duration(duration)\n    .attr('x', function(d, i) { return i * vis.keyWidth; })\n    .attr('y', vis.keyRectHeight)\n    .attr('width', vis.keyWidth)\n    .attr('height', vis.keyRectHeight)\n    .attr('fill', function(d) { return colors(d); });\n  \n  var keyLabels = vis.key.selectAll('.key-label').data(colors.domain())\n  keyLabels.enter().append('text')\n    .classed('key-label', true);\n  keyLabels.transition().duration(duration)\n    .text(function(d, i) { \n      if (i == colors.domain().length - 1) return d +'+';\n      return d; \n    })\n    .attr('x', function(d,i) { return i * vis.keyWidth + 2;})\n    .attr('y', vis.keyLabelOffset())\n    .attr('font-size', vis.fontSize());\n    \n  \n  vis.states = vis.graph.selectAll('path')\n    .data(topojson.feature(vis.topo, vis.topo.objects.usa).features);\n  vis.states.enter()\n    .append('path')\n      .classed('state', true)\n      .on('mouseover', function(d) { vis.highlightState(d); })\n      .on('mouseout', function(d) { vis.unhighlightState(d); });\n  vis.states.transition().duration(duration)\n    .attr('d', vis.path)\n    .attr('fill', function(d, i) { \n      return colors(vis.displayData[i].death_rate); });\n  \n  return vis;\n}\n\n\n/*--------------------*\n *** EVENT HANDLERS ***\n *--------------------*/\n\n/**\n * Responds to resize events by calling the visualization's resize method\n */\nChoropleth.prototype.handleResize = function(event) {\n  this.resize();\n}\n\n/**\n * Handles update events by calling the visualizations update method\n */\nChoropleth.prototype.handleUpdate = function(event) {\n  this.update(event.options);\n}\n\n/**\n * Draws a highlight around the given state and broadcasts the highlight event\n *\n * @param d The state topojson path that triggered the highlight event\n */\nChoropleth.prototype.highlightState = function(d) {\n  this.drawHighlight(d).eventHandler().broadcast({ name: 'mouseoverState', id: d.id }, this);\n}\n\n/**\n * Removes the highlight from the given state and broadcasts the unhighlight \n * event\n *\n * @param d The state topojson path that triggered the unhighlight event\n */\nChoropleth.prototype.unhighlightState = function(d) {\n  this.removeHighlight(d).eventHandler().broadcast({ name: 'mouseoutState', id: d.id }, this);\n}\n\n/**\n * Draws a red ring around the highlighted state\n *\n * @param d The path of the state being highlighted\n * @return Choropleth\n */\nChoropleth.prototype.drawHighlight = function(d) {\n  var vis = this;\n  vis.states.filter(function(state) { return state.id == d.id})\n    .classed('highlighted', true);\n  return vis;\n}\n\n/**\n * Removes the red ring from the unhighlighted state\n *\n * @param d The path of the state having its highlight removed\n * @return Choropleth\n */\nChoropleth.prototype.removeHighlight = function(d) {\n  var vis = this;\n  this.states.filter(function(state) { return state.id == d.id; })\n    .classed('highlighted', false);\n  return vis;\n}\n\n\n\n/**\n * Creates a new EventHanlder object\n *\n * @return EventHandler\n */\nfunction EventHandler() {\n  this.listeners = {};\n}\n\n/**\n * Adds an event listener for events with the given name. Note that\n * this method does not check for uniqueness. If a listener registers\n * for an event multiple times it will receive multiple notifications\n * when the event occurs.\n *\n * @param eventName   The name of the event being listened for\n * @param listener    The object interested in listening for the event\n * @param callback    The callback for handling the event, which is passed\n *                    to the callback as the only parameter\n *\n * @return EventHandler\n */\nEventHandler.prototype.on = function(eventName, listener, callback) {\n  var listeners = this.listeners[eventName];\n  if (!listeners) {\n    listeners = [];\n  }\n  listeners.push({listener: listener, callback: callback.bind(listener)});\n  this.listeners[eventName] = listeners;\n  \n  return this;\n}\n\n/**\n * Informs all interested listeners of the occurrence of a given event. \n * If the caller provides a value for sender, the sender will not be \n * informed of the event.\n *\n * @param event   An object containing important event properties. \n *                'name' is the only required property.\n * @param sender  (Optional) The object that broadcast the event. If \n *                specified then the sender will not have any of its\n *                callbacks fired.\n *\n * @return EventHandler\n */\nEventHandler.prototype.broadcast = function(event, sender) {\n  var listeners = this.listeners[event.name];\n  if (listeners) {\n    listeners.forEach(function(listener) {\n      if (listener.listener != sender) {\n        listener.callback(event);\n      }\n    });\n  }\n  return this;\n}\n\n// code found at http://bl.ocks.org/benvandyke/8459843\nfunction Regression() {\n  this.xSeries = function(xSeries) {\n    if (!xSeries) {\n      return this._xSeries;\n    }\n    \n    this._xSeries = xSeries;\n    return this;\n  };\n  \n  this.ySeries = function(ySeries) {\n    if (!ySeries) {\n      return this._ySeries;\n    }\n    \n    this._ySeries = ySeries;\n    return this;\n  };\n  \n  this.reduceSum = function(prev, cur) {\n    return prev + cur;\n  };\n  \n  this.coefficients = function() {\n    var self = this;\n    var xBar = this._xSeries.reduce(this.reduceSum) * 1.0 / this._xSeries.length;\n    var yBar = this._ySeries.reduce(this.reduceSum) * 1.0 / this._ySeries.length;\n\n    var ssXX = this._xSeries.map(function(d) { return Math.pow(d - xBar, 2); })\n      .reduce(this.reduceSum);\n    \n    var ssYY = this._ySeries.map(function(d) { return Math.pow(d - yBar, 2); })\n      .reduce(this.reduceSum);\n      \n    var ssXY = this._xSeries.map(function(d, i) { return (d - xBar) * (self._ySeries[i] - yBar); })\n      .reduce(this.reduceSum);\n      \n    var slope = ssXY / ssXX;\n    var intercept = yBar - (xBar * slope);\n    var rSquare = Math.pow(ssXY, 2) / (ssXX * ssYY);\n    \n    return [slope, intercept, rSquare];\n  };\n}\n\n/*--------------------*\n *** INITIALIZATION ***\n *--------------------*/\n\n/**\n * Creates a new Scatterplot visualization\n *\n * @param parentElem    The ID of the DOM element within which the visualization\n *                      should be drawn.\n * @param handler       The event handler for the visualization\n * @param deaths        An array of death data sorted alphabetically by state\n * @param income        An array of income data sorted alphabetically by state\n * @param unemployment  An array of unemployment data sorted alphabetically by \n *                      state\n * @return Scatterplot\n */\nfunction Scatterplot(parentElem, factor, deaths, income, unemployment) {\n  this.parentElem = parentElem;\n  this.data = {\n    'death_rate': {\n      data: deaths,\n      name: 'Deaths Per 100,000',\n      format: formatIdentity,\n      domain: [\n        d3.min(deaths, function(d) { return d3.min(d.years, function(d) {return d.death_rate; }); }),\n        d3.max(deaths, function(d) { return d3.max(d.years, function(d) {return d.death_rate; }); })\n      ]\n    },\n    'median_income': {\n      data: income,\n      name: 'Median Income ($1000)',\n      shortName: 'Median Income',\n      format: formatDecimal,\n      domain: [\n        d3.min(income, function(d) { return d3.min(d.years, function(d) {return d.median_income; }); }),\n        d3.max(income, function(d) { return d3.max(d.years, function(d) {return d.median_income; }); })\n      ]\n    },\n    'unemployment': {\n      data: unemployment,\n      name: 'Unemployment Rate',\n      shortName: 'Unemployment Rate',\n      format: formatPercent,\n      domain: [\n        d3.min(unemployment, function(d) { return d3.min(d.years, function(d) {return d.unemployment; }); }),\n        d3.max(unemployment, function(d) { return d3.max(d.years, function(d) {return d.unemployment; }); })\n      ]\n    }\n  };\n  \n  this.factor = factor;\n  this.factorYear = parseYear('2014');\n  this.deathRateYear = parseYear('2014');\n  \n  this.displayData = {};\n  this.regression = new Regression();\n  \n  this.sizeGroup = \"medium\";\n  this.default = {\n    duration: 1000\n  }\n}\n\n/**\n * If a handler is specified the Scatterplot updates its event handler and \n * registers listeners for the events for which it's interested. The receiving\n * object is returned.\n * If no handler is given returns the objects current handler.\n *\n * @param handler (Optional) The event handler for the object\n * @return EventHandler|Scatterplot\n */\nScatterplot.prototype.eventHandler = function(handler) {\n  if (handler) {\n    this._eventHandler = handler;\n    this._eventHandler.on('update', this, this.handleUpdate);\n    this._eventHandler.on('resize', this, this.handleResize);\n    this._eventHandler.on('mouseoverState', this, this.drawHighlight);\n    this._eventHandler.on('mouseoutState', this, this.removeHighlight);\n  \n    return this;\n  }\n  return this._eventHandler;\n}\n\n/**\n * Initalizes the visualization by appending and sizing the containing SVG \n * before defining scales and axes. Should only be called once on a given \n * scatter plot.\n *\n * @return Scatterplot\n */\nScatterplot.prototype.initVis = function() {\n  // grab reference to self\n  var vis = this;\n  \n  /*** SVG DRAWING AREA ***/\n  vis.margin = {top: 20, right: 20, bottom: 40, left: 70};\n  vis.padding = {x: 10, y: 10};\n      \n  vis.svg = d3.select('#'+vis.parentElem).append('svg');\n  vis.graph = vis.svg.append('g');\n  \n  vis.title = vis.graph.append('text')\n    .text('What Factors Influence Drug Deaths?')\n    .attr('text-anchor', 'middle')\n    .attr('font-weight', 'bold');\n      \n  /*** CHART DATA ELEMENTS ***/\n  vis.scatter = vis.graph.append('g')\n    .classed('scatter-plot', true);\n    \n  vis.bfl = vis.graph.append('g')\n    .classed('best-fit', true);\n    \n  vis.x = d3.scale.linear();\n  vis.y = d3.scale.linear();\n    \n  /*** CHART AXES ***/\n  vis.xAxisG = vis.graph.append('g')\n    .classed('axis x-axis', true);\n    \n  vis.yAxisG = vis.graph.append('g')\n    .classed('axis y-axis', true);\n    \n  vis.xAxis = d3.svg.axis()\n    .scale(vis.x)\n    .ticks(6)\n    .orient('bottom');\n    \n  vis.yAxis = d3.svg.axis()\n    .scale(vis.y)\n    .orient('left');\n    \n  vis.xTitle = vis.xAxisG.append('text')\n    .classed('axis-label', true)\n    .attr('text-anchor', 'middle');\n    \n  vis.yTitle = vis.yAxisG.append('text')\n    .classed('axis-label', true)\n    .attr('transform', 'rotate(-90)')\n    .attr('text-anchor', 'middle')\n    .text('Deaths per 100,000');\n    \n  vis.stateTip = d3.tip()\n    .attr('class', 'd3-tip')\n    .direction('s')\n    .offset([5,0])\n    .html(function(d) {\n      return ''+\n        '<h4>'+ d.id +'</h4><p>'+\n          '<span class=\"tip-header\">Death Rate: <span class=\"death-rate\">'+ \n            d.death_rate +'</span></span><br>'+\n          '<span class=\"tip-header\">'+ vis.data[vis.factor].name +\n            ': <span class=\"factor\">'+ vis.data[vis.factor].format(d.factor) +'</span></span></p>';\n    });\n  vis.graph.call(vis.stateTip);\n  \n  vis.bflTip = d3.tip()\n    .attr('class', 'd3-tip')\n    .direction('s')\n    .offset([5,0])\n    .html(function(d) {\n      return ''+\n        '<span class=\"tip-header\">Death Rate <span class=\"tip-death-rate\">('\n          + formatYear(vis.deathRateYear) +')</span></span><br>'+\n        '<span class=\"tip-header\">'+ vis.data[vis.factor].shortName +\n          ' <span class=\"tip-factor\">('+ formatYear(vis.factorYear) +')</span></span><br>'+\n        '<span class=\"tip-header\">Correlation: '+ formatDecimal(d.correlation.toFixed(2)) +'</span>';\n    });\n  vis.graph.call(vis.bflTip);\n  \n  vis.resize();\n  \n  // return vis for chaining\n  return vis;\n}\n\n/*------------*\n *** SIZING ***\n *------------*/\n\nScatterplot.prototype.labelFontSize = function() {\n  if (this.sizeGroup == 'medium') return '10pt'; \n  return '8pt';\n}\n\nScatterplot.prototype.yAxisTicks = function() {\n  if (this.sizeGroup == 'medium') return 10;\n  return 4;\n}\n\n/**\n * Resizes the visualization according to its parent within the DOM. \n *\n * @return Scatterplot\n */\nScatterplot.prototype.resize = function() {\n  var vis = this;\n  \n  // grab width of current container\n  vis.width = parseInt(d3.select('#'+vis.parentElem).style('width')) - vis.margin.left - vis.margin.right;\n  vis.height = vis.width;\n  \n  // update size group\n  vis.sizeGroup = (vis.width > 256) ? 'medium' : 'small';\n    \n  // resize svg, reset margin\n  vis.svg.attr('width', vis.width + vis.margin.left + vis.margin.right)\n    .attr('height', vis.height + vis.margin.top + vis.margin.bottom);\n  vis.graph.attr('transform', 'translate('+ vis.margin.left +','+ vis.margin.top +')');\n  \n  vis.title.attr('x', vis.width/2)\n    .attr('y', 6)\n    .attr('font-size', vis.labelFontSize());\n  // change scale drawing range\n  vis.x.range([vis.padding.x, vis.width-vis.padding.x]);\n  vis.y.range([vis.height-vis.padding.y, vis.padding.y]);\n  // update axis offests and title positions\n  vis.xAxisG.attr('transform', 'translate(0, '+ vis.height +')');\n  vis.xTitle.attr('x', vis.width/2)\n    .attr('y', vis.margin.bottom-2);\n    \n  vis.yAxis.ticks(vis.yAxisTicks());\n  vis.yTitle.attr('x', -vis.width/2)\n    .attr('y', -vis.margin.left * (3/4) );\n  \n  // update vis with default options now that svg has been resized\n  vis.update(vis.default);\n  \n  // return vis for chaining\n  return vis;\n}\n\n\n/*---------------------------*\n *** DRAWING VISUALIZATION ***\n *---------------------------*/\n\n/**\n * Filters the visualizations data by year according to the given options \n * Accepted Options:\n *  year: The year for which to show data on the x axis\n *\n * @param options (Optional) An object containing options for manipulating data \n * @return Scatterplot\n */\nScatterplot.prototype.wrangleData = function(options) {\n  var vis = this;\n  \n  if (!options) {\n    // create local shadow variable so shared object doesn't change\n    var options = {};\n  }\n  \n  vis.deathRateYear = options.years ? options.years[0] : vis.deathRateYear; \n  vis.factorYear = options.years ? options.years[1] : vis.factorYear;\n  vis.factor = options.factor ? options.factor : vis.factor;\n  \n  // wrangled data is placed into variable displayData\n  vis.displayData = vis.data[vis.factor].data.reduce(function(prev, current, i) {\n    // skip any national data\n    if (current.id === 'United States') {\n      return prev;\n    }\n    \n    // grab corresponding state death and factor data\n    var deaths = vis.data['death_rate'].data[i];\n    var factorData = vis.data[vis.factor].data[i];\n    \n    // get data only from specified year\n    deathYearData = deaths.years.filter(function(y) { \n      return y.year.getTime() == vis.deathRateYear.getTime(); })[0];\n    factorYearData = factorData.years.filter(function(y) {\n      return y.year.getTime() == vis.factorYear.getTime(); })[0];\n    \n    // add an object with the state's data to the array\n    prev.push({\n      id: current.id,\n      death_rate: deathYearData.death_rate,\n      factor: factorYearData[vis.factor]\n    });\n    return prev; \n  }, []);\n  \n  // return vis for chaining\n  return vis;\n}\n\n/**\n * Updates the visualization by updating display data according to the given\n * options and redrawing the scatterplot accordingly.\n * Accepted Options:\n *  year: The year to use when drawing the x axis (default is most recent)\n *  duration: The duration of any trasnitions (default is 0)\n *\n * @param options The options for updating the scatterplot.\n * @return Scatterplot\n */\nScatterplot.prototype.update = function(options) {\n  var vis = this;\n  \n  // update display data\n  vis.wrangleData(options);\n  \n  var duration = options.duration ? options.duration : vis.default.duration;\n  // update x and y domains according to new data\n  vis.x.domain(vis.data[vis.factor].domain);\n  vis.y.domain([0, 35]);\n  \n  // redraw axes\n  vis.xTitle\n    .html(vis.data[vis.factor].name +\n      ' <tspan class=\"factor\">('+ formatYear(vis.factorYear) +')</tspan>')\n    .attr('font-size', vis.labelFontSize());\n    \n  vis.yTitle\n    .html(vis.data.death_rate.name +\n      ' <tspan class=\"death_rate\">('+ formatYear(vis.deathRateYear) +')</tspan>')\n    .attr('font-size', vis.labelFontSize());\n  \n  vis.xAxis.tickFormat(vis.data[vis.factor].format);\n  vis.xAxisG.transition().duration(duration)\n    .call(vis.xAxis);\n  vis.yAxisG.transition().duration(duration)\n    .call(vis.yAxis);\n  // update scatter plot dots data\n  vis.dots = vis.scatter.selectAll('circle').data(vis.displayData);\n  // draw any new dots \n  vis.dots.enter()\n    .append('circle')\n      .attr('class', function(d) { return 'dot '+d.id.replace(' ', ''); })\n      .attr('r', 5)\n      .on('mouseover', vis.highlightState.bind(vis))\n      .on('mouseout', vis.unhighlightState.bind(vis));\n  // move existing dots into new position according to display data  \n  vis.dots.transition().duration(duration)\n    .attr('cx', function(d) { return vis.x(d.factor); })\n    .attr('cy', function(d) { return vis.y(d.death_rate); })\n    .attr('fill', function(d) { return colors(d.death_rate)});\n      \n  // get variables to pass to regression calculator\n  var xSeries = vis.displayData.map(function(d) { return d.factor; });\n  var ySeries = vis.displayData.map(function(d) { return d.death_rate;});\n  var coeff = vis.regression.xSeries(xSeries)\n    .ySeries(ySeries)\n    .coefficients();\n  \n  // calculate best fit line path\n  var bflData = [{x1: vis.x.domain()[0], y1: coeff[1],\n                  x2: vis.x.domain()[1], y2: coeff[0] * vis.x.domain()[1] + coeff[1],\n                  correlation: Math.sqrt(coeff[2])}];\n  var regLine = vis.bfl.selectAll('line').data(bflData);\n  // append best fit line (if necessary) or redraw with new data\n  regLine.enter().append('line')\n    .classed('best-fit', true)\n    .on('mouseover', vis.bflTip.show)\n    .on('mouseout', vis.bflTip.hide);\n  regLine.transition().duration(duration)\n    .attr('x1', function(d) { return vis.x(d.x1); })\n    .attr('y1', function(d) { return vis.y(d.y1); }) \n    .attr('x2', function(d) { return vis.x(d.x2); })\n    .attr('y2', function(d) { return vis.y(d.y2); });\n}\n\n/*--------------------*\n *** EVENT HANDLERS ***\n *--------------------*/\n\n/**\n * Handles 'resize' events by calling the visualizations resize method. \n *\n * @param event The event object\n */\nScatterplot.prototype.handleResize = function(event) {\n  this.resize();\n}\n \n/**\n * Handles 'update' events by calling the visualizations 'update' method\n *\n * @param event The event object created by the object that fired the event\n */\nScatterplot.prototype.handleUpdate = function(event) {\n  this.update(event.options);\n}\n\n\n/**\n * Draws a red ring around highlighted dot and increases its size\n *\n * @return Scatterplot\n */\nScatterplot.prototype.drawHighlight = function(d) {\n  var vis = this;\n  vis.dots.filter(function(state) { return state.id == d.id; })\n    .classed('highlighted', true)\n    .attr('r', 10);\n  vis.stateTip.show(vis.displayData[vis.stateIndex(d)]);\n  // return vis for chaining\n  return vis;\n}\n\n/**\n * Removes red ring around highlighted state and reduces its size back to the \n * starting amount.\n *\n * @return Scatterplot\n */\nScatterplot.prototype.removeHighlight = function(d) {\n  var vis = this;\n  vis.dots.filter(function(state) { return state.id == d.id; })\n    .classed('highlighted', false)\n    .attr('r', 5);\n  vis.stateTip.hide();\n  // return vis for chaining\n  return vis;\n}\n\n/**\n * Draws highlight around selected state and broadcasts event \n *\n * @param d The dot of the state being highlighted\n */\nScatterplot.prototype.highlightState = function(d) {\n  this.drawHighlight(d).eventHandler().broadcast({ name: 'mouseoverState', id: d.id }, this);\n}\n\n/**\n * Removes highlight from deselected state and broadcasts event\n *\n * @param d The dot of the state having its highlight removed\n */\nScatterplot.prototype.unhighlightState = function(d) {\n  this.removeHighlight(d).eventHandler().broadcast({ name: 'mouseoutState', id: d.id }, this);\n}\n\nScatterplot.prototype.stateIndex = function(d) {\n  for (var i = 0; i < this.displayData.length; i++) {\n    if (this.displayData[i].id == d.id) return i;\n  }\n  return 0;\n}\nfunction YearSlider(parentElem, range) {\n  this.parentElem = parentElem;\n  this.range = range;\n  this.years = d3.range(range[0], range[1]+1);\n  this.topYear = range[1];\n  this.bottomYear = range[1];\n  \n  this.colors = {\n    markers: {\n      top: {\n        hover: '#756BB1',\n        normal: '#54278F'\n      },\n      bottom: {\n        hover: '#6CD16C',\n        normal: '#23A923' \n      }\n    }\n  };\n}\n\nYearSlider.prototype.question = function(text) {\n  if (text) {\n    this.descriptiveText = text;\n    return this;\n  }\n  \n  return this.descriptiveText;\n}\n\nYearSlider.prototype.eventHandler = function(handler) {\n  if (handler) {\n    this._eventHandler = handler;\n    this._eventHandler.on('resize', this, this.handleResize);\n    \n    return this;\n  }\n  \n  return this._eventHandler;\n}\n\nYearSlider.prototype.initVis = function() {\n  // grab reference to vis\n  var vis = this;\n  \n  /*** SIZES AND SVG ***/\n  vis.margin = { top: 10, right: 20, bottom: 10, left: 20};\n  vis.marker = {radius: 10};\n  vis.axis = {tick: {height: 10}};\n  \n  vis.svg = d3.select('#'+vis.parentElem).append('svg');\n  vis.slider = vis.svg.append('g');\n  \n  /*** SLIDER TEXT ***/\n  vis.topText = vis.slider.append('text')\n    .classed('axis-label top', true)\n    .text('Death Rate')\n    .attr('text-anchor', 'middle');\n  vis.bottomText = vis.slider.append('text')\n    .classed('axis-label bottom', true)\n    .text('Factor Data')\n    .attr('text-anchor', 'middle');\n  \n  /*** SCALE ***/\n  vis.x = d3.scale.linear()\n    .domain(vis.range);\n  \n  /* * DRAWING GROUPS ***/\n  vis.yearsText = vis.slider.append('g').classed('years', true);\n  \n  vis.topSlider = vis.slider.append('g').classed('slider top', true);\n  vis.bottomSlider = vis.slider.append('g').classed('slider bottom', true);\n  \n  vis.topAxis = vis.topSlider.append('g').classed('axis top-axis', true);\n  vis.bottomAxis = vis.bottomSlider.append('g').classed('axis bottom', true);\n    \n  vis.topAxisLine = vis.topAxis.append('line').attr('stroke-width', 4);\n  vis.bottomAxisLine = vis.bottomAxis.append('line').attr('stroke-width', 4);\n  \n  vis.questionButton = vis.slider.append('text')\n    .classed('slider question', true)\n    .html('&#xf29c')\n    .on('click', function(d) {vis.questionClicked();});\n  \n  vis.yearsText.selectAll('text')\n    .data(vis.years).enter()\n    .append('text')\n      .text(function(d) { return d; })\n      .attr('text-anchor', 'middle')\n      .attr('transform', 'rotate(90)')\n  \n  /*** DRAG BEHAVIOR ***/\n  vis.dragTopMarker = d3.behavior.drag()\n    .on('dragstart', function(d) { vis.topMarkerStartedDragging(d); })\n    .on('drag', function(d) { vis.markerDragged(d); })\n    .on('dragend', function(d) { vis.markerEndedDragging(d); });\n  vis.dragBottomMarker = d3.behavior.drag()\n    .on('dragstart', function(d) { vis.bottomMarkerStartedDragging(d); })\n    .on('drag', function(d) { vis.markerDragged(d); })\n    .on('dragend', function(d) { vis.markerEndedDragging(d); });\n  \n  // resize within bounds\n  vis.resize();\n\n  // return vis for chaining\n  return vis;\n}\n\nYearSlider.prototype.resize = function() {\n  // grab reference to vis\n  var vis = this;\n  \n  // update width with new parameters\n  vis.width = parseInt(d3.select('#'+vis.parentElem).style('width')) - vis.margin.left - vis.margin.right;\n  vis.height = (1/3) * vis.width;\n  \n  /*** RESIZE SVG AND MAIN GROUP ***/\n  vis.svg\n    .attr('width', vis.width + vis.margin.left + vis.margin.right)\n    .attr('height', vis.height + vis.margin.top + vis.margin.bottom);\n  vis.slider\n    .attr('transform', 'translate('+ vis.margin.left +','+ vis.margin.top +')');\n    \n  vis.topText.attr('x', vis.width/2)\n    .attr('y', 10);\n  vis.bottomText.attr('x', vis.width/2)\n    .attr('y', 95);\n  /*** UPDATE SCALE ***/\n  vis.x.range([0, vis.width]);\n  \n  /*** RESIZE DRAWING GROUPS ***/\n  vis.topSlider.attr('transform', 'translate(0,'+ Math.floor(vis.height / 4) +')');\n  vis.bottomSlider.attr('transform', 'translate(0,'+ vis.height / 4 * 3 +')');\n  \n  vis.topAxisLine\n    .attr('x0', 0)\n    .attr('x1', vis.width);\n  vis.bottomAxisLine\n    .attr('x0', 0)\n    .attr('x1', vis.width);\n  \n  vis.yearsText\n    .attr('transform', 'translate(0,'+ vis.height/2 +')');     \n    \n  vis.yearsText.selectAll('text')\n    .attr('y', function(d) { return -vis.x(d) + 4; });\n  \n  vis.questionButton.attr('x', vis.width)\n    .attr('y', vis.height + 5);\n  \n  // update visualization now that size is set\n  vis.update();\n  \n  // return vis for chaining\n  return vis;\n}\n\nYearSlider.prototype.update = function() {\n  var vis = this;\n  \n  vis.updateMarkers();\n  vis.updateText();\n}\n\nYearSlider.prototype.updateText = function() {\n  var vis = this;\n  \n  var maxYear = d3.max([vis.topYear, vis.bottomYear]);\n  var minYear = d3.min([vis.topYear, vis.bottomYear]);\n  \n  vis.yearsText.selectAll('text')\n    .attr('font-weight', function(d) {\n      return (d >= minYear && d <= maxYear) ? 'bold' : 'lighter';\n    });\n}\n\nYearSlider.prototype.updateMarkers = function() {\n  var vis = this;\n  \n  var topMarker = vis.topSlider.selectAll('circle').data([vis.topYear]);\n  // enter\n  topMarker.enter()\n    .append('circle')\n      .attr('r', vis.marker.radius)\n      .on('mouseover', function() {vis.changeMarkerColor(topMarker, vis.colors.markers.top.hover);})\n      .on('mouseout', function() {vis.changeMarkerColor(topMarker, vis.colors.markers.top.normal);})\n      .call(vis.dragTopMarker);\n  // update  \n  topMarker.transition().duration(250)\n    .attr('cx', vis.x);\n    \n  var bottomMarker = vis.bottomSlider.selectAll('circle').data([vis.bottomYear]);\n  // enter\n  bottomMarker.enter()\n    .append('circle')\n      .attr('r', vis.marker.radius)\n      .on('mouseover', function() {vis.changeMarkerColor(bottomMarker, vis.colors.markers.bottom.hover);})\n      .on('mouseout', function() {vis.changeMarkerColor(bottomMarker, vis.colors.markers.bottom.normal);})\n      .call(vis.dragBottomMarker);\n  // update\n  bottomMarker.transition().duration(250)\n    .attr('cx', vis.x);\n}\n\nYearSlider.prototype.changeMarkerColor = function(marker, color) {\n  marker.attr('fill', color);\n}\n\nYearSlider.prototype.handleResize = function(event) {\n  this.resize();\n}\n\n/***--------------------------***\n *** MARKER DRAGGING BEHAVIOR ***\n ***--------------------------***/\n \nYearSlider.prototype.topMarkerStartedDragging = function(d) {\n  this.draggingSlider = 'topSlider';\n  this.draggingYear = 'topYear';\n  this.markerStartedDragging(d);\n}\n\nYearSlider.prototype.bottomMarkerStartedDragging = function(d) {\n  this.draggingSlider = 'bottomSlider';\n  this.draggingYear = 'bottomYear';\n  this.markerStartedDragging(d);\n}\n\nYearSlider.prototype.markerStartedDragging = function(d) {\n  this[this.draggingSlider].selectAll('circle').classed('dragging', true);\n}\n\nYearSlider.prototype.markerDragged = function(d) {\n  var vis = this;\n  // redraw objects as drag moves\n  // dragging should not extend objects outside of the slider's svg\n  var x = d3.min([d3.max([d3.event.x, 0]), vis.width]);\n  vis[vis.draggingSlider].select('circle').attr('cx', x);\n  vis[vis.draggingYear] = Math.round(vis.x.invert(x));\n  vis.updateText();\n}\n\nYearSlider.prototype.markerEndedDragging = function(d) {\n  // set new year values and call update to animate transition into stopping point\n  // broadcast new year values\n  this[this.draggingSlider].selectAll('circle').classed('dragging', false);\n  this.updateMarkers();\n  this.eventHandler().broadcast({\n    name:'update', \n    options:{\n      years: [parseYear(this.topYear.toString()), parseYear(this.bottomYear.toString())]\n    }\n  });\n}\n\nYearSlider.prototype.questionClicked = function() {\n  this.eventHandler().broadcast({\n    name:'question-clicked',\n    options: {}\n  });\n}\n\n\n\n\n\n\n\n\n\n\n\n\n"],"sourceRoot":"/source/"}