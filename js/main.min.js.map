{"version":3,"sources":["main.min.js"],"names":["loadData","error","topo","deaths","income","unemployment","console","log","objects","usa","geometries","sort","a","b","id","forEach","state","years","year","death_rate","population","parseYear","median_income","dataLoaded","createVis","choropleth","Choropleth","eventHandler","handler","initVis","scatterplot","Scatterplot","yearSlider","YearSlider","on","this","displaySliderDescription","updateFactor","factor","options","duration","broadcast","name","$","modal","parentElem","data","displayData","sizeGroup","EventHandler","listeners","Regression","xSeries","_xSeries","ySeries","_ySeries","reduceSum","prev","cur","coefficients","self","xBar","reduce","length","yBar","ssXX","map","d","Math","pow","ssYY","ssXY","i","slope","intercept","rSquare","format","formatIdentity","domain","d3","min","max","shortName","formatCurrency","formatPercent","factorYear","deathRateYear","regression","loadStackedArea","margin","top","right","bottom","left","width","parseInt","select","style","height","parseDate","time","parse","x","scale","range","y","linear","axisYScale","color","category20","xAxis","svg","axis","orient","yAxis","tickFormat","area","date","y0","y1","stack","layout","values","append","text","selectAll","remove","legend","attr","tsv","keys","filter","key","substances","extent","legendElements","enter","substance","tip","show","hide","call","html","makeTable","table","number","getFullYear","replace","changeToOther","title","change","loadTreemap","root","node","year_index","treemap","round","size","sticky","value","brushedSlider","json","getNames","items","brushed","brush","event","sourceEvent","sliderX","invert","mouse","nodes","zoom","handle","kx","dx","ky","dy","t","transition","altKey","w","type","stopPropagation","children","cell","parent","getComputedTextLength","window","clamp","tickSize","tickPadding","parentNode","appendChild","cloneNode","slider","topYear","bottomYear","colors","markers","hover","normal","formatYear","str","colorbrewer","Purples","unshift","quantile","d3_queue","queue","defer","await","prototype","_eventHandler","handleUpdate","handleResize","drawHighlight","removeHighlight","vis","keyHeight","keyRectHeight","classed","graph","keyTitle","projection","geo","albersUsa","path","resize","keyWidth","floor","translate","update","keyLabelOffset","fontSize","wrangleData","getTime","keyRects","keyLabels","states","topojson","feature","features","highlightState","unhighlightState","eventName","listener","callback","push","bind","sender","padding","scatter","bfl","xAxisG","yAxisG","ticks","xTitle","yTitle","stateTip","direction","offset","bflTip","correlation","labelFontSize","yAxisTicks","current","factorData","deathYearData","factorYearData","dots","coeff","bflData","x1","x2","y2","sqrt","regLine","highlightBFL","unhighlightBFL","stateIndex","question","descriptiveText","marker","radius","tick","yearsText","topSlider","bottomSlider","topAxis","bottomAxis","topAxisLine","bottomAxisLine","topText","bottomText","questionButton","questionClicked","dragTopMarker","behavior","drag","topMarkerStartedDragging","markerDragged","markerEndedDragging","dragBottomMarker","bottomMarkerStartedDragging","updateMarkers","updateText","maxYear","minYear","topMarker","changeMarkerColor","bottomMarker","draggingSlider","draggingYear","markerStartedDragging","toString"],"mappings":"AA4BA,QAASA,UAASC,EAAOC,EAAMC,EAAQC,EAAQC,GACzCJ,EACFK,QAAQC,IAAIN,IAEZC,EAAKM,QAAQC,IAAIC,WAAWC,KAAK,SAASC,EAAEC,GAC1C,MAAID,GAAEE,GAAKD,EAAEC,GAAW,GACpBF,EAAEE,GAAKD,EAAEC,GAAW,EACjB,IAITX,EAAOY,QAAQ,SAASC,GACtBA,EAAMC,MAAMF,QAAQ,SAASG,GAC3BA,EAAKC,YAAcD,EAAKC,WACxBD,EAAKf,QAAUe,EAAKf,OACpBe,EAAKE,YAAcF,EAAKE,WACxBF,EAAKA,KAAOG,UAAUH,EAAKA,UAI/Bd,EAAOW,QAAQ,SAASC,GACtBA,EAAMC,MAAMF,QAAQ,SAASG,GAC3BA,EAAKI,eAAiBJ,EAAKI,cAAgB,IAC3CJ,EAAKA,KAAOG,UAAUH,EAAKA,UAI/Bb,EAAaU,QAAQ,SAASC,GAC5BA,EAAMC,MAAMF,QAAQ,SAASG,GAC3BA,EAAKb,cAAgBa,EAAKb,aAC1Ba,EAAKA,KAAOG,UAAUH,EAAKA,UAI/BK,YAAa,EAEbC,UAAUtB,EAAMC,EAAQC,EAAQC,IAYpC,QAASmB,WAAUtB,EAAMC,EAAQC,EAAQC,GAEvCoB,WAAa,GAAIC,YAAW,aAAcxB,EAAMC,GAChDsB,WAAWE,aAAaC,SAASC,UAEjCC,YAAc,GAAIC,aAAY,cAAe,gBAAiB5B,EAAQC,EAAQC,GAC9EyB,YAAYH,aAAaC,SAASC,UAElCG,WAAa,GAAIC,YAAW,eAAgB,KAAM,OAClDD,WAAWL,aAAaC,SAASC,UACjCD,QAAQM,GAAG,mBAAoBC,KAAMC,0BAIvC,QAASC,cAAaC,GAChBf,aAEFgB,SACED,OAAQA,EACRE,SAAU,KAGZZ,QAAQa,WAAYC,KAAM,SAAUH,QAASA,WAIjD,QAASH,4BACPO,EAAE,iBAAiBC,QAerB,QAASlB,YAAWmB,EAAY3C,EAAM4C,GACpCX,KAAKU,WAAaA,EAClBV,KAAKjC,KAAOA,EACZiC,KAAKW,KAAOA,EACZX,KAAKY,eAELZ,KAAKa,UAAY,SACjBb,KAAAA,YACEK,SAAU,KA4Rd,QAASS,gBACPd,KAAKe,aAqDP,QAASC,cACPhB,KAAKiB,QAAU,SAASA,GACtB,MAAKA,IAILjB,KAAKkB,SAAWD,EACTjB,MAJEA,KAAKkB,UAOhBlB,KAAKmB,QAAU,SAASA,GACtB,MAAKA,IAILnB,KAAKoB,SAAWD,EACTnB,MAJEA,KAAKoB,UAOhBpB,KAAKqB,UAAY,SAASC,EAAMC,GAC9B,MAAOD,GAAOC,GAGhBvB,KAAKwB,aAAe,WAClB,GAAIC,GAAOzB,KACP0B,EAA8C,EAAvC1B,KAAKkB,SAASS,OAAO3B,KAAKqB,WAAmBrB,KAAKkB,SAASU,OAClEC,EAA8C,EAAvC7B,KAAKoB,SAASO,OAAO3B,KAAKqB,WAAmBrB,KAAKoB,SAASQ,OAElEE,EAAO9B,KAAKkB,SAASa,IAAI,SAASC,GAAK,MAAOC,MAAKC,IAAIF,EAAIN,EAAM,KAClEC,OAAO3B,KAAKqB,WAEXc,EAAOnC,KAAKoB,SAASW,IAAI,SAASC,GAAK,MAAOC,MAAKC,IAAIF,EAAIH,EAAM,KAClEF,OAAO3B,KAAKqB,WAEXe,EAAOpC,KAAKkB,SAASa,IAAI,SAASC,EAAGK,GAAK,OAAQL,EAAIN,IAASD,EAAKL,SAASiB,GAAKR,KACnFF,OAAO3B,KAAKqB,WAEXiB,EAAQF,EAAON,EACfS,EAAYV,EAAQH,EAAOY,EAC3BE,EAAUP,KAAKC,IAAIE,EAAM,IAAMN,EAAOK,EAE1C,QAAQG,EAAOC,EAAWC,IAoB9B,QAAS5C,aAAYc,EAAYP,EAAQnC,EAAQC,EAAQC,GACvD8B,KAAKU,WAAaA,EAClBV,KAAKW,MACH3B,YACE2B,KAAM3C,EACNuC,KAAM,qBACNkC,OAAQC,eACRC,QACEC,GAAGC,IAAI7E,EAAQ,SAASgE,GAAK,MAAOY,IAAGC,IAAIb,EAAElD,MAAO,SAASkD,GAAI,MAAOA,GAAEhD,eAC1E4D,GAAGE,IAAI9E,EAAQ,SAASgE,GAAK,MAAOY,IAAGE,IAAId,EAAElD,MAAO,SAASkD,GAAI,MAAOA,GAAEhD,iBAG9EG,eACEwB,KAAM1C,EACNsC,KAAM,wBACNwC,UAAW,gBACXN,OAAQO,eACRL,QACEC,GAAGC,IAAI5E,EAAQ,SAAS+D,GAAK,MAAOY,IAAGC,IAAIb,EAAElD,MAAO,SAASkD,GAAI,MAAOA,GAAE7C,kBAC1EyD,GAAGE,IAAI7E,EAAQ,SAAS+D,GAAK,MAAOY,IAAGE,IAAId,EAAElD,MAAO,SAASkD,GAAI,MAAOA,GAAE7C,oBAG9EjB,cACEyC,KAAMzC,EACNqC,KAAM,oBACNwC,UAAW,oBACXN,OAAQQ,cACRN,QACEC,GAAGC,IAAI3E,EAAc,SAAS8D,GAAK,MAAOY,IAAGC,IAAIb,EAAElD,MAAO,SAASkD,GAAI,MAAOA,GAAE9D,iBAChF0E,GAAGE,IAAI5E,EAAc,SAAS8D,GAAK,MAAOY,IAAGE,IAAId,EAAElD,MAAO,SAASkD,GAAI,MAAOA,GAAE9D,oBAKtF8B,KAAKG,OAASA,EACdH,KAAKkD,WAAahE,UAAU,QAC5Bc,KAAKmD,cAAgBjE,UAAU,QAE/Bc,KAAKY,eACLZ,KAAKoD,WAAa,GAAIpC,YAEtBhB,KAAKa,UAAY,SACjBb,KAAAA,YACEK,SAAU,KA4Yd,QAASgD,mBAEL,GAAIC,IAAUC,IAAK,GAAIC,MAAO,IAAKC,OAAQ,GAAIC,KAAM,KACjDC,EAAQC,SAAShB,GAAGiB,OAAO,iBAAiBC,MAAM,UAAYR,EAAOI,KAAOJ,EAAOE,MACnFO,EAAiB,IAARJ,EAAcL,EAAOC,IAAMD,EAAOG,OAE3CO,EAAYpB,GAAGqB,KAAKxB,OAAO,MAAMyB,MAGjCC,GAFgBvB,GAAGH,OAAO,OAEtBG,GAAGqB,KAAKG,QACXC,OAAO,EAAGV,KAEXW,EAAI1B,GAAGwB,MAAMG,SACZF,OAAON,EAAQ,IAEhBS,EAAa5B,GAAGwB,MAAMG,SACrB5B,QAAQ,EAAG,OACX0B,OAAON,EAAQ,IAGhBU,EAAQ7B,GAAGwB,MAAMM,aAEjBC,EAAQ/B,GAAGgC,IAAIC,OACdT,MAAMD,GACNW,OAAO,UAERC,EAAQnC,GAAGgC,IAAIC,OACdC,OAAO,QACPV,MAAMI,GACNQ,WAAWpC,GAAGH,OAAO,SAGtBwC,EAAOrC,GAAGgC,IAAIK,OACbd,EAAE,SAASnC,GAAK,MAAOmC,GAAEnC,EAAEkD,QAC3BC,GAAG,SAASnD,GAAK,MAAOsC,GAAEtC,EAAEmD,MAC5BC,GAAG,SAASpD,GAAK,MAAOsC,GAAEtC,EAAEmD,GAAKnD,EAAEsC,KAEpCe,EAAQzC,GAAG0C,OAAOD,QACjBE,OAAO,SAASvD,GAAK,MAAOA,GAAEuD,SAK/BX,GAHQhC,GAAGiB,OAAO,UACjB2B,OAAO,MACPC,KAAK,6DACA7C,GAAGiB,OAAO,iBACpBe,GAAIc,UAAU,KAAKC,QAEnB,IAAIC,GAAShD,GAAGiB,OAAO,iBAClB2B,OAAO,OACPK,KAAK,QAAS,UACdA,KAAK,QAASlC,EAAQL,EAAOI,KAAOJ,EAAOE,OAC3CqC,KAAK,SAAU9B,EAAO,GACtB8B,KAAK,YAAa,aAAevC,EAAOI,KAAO,OAGhDkB,EAAMhC,GAAGiB,OAAO,iBACf2B,OAAO,OACPK,KAAK,QAASlC,EAAQL,EAAOI,KAAOJ,EAAOE,OAC3CqC,KAAK,SAAU9B,EAAST,EAAOC,IAAMD,EAAOG,QAC5C+B,OAAO,KACPK,KAAK,YAAa,aAAevC,EAAOI,KAAO,IAAMJ,EAAOC,IAAM,IAEvEX,IAAGkD,IAAI,8BAA+B,SAAShI,EAAO6C,GAClD,GAAI7C,EAAO,KAAMA,EAEjB2G,GAAM9B,OAAOC,GAAGmD,KAAKpF,EAAK,IAAIqF,OAAO,SAASC,GAAO,MAAe,SAARA,KAE5DtF,EAAK/B,QAAQ,SAASoD,GAClBA,EAAEkD,KAAOlB,EAAUhC,EAAEkD,OAGzB,IAAIgB,GAAab,EAAMZ,EAAM9B,SAASZ,IAAI,SAASxB,GAC/C,OACIA,KAAMA,EACNgF,OAAQ5E,EAAKoB,IAAI,SAASC,GACtB,OAAQkD,KAAMlD,EAAEkD,KAAMZ,EAAGtC,EAAEzB,GAAM,WAM7C4D,GAAExB,OAAOC,GAAGuD,OAAOxF,EAAM,SAASqB,GAAK,MAAOA,GAAEkD,OAEhD,IAAIkB,GAAiBR,EAAOF,UAAU,KACjC/E,KAAKuF,GACLG,QAAQb,OAAO,SACfK,KAAK,QAAS,UACdA,KAAK,YAAa,aAAevC,EAAOI,KAAO,MAEpD0C,GAAeZ,OAAO,YACjBK,KAAK,IAAK,SAAS7D,EAAEK,GAClB,MAAOA,IAAW,GAANsB,GAAYuC,EAAiB,OAAG,KAC/CL,KAAK,IAAK,IACVA,KAAK,QAAS,IACdA,KAAK,SAAU,IACf/B,MAAM,OAAQ,SAAS9B,GAAK,MAAOyC,GAAMzC,EAAEzB,QAEhD6F,EAAeZ,OAAO,YACjBK,KAAK,IAAK,SAAS7D,EAAEK,GAClB,MAAOA,IAAW,GAANsB,GAAYuC,EAAiB,OAAG,KAC/CL,KAAK,IAAK,IACVA,KAAK,KAAM,SACXA,KAAK,cAAe,UACpBJ,KAAK,SAASzD,GAAK,MAAOA,GAAEzB,MAEjC,IAAI+F,GAAY1B,EAAIc,UAAU,YACzB/E,KAAKuF,GACLG,QAAQb,OAAO,KACfK,KAAK,QAAS,UAEnBS,GAAUd,OAAO,QACZK,KAAK,QAAS,QACdA,KAAK,IAAK,SAAS7D,GAAK,MAAOiD,GAAKjD,EAAEuD,UACtCzB,MAAM,OAAQ,SAAS9B,GAAK,MAAOyC,GAAMzC,EAAEzB,QAC3CR,GAAG,YAAawG,EAAIC,MACpBzG,GAAG,WAAYwG,EAAIE,MAExBH,EAAUI,KAAKH,GAEf3B,EAAIY,OAAO,KACNK,KAAK,QAAS,UACdA,KAAK,YAAa,eAAiB9B,EAAS,KAC5C2C,KAAK/B,GAEVC,EAAIY,OAAO,KACNK,KAAK,QAAS,UACda,KAAK3B,IAId,IAAIwB,GAAM3D,GAAG2D,MAAMV,KAAK,QAAS,UAAUc,KAAK,SAAS3E,GAKrD,QAAS4E,GAAUjG,GACfkG,EAAQ,mDAER,KAAI,GAAIxE,GAAE,EAAEA,EAAEyE,EAAOlF,OAAOS,IACxBwE,GAAS,WACQlG,EAAK0B,GAAG6C,KAAK6B,cAAgB,YAC5BnD,SAAmB,KAAVjD,EAAK0B,GAAGiC,GAAc,YAGrD,OAAOuC,GAZX,GAAItG,GAAOyB,EAAEzB,KAAKyG,QAAQ,IAAK,KAC3BF,EAAS9E,EAAEuD,OAcXsB,EAAQ,+BAAqCtG,EAAM,QAAUqG,EAAUE,GAAS,UACpF,OAAOD,KAQf,QAASI,iBACL,GAAIrC,GAAMhC,GAAGiB,OAAO,gBACpBe,GAAIc,UAAU,KAAKC,QAEnB,IAAIuB,GAAQtE,GAAGiB,OAAO,SACtBqD,GAAMxB,UAAU,KAAKC,SAElBwB,QACC9D,kBACA8D,QAAS,IAGTC,cACAD,QAAS,GAMjB,QAASC,eAGL,GASIC,GACAC,EAVAC,EAAa,EAEbjE,GAAUC,IAAK,GAAIC,MAAO,IAAKC,OAAQ,GAAIC,KAAM,KAEjDC,EAAQC,SAAShB,GAAGiB,OAAO,iBAAiBC,MAAM,UAAYR,EAAOI,KAAOJ,EAAOE,MACnFO,EAAiB,IAARJ,EAAcL,EAAOC,IAAMD,EAAOG,OAC3CU,EAAIvB,GAAGwB,MAAMG,SAASF,OAAO,EAAGV,IAChCW,EAAI1B,GAAGwB,MAAMG,SAASF,OAAO,EAAGN,IAChCU,EAAQ7B,GAAGwB,MAAMM,aAIjB8C,EAAU5E,GAAG0C,OAAOkC,UACnBC,OAAM,GACNC,MAAM/D,EAAOI,IACb4D,QAAO,GACPC,MAAM,SAAS5F,GAAK,MAAOA,GAAE0F,KAAKH,KAEnCL,EAAQtE,GAAGiB,OAAO,SACtBqD,GAAMrD,OAAO,KAAK8B,SAClBuB,EACK1B,OAAO,MACPC,KAAK,yEAGV,IAAIb,GAAMhC,GAAGiB,OAAO,gBACpBe,GAAIf,OAAO,KAAK8B,QAEhB,IAAIkC,GAAgBjF,GAAGiB,OAAO,iBACzB2B,OAAO,OACPK,KAAK,QAAS,UACdA,KAAK,QAASlC,GACdkC,KAAK,SAAU9B,EAAO,GACtB8B,KAAK,YAAa,aAAevC,EAAOI,KAAO,IAAMJ,EAAOC,IAAM,KAEnEqC,EAAShD,GAAGiB,OAAO,iBAClB2B,OAAO,OACPK,KAAK,QAAS,UACdA,KAAK,QAAiB,GAARlC,GACdkC,KAAK,SAAU9B,EAAO,GACtB8B,KAAK,YAAa,aAAevC,EAAOI,KAAO,MAEpDkB,GAAMhC,GAAGiB,OAAO,iBACX2B,OAAO,OACPK,KAAK,QAAS,SACdA,KAAK,QAASlC,GACdkC,KAAK,SAAU9B,GACf8B,KAAK,YAAa,aAAevC,EAAOI,KAAO,IAAMJ,EAAOC,IAAM,KAEvEX,GAAGkF,KAAK,8BAA+B,SAASnH,GA2B5C,QAASoH,GAASC,GACdvJ,IACA,KAAK,GAAI4D,GAAI,EAAGA,EAAI2F,EAAMpG,OAAQS,IAC9B5D,EAAE4D,GAAK2F,EAAM3F,GAAG9B,IAEpB,OAAO9B,GAiFX,QAASwJ,KACcL,MAAQ3F,KAAKwF,MAAMS,EAAM/B,SAAS,GAOrD,IANIvD,GAAGuF,MAAMC,cACTR,MAAQ3F,KAAKwF,MAAMY,EAAQC,OAAO1F,GAAG2F,MAAMvI,MAAM,GAAGsD,EAAOI,OAC3DvF,QAAQC,IAAIwJ,OACZM,EAAM/B,QAAQyB,MAAOA,SAGpBA,MAAQ,MAAUA,MAAQ,KAAO,CAClCL,EAAaK,MAAQ,IACrB,IAAI7I,GAAO,SAAUiD,GACjB,MAAOA,GAAE0F,KAAKH,GAElBC,GAAQI,MAAM7I,GAAMyJ,MAAMnB,GAC1BoB,EAAKnB,GAEToB,EAAO7C,KAAK,KAAMwC,EAAQT,QAK9B,QAASa,GAAKzG,GAEV,GAAI2G,GAAK,EAAU3G,EAAE4G,GAAIC,EAAK,EAAW7G,EAAE8G,EAC3C3E,GAAExB,QAAQX,EAAEmC,EAAGnC,EAAEmC,EAAInC,EAAE4G,KACvBtE,EAAE3B,QAAQX,EAAEsC,EAAGtC,EAAEsC,EAAItC,EAAE8G,IAEvB,IAAIC,GAAInE,EAAIc,UAAU,UAAUsD,aAC3B3I,SAASuC,GAAGuF,MAAMc,OAAS,KAAO,KAClCpD,KAAK,YAAa,SAAU7D,GACzB,MAAO,aAAemC,EAAEnC,EAAEmC,GAAM,IAAMG,EAAEtC,EAAEsC,GAAM,KAGxDyE,GAAElF,OAAO,QACJgC,KAAK,QAAS,SAAU7D,GACrB,MAAO2G,GAAK3G,EAAE4G,GAAK,IAEtB/C,KAAK,SAAU,SAAU7D,GACtB,MAAO6G,GAAK7G,EAAE8G,GAAK,IAG3BC,EAAElF,OAAO,QACJgC,KAAK,IAAK,SAAU7D,GACjB,MAAO2G,GAAK3G,EAAE4G,GAAK,IAEtB/C,KAAK,IAAK,SAAU7D,GACjB,MAAO6G,GAAK7G,EAAE8G,GAAK,IAEtBhF,MAAM,UAAW,SAAU9B,GACxB,MAAO2G,GAAK3G,EAAE4G,GAAK5G,EAAEkH,EAAI,EAAI,IAGrC5B,EAAOtF,EAEa,SAAjBY,GAAGuF,MAAMgB,MAAiBvG,GAAGuF,MAAMiB,kBAtK1C9B,EAAOD,EAAO1G,CAEd,IAAI6H,GAAQhB,EAAQgB,MAAMnB,GACrBrB,OAAO,SAAShE,GAAK,OAAQA,EAAEqH,WAChCC,EAAO1E,EAAIc,UAAU,KACpB/E,KAAK6H,GACLnC,QAAQb,OAAO,SACfK,KAAK,QAAS,QACdA,KAAK,YAAa,SAAS7D,GAAK,MAAO,aAAiBA,EAAG,EAAI,MAAUA,EAAEsC,EAAK,MAChFvE,GAAG,QAAS,SAASiC,GAAK,MAAOyG,GAAKnB,GAAQtF,EAAEuH,OAASlC,EAAOrF,EAAEuH,SAEvED,GAAK9D,OAAO,YACPK,KAAK,QAAS,SAAS7D,GAAK,MAAOA,GAAE4G,GAAK,IAC1C/C,KAAK,SAAU,SAAS7D,GAAK,MAAOA,GAAE8G,GAAK,IAC3ChF,MAAM,OAAQ,SAAS9B,GAAK,MAAOyC,GAAMzC,EAAEuH,OAAOhJ,QAEvD+I,EAAK9D,OAAO,YACPK,KAAK,IAAK,SAAS7D,GAAK,MAAOA,GAAE4G,GAAK,IACtC/C,KAAK,IAAK,SAAS7D,GAAK,MAAOA,GAAE8G,GAAK,IACtCjD,KAAK,KAAM,SACXA,KAAK,cAAe,UACpBJ,KAAK,SAASzD,GAAK,MAAOA,GAAEzB,OAC5BuD,MAAM,UAAW,SAAS9B,GAAyC,MAApCA,GAAEkH,EAAIlJ,KAAKwJ,wBAAgCxH,EAAE4G,GAAK5G,EAAEkH,EAAI,EAAI,IAEhGtG,GAAGiB,OAAO4F,QAAQ1J,GAAG,QAAS,WAAa0I,EAAKpB,IAUhD,IAAIjB,GAAiBR,EAAOF,UAAU,KACjC/E,KAAKoH,EAAST,EAAK+B,WACnBhD,QAAQb,OAAO,SACfK,KAAK,QAAS,UACdA,KAAK,YAAa,aAAevC,EAAOI,KAAO,MAEpD0C,GAAeZ,OAAO,YACjBK,KAAK,IAAK,SAAS7D,EAAEK,GAClB,MAAOA,IAAW,GAANsB,GAAYoE,EAAST,EAAK+B,UAAgB,OAAG,KAC5DxD,KAAK,IAAK,IACVA,KAAK,QAAS,IACdA,KAAK,SAAU,IACf/B,MAAM,OAAQ,SAAS9B,GAAK,MAAOyC,GAAMzC,KAE9CoE,EAAeZ,OAAO,YACjBK,KAAK,IAAK,SAAS7D,EAAEK,GAClB,MAAOA,IAAW,GAANsB,GAAYoE,EAAST,EAAK+B,UAAgB,OAAG,KAC5DxD,KAAK,IAAK,IACVA,KAAK,KAAM,SACXA,KAAK,cAAe,UACpBJ,KAAK,SAASzD,GAAK,MAAOA,GAAEgF,QAAQ,IAAK,MAI9C,IAAIqB,GAAUzF,GAAGwB,MAAMG,SAClB5B,QAAQ,KAAM,OACd0B,OAAO,EAAGV,EAAML,EAAOI,KAAKJ,EAAOE,QACnCkG,OAAM,GAEPxB,EAAQtF,GAAGgC,IAAIsD,QACd/D,EAAEkE,GACFlC,QAAQ,EAAG,IACXpG,GAAG,QAASkI,EAGjBJ,GAAcrC,OAAO,QAChBK,KAAK,QAAS,qBACdA,KAAK,SAAU,GACfA,KAAK,QAASlC,EAAML,EAAOI,KAAKJ,EAAOE,OACvCqC,KAAK,YAAa,aAAevC,EAAOI,KAAO,IAAMJ,EAAOC,IAAM,KAGvEsE,EAAcrC,OAAO,KAChBK,KAAK,QAAS,UACdA,KAAK,YAAa,aAAevC,EAAOI,KAAO,IAAMJ,EAAOC,IAAM,KAClEmD,KAAK9D,GAAGgC,IAAIC,OACRT,MAAMiE,GACNvD,OAAO,UACPE,WAAW,SAAUhD,GAClB,OAAQA,IAEX2H,SAAS,GACTC,YAAY,KAChB/F,OAAO,WACPA,OAAO,WACJ,MAAO7D,MAAK6J,WAAWC,YAAY9J,KAAK+J,WAAU,MAErDlE,KAAK,QAAS,OAEnB,IAAImE,GAASnC,EAAcrC,OAAO,KAC7BK,KAAK,QAAS,UACda,KAAKwB,EAGV8B,GAAOnG,OAAO,eACTgC,KAAK,SAAU,IAEpB,IAAI6C,GAASsB,EAAOxE,OAAO,UACtBK,KAAK,QAAS,UACdA,KAAK,YAAa,aAAevC,EAAOI,KAAO,IAAMJ,EAAOC,IAAM,KAClEsC,KAAK,IAAK,EAEfmE,GACKtD,KAAKwB,EAAMC,OACXa,aACA3I,SAAS,KACTqG,KAAKwB,EAAM/B,QAAQ,KAAM,QACzBO,KAAKwB,EAAMC,SA6DxB,QAASrI,YAAWY,EAAY2D,GAC9BrE,KAAKU,WAAaA,EAClBV,KAAKqE,MAAQA,EACbrE,KAAKlB,MAAQ8D,GAAGyB,MAAMA,EAAM,GAAIA,EAAM,GAAG,GACzCrE,KAAKiK,QAAU5F,EAAM,GACrBrE,KAAKkK,WAAa7F,EAAM,GAExBrE,KAAKmK,QACHC,SACE7G,KACE8G,MAAO,UACPC,OAAQ,WAEV7G,QACE4G,MAAO,UACPC,OAAQ,aAh2ChB,GAAIC,YAAa3H,GAAGqB,KAAKxB,OAAO,MAC5BvD,UAAYqL,WAAWrG,MAEvBjB,cAAgBL,GAAGH,OAAO,KAC1BO,eAAiBJ,GAAGH,OAAO,KAC3BC,eAAiB,SAAS8H,GAAO,MAAOA,GAG5CC,aAAYC,QAAQ,GAAGC,QAAQ,UAC/B,IAAIR,QAASvH,GAAGwB,MAAMwG,WACnBvG,MAAMoG,YAAYC,QAAQ,IAOzBtL,YAAa,CACjByL,UAASC,QACNC,MAAMnI,GAAGkF,KAAM,sBACfiD,MAAMnI,GAAGkF,KAAM,0BACfiD,MAAMnI,GAAGkF,KAAM,0BACfiD,MAAMnI,GAAGkF,KAAM,gCACfkD,MAAMnN,SA+CT,IAAI4B,SAAU,GAAIqB,aAClB8B,IAAGiB,OAAO4F,QAAQ1J,GAAG,SAAU,WAAYN,QAAQa,WAAWC,KAAM,aAiEpEhB,WAAW0L,UAAUzL,aAAe,SAASC,GAC3C,MAAIA,IACFO,KAAKkL,cAAgBzL,EACrBO,KAAKkL,cAAcnL,GAAG,SAAUC,KAAMA,KAAKmL,cAC3CnL,KAAKkL,cAAcnL,GAAG,SAAUC,KAAMA,KAAKoL,cAC3CpL,KAAKkL,cAAcnL,GAAG,iBAAkBC,KAAMA,KAAKqL,eACnDrL,KAAKkL,cAAcnL,GAAG,gBAAiBC,KAAMA,KAAKsL,iBAC3CtL,MAGFA,KAAKkL,eAQd3L,WAAW0L,UAAUvL,QAAU,WAC7B,GAAI6L,GAAMvL,IAwBV,OArBAuL,GAAIjI,QAAWC,IAAK,GAAIC,MAAO,GAAIC,OAAQ,GAAIC,KAAM,IACrD6H,EAAIC,UAAY,GAChBD,EAAIE,cAAgB,GAGpBF,EAAI3G,IAAMhC,GAAGiB,OAAO,IAAI0H,EAAI7K,YAAY8E,OAAO,OAC5CkG,QAAQ,UAAU,GACrBH,EAAII,MAAQJ,EAAI3G,IAAIY,OAAO,KAC3B+F,EAAItF,IAAMsF,EAAI3G,IAAIY,OAAO,KAAKkG,QAAQ,OAAO,GAC7CH,EAAIK,SAAWL,EAAItF,IAAIT,OAAO,QAC3BC,KAAK,sBACLiG,QAAQ,aAAa,GACrB7F,KAAK,cAAe,UAGvB0F,EAAIM,WAAajJ,GAAGkJ,IAAIC,YACxBR,EAAIS,KAAOpJ,GAAGkJ,IAAIE,OACfH,WAAWN,EAAIM,YAElBN,EAAIU,SAEGV,GAaThM,WAAW0L,UAAUgB,OAAS,WAC5B,GAAIV,GAAMvL,IAwBV,OArBAuL,GAAI5H,MAAQC,SAAShB,GAAGiB,OAAO,IAAI0H,EAAI7K,YAAYoD,MAAM,UAAYyH,EAAIjI,OAAOI,KAAO6H,EAAIjI,OAAOE,MAClG+H,EAAIxH,OAAqB,GAAZwH,EAAI5H,MAAa4H,EAAIjI,OAAOC,IAAMgI,EAAIjI,OAAOG,OAC1D8H,EAAI1K,UAAa0K,EAAI5H,MAAQ,IAAO,SAAW,QAG/C4H,EAAI3G,IAAIiB,KAAK,QAAS0F,EAAI5H,MAAQ4H,EAAIjI,OAAOI,KAAO6H,EAAIjI,OAAOE,OAC5DqC,KAAK,SAAU0F,EAAIxH,OAASwH,EAAIjI,OAAOC,IAAMgI,EAAIjI,OAAOG,OAAS8H,EAAIC,WAExED,EAAItF,IAAIJ,KAAK,YAAa,mBAC1B0F,EAAIK,SAAS/F,KAAK,IAAK0F,EAAI5H,MAAM,GAC9BkC,KAAK,IAAK,IAEb0F,EAAII,MAAM9F,KAAK,YAAa,aAAc0F,EAAIjI,OAAOI,KAAM,IAAK6H,EAAIjI,OAAOC,IAAK,KAGhFgI,EAAIW,SAAWjK,KAAKkK,MAAO,EAAE,EAAGZ,EAAI5H,OACpC4H,EAAIM,WAAWzH,MAAkB,KAAZmH,EAAI5H,OACtByI,WAAWb,EAAI5H,MAAM,EAAG4H,EAAIxH,OAAO,IAEtCwH,EAAIc,QAAShM,SAAU,IAEhBkL,GAQThM,WAAW0L,UAAUqB,eAAiB,WACpC,MAAsB,UAAlBtM,KAAKa,UACA,GAEA,IASXtB,WAAW0L,UAAUsB,SAAW,WAC9B,MAAsB,UAAlBvM,KAAKa,UACA,OAEA,QAeXtB,WAAW0L,UAAUuB,YAAc,SAASpM,GAC1C,GAAImL,GAAMvL,IACLI,IAAYA,EAAQtB,MAGvByM,EAAIpI,cAAgB/C,EAAQtB,MAAM,GAFlCyM,EAAIpI,cAAgBjE,UAAU,QAMhCqM,EAAI3K,YAAc2K,EAAI5K,KAAKoB,IAAI,SAASlD,GAEtC,OACEF,GAAIE,EAAMF,GACVK,WAAYH,EAAMC,MAAM6C,OAAO,SAASL,EAAMvC,GAC5C,MAAOuC,IAAQvC,EAAKA,KAAK0N,WAAalB,EAAIpI,cAAcsJ,UAAY1N,EAAKC,WAAa,IACrF,OAgBTO,WAAW0L,UAAUoB,OAAS,SAASjM,GACrC,GAAImL,GAAMvL,IACVuL,GAAIiB,YAAYpM,EAEhB,IAAIC,GAAWD,EAAQC,SAAWD,EAAQC,SAAWkL,EAAAA,WAAYlL,QAEjE8J,QAAOxH,QAAQ,EAAG,EAAG,EAAG,GAAI,GAAI,KAEhC4I,EAAIK,SAASjF,KAAK,sDAChB4D,WAAWgB,EAAIpI,eAAgB,YAEjC,IAAIuJ,GAAWnB,EAAItF,IAAIP,UAAU,QAAQ/E,KAAKwJ,OAAOxH,SACrD+J,GAASrG,QAAQb,OAAO,QACrBkG,QAAQ,YAAY,GACvBgB,EAAS1D,aAAa3I,SAASA,GAC5BwF,KAAK,IAAK,SAAS7D,EAAGK,GAAK,MAAOA,GAAIkJ,EAAIW,WAC1CrG,KAAK,IAAK0F,EAAIE,eACd5F,KAAK,QAAS0F,EAAIW,UAClBrG,KAAK,SAAU0F,EAAIE,eACnB5F,KAAK,OAAQ,SAAS7D,GAAK,MAAOmI,QAAOnI,IAE5C,IAAI2K,GAAYpB,EAAItF,IAAIP,UAAU,cAAc/E,KAAKwJ,OAAOxH,SAyB5D,OAxBAgK,GAAUtG,QAAQb,OAAO,QACtBkG,QAAQ,aAAa,GACxBiB,EAAU3D,aAAa3I,SAASA,GAC7BoF,KAAK,SAASzD,EAAGK,GAChB,MAAIA,IAAK8H,OAAOxH,SAASf,OAAS,EAAUI,EAAG,IACxCA,IAER6D,KAAK,IAAK,SAAS7D,EAAEK,GAAK,MAAOA,GAAIkJ,EAAIW,SAAW,IACpDrG,KAAK,IAAK0F,EAAIe,kBACdzG,KAAK,YAAa0F,EAAIgB,YAGzBhB,EAAIqB,OAASrB,EAAII,MAAMjG,UAAU,QAC9B/E,KAAKkM,SAASC,QAAQvB,EAAIxN,KAAMwN,EAAIxN,KAAKM,QAAQC,KAAKyO,UACzDxB,EAAIqB,OAAOvG,QACRb,OAAO,QACLkG,QAAQ,SAAS,GACjB3L,GAAG,YAAa,SAASiC,GAAKuJ,EAAIyB,eAAehL,KACjDjC,GAAG,WAAY,SAASiC,GAAKuJ,EAAI0B,iBAAiBjL,KACvDuJ,EAAIqB,OAAO5D,aAAa3I,SAASA,GAC9BwF,KAAK,IAAK0F,EAAIS,MACdnG,KAAK,OAAQ,SAAS7D,EAAGK,GACxB,MAAO8H,QAAOoB,EAAI3K,YAAYyB,GAAGrD,cAE9BuM,GAWThM,WAAW0L,UAAUG,aAAe,SAASjD,GAC3CnI,KAAKiM,UAMP1M,WAAW0L,UAAUE,aAAe,SAAShD,GAC3CnI,KAAKqM,OAAOlE,EAAM/H,UAQpBb,WAAW0L,UAAU+B,eAAiB,SAAShL,GAC7ChC,KAAKqL,cAAcrJ,GAAGxC,eAAec,WAAYC,KAAM,iBAAkB5B,GAAIqD,EAAErD,IAAMqB,OASvFT,WAAW0L,UAAUgC,iBAAmB,SAASjL,GAC/ChC,KAAKsL,gBAAgBtJ,GAAGxC,eAAec,WAAYC,KAAM,gBAAiB5B,GAAIqD,EAAErD,IAAMqB,OASxFT,WAAW0L,UAAUI,cAAgB,SAASrJ,GAC5C,GAAIuJ,GAAMvL,IAGV,OAFAuL,GAAIqB,OAAO5G,OAAO,SAASnH,GAAS,MAAOA,GAAMF,IAAMqD,EAAErD,KACtD+M,QAAQ,eAAe,GACnBH,GASThM,WAAW0L,UAAUK,gBAAkB,SAAStJ,GAC9C,GAAIuJ,GAAMvL,IAGV,OAFAA,MAAK4M,OAAO5G,OAAO,SAASnH,GAAS,MAAOA,GAAMF,IAAMqD,EAAErD,KACvD+M,QAAQ,eAAe,GACnBH,GA2BTzK,aAAamK,UAAUlL,GAAK,SAASmN,EAAWC,EAAUC,GACxD,GAAIrM,GAAYf,KAAKe,UAAUmM,EAO/B,OANKnM,KACHA,MAEFA,EAAUsM,MAAMF,SAAUA,EAAUC,SAAUA,EAASE,KAAKH,KAC5DnN,KAAKe,UAAUmM,GAAanM,EAErBf,MAgBTc,aAAamK,UAAU3K,UAAY,SAAS6H,EAAOoF,GACjD,GAAIxM,GAAYf,KAAKe,UAAUoH,EAAM5H,KAQrC,OAPIQ,IACFA,EAAUnC,QAAQ,SAASuO,GACrBA,EAASA,UAAYI,GACvBJ,EAASC,SAASjF,KAIjBnI,MAyHTJ,YAAYqL,UAAUzL,aAAe,SAASC,GAC5C,MAAIA,IACFO,KAAKkL,cAAgBzL,EACrBO,KAAKkL,cAAcnL,GAAG,SAAUC,KAAMA,KAAKmL,cAC3CnL,KAAKkL,cAAcnL,GAAG,SAAUC,KAAMA,KAAKoL,cAC3CpL,KAAKkL,cAAcnL,GAAG,iBAAkBC,KAAMA,KAAKqL,eACnDrL,KAAKkL,cAAcnL,GAAG,gBAAiBC,KAAMA,KAAKsL,iBAE3CtL,MAEFA,KAAKkL,eAUdtL,YAAYqL,UAAUvL,QAAU,WAE9B,GAAI6L,GAAMvL,IAkFV,OA/EAuL,GAAIjI,QAAUC,IAAK,GAAIC,MAAO,GAAIC,OAAQ,GAAIC,KAAM,IACpD6H,EAAIiC,SAAWrJ,EAAG,GAAIG,EAAG,IAEzBiH,EAAI3G,IAAMhC,GAAGiB,OAAO,IAAI0H,EAAI7K,YAAY8E,OAAO,OAC/C+F,EAAII,MAAQJ,EAAI3G,IAAIY,OAAO,KAE3B+F,EAAIrE,MAAQqE,EAAII,MAAMnG,OAAO,QAC1BC,KAAK,uCACLI,KAAK,cAAe,UACpBA,KAAK,cAAe,QAGvB0F,EAAIkC,QAAUlC,EAAII,MAAMnG,OAAO,KAC5BkG,QAAQ,gBAAgB,GAE3BH,EAAImC,IAAMnC,EAAII,MAAMnG,OAAO,KACxBkG,QAAQ,YAAY,GAEvBH,EAAIpH,EAAIvB,GAAGwB,MAAMG,SACjBgH,EAAIjH,EAAI1B,GAAGwB,MAAMG,SAGjBgH,EAAIoC,OAASpC,EAAII,MAAMnG,OAAO,KAC3BkG,QAAQ,eAAe,GAE1BH,EAAIqC,OAASrC,EAAII,MAAMnG,OAAO,KAC3BkG,QAAQ,eAAe,GAE1BH,EAAI5G,MAAQ/B,GAAGgC,IAAIC,OAChBT,MAAMmH,EAAIpH,GACV0J,MAAM,GACN/I,OAAO,UAEVyG,EAAIxG,MAAQnC,GAAGgC,IAAIC,OAChBT,MAAMmH,EAAIjH,GACVQ,OAAO,QAEVyG,EAAIuC,OAASvC,EAAIoC,OAAOnI,OAAO,QAC5BkG,QAAQ,cAAc,GACtB7F,KAAK,cAAe,UAEvB0F,EAAIwC,OAASxC,EAAIqC,OAAOpI,OAAO,QAC5BkG,QAAQ,cAAc,GACtB7F,KAAK,YAAa,eAClBA,KAAK,cAAe,UACpBJ,KAAK,sBAER8F,EAAIyC,SAAWpL,GAAG2D,MACfV,KAAK,QAAS,UACdoI,UAAU,KACVC,QAAQ,EAAE,IACVvH,KAAK,SAAS3E,GACb,MAAO,OACGA,EAAErD,GAAI,yEAEVqD,EAAEhD,WAAY,8CACauM,EAAI5K,KAAK4K,EAAIpL,QAAQI,KAChD,0BAA2BgL,EAAI5K,KAAK4K,EAAIpL,QAAQsC,OAAOT,EAAE7B,QAAS,uBAE5EoL,EAAII,MAAMjF,KAAK6E,EAAIyC,UAEnBzC,EAAI4C,OAASvL,GAAG2D,MACbV,KAAK,QAAS,UACdoI,UAAU,KACVC,QAAQ,EAAE,IACVvH,KAAK,SAAS3E,GACb,MAAO,qEAEDuI,WAAWgB,EAAIpI,eAAgB,+CACNoI,EAAI5K,KAAK4K,EAAIpL,QAAQ4C,UAChD,8BAA+BwH,WAAWgB,EAAIrI,YAAa,4DACnBF,eAA+B,IAAhBhB,EAAEoM,aAAqB,yEAGtF7C,EAAII,MAAMjF,KAAK6E,EAAI4C,QAEnB5C,EAAIU,SAGGV,GAOT3L,YAAYqL,UAAUoD,cAAgB,WACpC,MAAsB,UAAlBrO,KAAKa,UAA8B,OAChC,OAGTjB,YAAYqL,UAAUqD,WAAa,WACjC,MAAsB,UAAlBtO,KAAKa,UAA8B,GAChC,GAQTjB,YAAYqL,UAAUgB,OAAS,WAC7B,GAAIV,GAAMvL,IAiCV,OA9BAuL,GAAI5H,MAAQC,SAAShB,GAAGiB,OAAO,IAAI0H,EAAI7K,YAAYoD,MAAM,UAAYyH,EAAIjI,OAAOI,KAAO6H,EAAIjI,OAAOE,MAClG+H,EAAIxH,OAASwH,EAAI5H,MAGjB4H,EAAI1K,UAAa0K,EAAI5H,MAAQ,IAAO,SAAW,QAG/C4H,EAAI3G,IAAIiB,KAAK,QAAS0F,EAAI5H,MAAQ4H,EAAIjI,OAAOI,KAAO6H,EAAIjI,OAAOE,OAC5DqC,KAAK,SAAU0F,EAAIxH,OAASwH,EAAIjI,OAAOC,IAAMgI,EAAIjI,OAAOG,QAC3D8H,EAAII,MAAM9F,KAAK,YAAa,aAAc0F,EAAIjI,OAAOI,KAAM,IAAK6H,EAAIjI,OAAOC,IAAK,KAEhFgI,EAAIrE,MAAMrB,KAAK,IAAK0F,EAAI5H,MAAM,GAC3BkC,KAAK,IAAK,GACVA,KAAK,YAAa0F,EAAI8C,iBAEzB9C,EAAIpH,EAAEE,OAAOkH,EAAIiC,QAAQrJ,EAAGoH,EAAI5H,MAAM4H,EAAIiC,QAAQrJ,IAClDoH,EAAIjH,EAAED,OAAOkH,EAAIxH,OAAOwH,EAAIiC,QAAQlJ,EAAGiH,EAAIiC,QAAQlJ,IAEnDiH,EAAIoC,OAAO9H,KAAK,YAAa,gBAAiB0F,EAAIxH,OAAQ,KAC1DwH,EAAIuC,OAAOjI,KAAK,IAAK0F,EAAI5H,MAAM,GAC5BkC,KAAK,IAAK0F,EAAIjI,OAAOG,OAAO,GAE/B8H,EAAIxG,MAAM8I,MAAMtC,EAAI+C,cACpB/C,EAAIwC,OAAOlI,KAAK,KAAM0F,EAAI5H,MAAM,GAC7BkC,KAAK,IAAwB,KAAlB0F,EAAIjI,OAAOI,MAGzB6H,EAAIc,OAAOd,EAAAA,YAGJA,GAgBT3L,YAAYqL,UAAUuB,YAAc,SAASpM,GAC3C,GAAImL,GAAMvL,IAEV,KAAKI,EAEH,GAAIA,KAkCN,OA/BAmL,GAAIpI,cAAgB/C,EAAQtB,MAAQsB,EAAQtB,MAAM,GAAKyM,EAAIpI,cAC3DoI,EAAIrI,WAAa9C,EAAQtB,MAAQsB,EAAQtB,MAAM,GAAKyM,EAAIrI,WACxDqI,EAAIpL,OAASC,EAAQD,OAASC,EAAQD,OAASoL,EAAIpL,OAGnDoL,EAAI3K,YAAc2K,EAAI5K,KAAK4K,EAAIpL,QAAQQ,KAAKgB,OAAO,SAASL,EAAMiN,EAASlM,GAEzE,GAAmB,kBAAfkM,EAAQ5P,GACV,MAAO2C,EAIT,IAAItD,GAASuN,EAAI5K,KAAiB,WAAEA,KAAK0B,GACrCmM,EAAajD,EAAI5K,KAAK4K,EAAIpL,QAAQQ,KAAK0B,EAc3C,OAXAoM,eAAgBzQ,EAAOc,MAAMkH,OAAO,SAAS1B,GAC3C,MAAOA,GAAEvF,KAAK0N,WAAalB,EAAIpI,cAAcsJ,YAAc,GAC7DiC,eAAiBF,EAAW1P,MAAMkH,OAAO,SAAS1B,GAChD,MAAOA,GAAEvF,KAAK0N,WAAalB,EAAIrI,WAAWuJ,YAAc,GAG1DnL,EAAK+L,MACH1O,GAAI4P,EAAQ5P,GACZK,WAAYyP,cAAczP,WAC1BmB,OAAQuO,eAAenD,EAAIpL,UAEtBmB,OAIFiK,GAaT3L,YAAYqL,UAAUoB,OAAS,SAASjM,GACtC,GAAImL,GAAMvL,IAGVuL,GAAIiB,YAAYpM,EAEhB,IAAIC,GAAWD,EAAQC,SAAWD,EAAQC,SAAWkL,EAAAA,WAAYlL,QAEjEkL,GAAIpH,EAAExB,OAAO4I,EAAI5K,KAAK4K,EAAIpL,QAAQwC,QAClC4I,EAAIjH,EAAE3B,QAAQ,EAAG,KAGjB4I,EAAIuC,OACDnH,KAAK4E,EAAI5K,KAAK4K,EAAIpL,QAAQI,KACzB,2BAA4BgK,WAAWgB,EAAIrI,YAAa,aACzD2C,KAAK,YAAa0F,EAAI8C,iBAEzB9C,EAAIwC,OACDpH,KAAK4E,EAAI5K,KAAK3B,WAAWuB,KACxB,+BAAgCgK,WAAWgB,EAAIpI,eAAgB,aAChE0C,KAAK,YAAa0F,EAAI8C,iBAEzB9C,EAAI5G,MAAMK,WAAWuG,EAAI5K,KAAK4K,EAAIpL,QAAQsC,QAC1C8I,EAAIoC,OAAO3E,aAAa3I,SAASA,GAC9BqG,KAAK6E,EAAI5G,OACZ4G,EAAIqC,OAAO5E,aAAa3I,SAASA,GAC9BqG,KAAK6E,EAAIxG,OAEZwG,EAAIoD,KAAOpD,EAAIkC,QAAQ/H,UAAU,UAAU/E,KAAK4K,EAAI3K,aAEpD2K,EAAIoD,KAAKtI,QACNb,OAAO,UACLK,KAAK,QAAS,SAAS7D,GAAK,MAAO,OAAOA,EAAErD,GAAGqI,QAAQ,IAAK,MAC5DnB,KAAK,IAAK,GACV9F,GAAG,YAAawL,EAAIyB,eAAeM,KAAK/B,IACxCxL,GAAG,WAAYwL,EAAI0B,iBAAiBK,KAAK/B,IAE9CA,EAAIoD,KAAK3F,aAAa3I,SAASA,GAC5BwF,KAAK,KAAM,SAAS7D,GAAK,MAAOuJ,GAAIpH,EAAEnC,EAAE7B,UACxC0F,KAAK,KAAM,SAAS7D,GAAK,MAAOuJ,GAAIjH,EAAEtC,EAAEhD,cACxC6G,KAAK,OAAQ,SAAS7D,GAAK,MAAOmI,QAAOnI,EAAEhD,aAG9C,IAAIiC,GAAUsK,EAAI3K,YAAYmB,IAAI,SAASC,GAAK,MAAOA,GAAE7B,SACrDgB,EAAUoK,EAAI3K,YAAYmB,IAAI,SAASC,GAAK,MAAOA,GAAEhD,aACrD4P,EAAQrD,EAAInI,WAAWnC,QAAQA,GAChCE,QAAQA,GACRK,eAGCqN,IAAYC,GAAIvD,EAAIpH,EAAExB,SAAS,GAAIyC,GAAIwJ,EAAM,GACjCG,GAAIxD,EAAIpH,EAAExB,SAAS,GAAIqM,GAAIJ,EAAM,GAAKrD,EAAIpH,EAAExB,SAAS,GAAKiM,EAAM,GAChER,YAAanM,KAAKgN,KAAKL,EAAM,KAC7CrD,GAAI2D,QAAU3D,EAAImC,IAAIhI,UAAU,QAAQ/E,KAAKkO,GAE7CtD,EAAI2D,QAAQ7I,QAAQb,OAAO,QACxBkG,QAAQ,YAAY,GACpB3L,GAAG,YAAa,SAASiC,GAAKuJ,EAAI4D,aAAanN,KAC/CjC,GAAG,WAAY,SAASiC,GAAKuJ,EAAI6D,eAAepN,KACnDuJ,EAAI2D,QAAQlG,aAAa3I,SAASA,GAC/BwF,KAAK,KAAM,SAAS7D,GAAK,MAAOuJ,GAAIpH,EAAEnC,EAAE8M,MACxCjJ,KAAK,KAAM,SAAS7D,GAAK,MAAOuJ,GAAIjH,EAAEtC,EAAEoD,MACxCS,KAAK,KAAM,SAAS7D,GAAK,MAAOuJ,GAAIpH,EAAEnC,EAAE+M,MACxClJ,KAAK,KAAM,SAAS7D,GAAK,MAAOuJ,GAAIjH,EAAEtC,EAAEgN,OAY7CpP,YAAYqL,UAAUG,aAAe,SAASjD,GAC5CnI,KAAKiM,UAQPrM,YAAYqL,UAAUE,aAAe,SAAShD,GAC5CnI,KAAKqM,OAAOlE,EAAM/H,UASpBR,YAAYqL,UAAUI,cAAgB,SAASrJ,GAC7C,GAAIuJ,GAAMvL,IAMV,OALAuL,GAAIoD,KAAK3I,OAAO,SAASnH,GAAS,MAAOA,GAAMF,IAAMqD,EAAErD,KACpD+M,QAAQ,eAAe,GACvB7F,KAAK,IAAK,IACb0F,EAAIyC,SAASxH,KAAK+E,EAAI3K,YAAY2K,EAAI8D,WAAWrN,KAE1CuJ,GAST3L,YAAYqL,UAAUK,gBAAkB,SAAStJ,GAC/C,GAAIuJ,GAAMvL,IAMV,OALAuL,GAAIoD,KAAK3I,OAAO,SAASnH,GAAS,MAAOA,GAAMF,IAAMqD,EAAErD,KACpD+M,QAAQ,eAAe,GACvB7F,KAAK,IAAK,GACb0F,EAAIyC,SAASvH,OAEN8E,GAGT3L,YAAYqL,UAAUkE,aAAe,SAASnN,GAC5ChC,KAAKkP,QAAQxD,QAAQ,eAAe,GACpC1L,KAAKmO,OAAO3H,KAAKxE,IAGnBpC,YAAYqL,UAAUmE,eAAiB,SAASpN,GAC9ChC,KAAKkP,QAAQxD,QAAQ,eAAe,GACpC1L,KAAKmO,OAAO1H,QAQd7G,YAAYqL,UAAU+B,eAAiB,SAAShL,GAC9ChC,KAAKqL,cAAcrJ,GAAGxC,eAAec,WAAYC,KAAM,iBAAkB5B,GAAIqD,EAAErD,IAAMqB,OAQvFJ,YAAYqL,UAAUgC,iBAAmB,SAASjL,GAChDhC,KAAKsL,gBAAgBtJ,GAAGxC,eAAec,WAAYC,KAAM,gBAAiB5B,GAAIqD,EAAErD,IAAMqB,OAGxFJ,YAAYqL,UAAUoE,WAAa,SAASrN,GAC1C,IAAK,GAAIK,GAAI,EAAGA,EAAIrC,KAAKY,YAAYgB,OAAQS,IAC3C,GAAIrC,KAAKY,YAAYyB,GAAG1D,IAAMqD,EAAErD,GAAI,MAAO0D,EAE7C,OAAO,GA4JT,IAAI8E,SAAS,CA2QbrH,YAAWmL,UAAUqE,SAAW,SAAS7J,GACvC,MAAIA,IACFzF,KAAKuP,gBAAkB9J,EAChBzF,MAGFA,KAAKuP,iBAGdzP,WAAWmL,UAAUzL,aAAe,SAASC,GAC3C,MAAIA,IACFO,KAAKkL,cAAgBzL,EACrBO,KAAKkL,cAAcnL,GAAG,SAAUC,KAAMA,KAAKoL,cAEpCpL,MAGFA,KAAKkL,eAGdpL,WAAWmL,UAAUvL,QAAU,WAE7B,GAAI6L,GAAMvL,IA8DV,OA3DAuL,GAAIjI,QAAWC,IAAK,GAAIC,MAAO,GAAIC,OAAQ,GAAIC,KAAM,IACrD6H,EAAIiE,QAAUC,OAAQ,IACtBlE,EAAI1G,MAAQ6K,MAAO3L,OAAQ,KAE3BwH,EAAI3G,IAAMhC,GAAGiB,OAAO,IAAI0H,EAAI7K,YAAY8E,OAAO,OAC/C+F,EAAIvB,OAASuB,EAAI3G,IAAIY,OAAO,KAG5B+F,EAAIpH,EAAIvB,GAAGwB,MAAMG,SACd5B,OAAO4I,EAAIlH,OAGdkH,EAAIoE,UAAYpE,EAAIvB,OAAOxE,OAAO,KAAKkG,QAAQ,SAAS,GAExDH,EAAIqE,UAAYrE,EAAIvB,OAAOxE,OAAO,KAAKkG,QAAQ,cAAc,GAC7DH,EAAIsE,aAAetE,EAAIvB,OAAOxE,OAAO,KAAKkG,QAAQ,iBAAiB,GAEnEH,EAAIuE,QAAUvE,EAAIqE,UAAUpK,OAAO,KAAKkG,QAAQ,iBAAiB,GACjEH,EAAIwE,WAAaxE,EAAIsE,aAAarK,OAAO,KAAKkG,QAAQ,eAAe,GAErEH,EAAIyE,YAAczE,EAAIuE,QAAQtK,OAAO,QAAQK,KAAK,eAAgB,GAClE0F,EAAI0E,eAAiB1E,EAAIwE,WAAWvK,OAAO,QAAQK,KAAK,eAAgB,GAGxE0F,EAAI2E,QAAU3E,EAAIqE,UAAUpK,OAAO,QAChCkG,QAAQ,kBAAkB,GAC1BjG,KAAK,cACLI,KAAK,cAAe,UACvB0F,EAAI4E,WAAa5E,EAAIsE,aAAarK,OAAO,QACtCkG,QAAQ,qBAAqB,GAC7BjG,KAAK,eACLI,KAAK,cAAe,UAEvB0F,EAAI6E,eAAiB7E,EAAIvB,OAAOxE,OAAO,QACpCkG,QAAQ,mBAAmB,GAC3B/E,KAAK,WACL5G,GAAG,QAAS,SAASiC,GAAIuJ,EAAI8E,oBAEhC9E,EAAIoE,UAAUjK,UAAU,QACrB/E,KAAK4K,EAAIzM,OAAOuH,QAChBb,OAAO,QACLC,KAAK,SAASzD,GAAK,MAAOA,KAC1B6D,KAAK,cAAe,UACpBA,KAAK,YAAa,cAGvB0F,EAAI+E,cAAgB1N,GAAG2N,SAASC,OAC7BzQ,GAAG,YAAa,SAASiC,GAAKuJ,EAAIkF,yBAAyBzO,KAC3DjC,GAAG,OAAQ,SAASiC,GAAKuJ,EAAImF,cAAc1O,KAC3CjC,GAAG,UAAW,SAASiC,GAAKuJ,EAAIoF,oBAAoB3O,KACvDuJ,EAAIqF,iBAAmBhO,GAAG2N,SAASC,OAChCzQ,GAAG,YAAa,SAASiC,GAAKuJ,EAAIsF,4BAA4B7O,KAC9DjC,GAAG,OAAQ,SAASiC,GAAKuJ,EAAImF,cAAc1O,KAC3CjC,GAAG,UAAW,SAASiC,GAAKuJ,EAAIoF,oBAAoB3O,KAGvDuJ,EAAIU,SAGGV,GAGTzL,WAAWmL,UAAUgB,OAAS,WAE5B,GAAIV,GAAMvL,IA4CV,OAzCAuL,GAAI5H,MAAQC,SAAShB,GAAGiB,OAAO,IAAI0H,EAAI7K,YAAYoD,MAAM,UAAYyH,EAAIjI,OAAOI,KAAO6H,EAAIjI,OAAOE,MAClG+H,EAAIxH,OAAU,EAAE,EAAKwH,EAAI5H,MAGzB4H,EAAI3G,IACDiB,KAAK,QAAS0F,EAAI5H,MAAQ4H,EAAIjI,OAAOI,KAAO6H,EAAIjI,OAAOE,OACvDqC,KAAK,SAAU0F,EAAIxH,OAASwH,EAAIjI,OAAOC,IAAMgI,EAAIjI,OAAOG,QAC3D8H,EAAIvB,OACDnE,KAAK,YAAa,aAAc0F,EAAIjI,OAAOI,KAAM,IAAK6H,EAAIjI,OAAOC,IAAK,KAEzEgI,EAAI2E,QAAQrK,KAAK,IAAK0F,EAAI5H,MAAM,GAC7BkC,KAAK,IAAK,KACb0F,EAAI4E,WAAWtK,KAAK,IAAK0F,EAAI5H,MAAM,GAChCkC,KAAK,IAAK,IAEb0F,EAAIpH,EAAEE,OAAO,EAAGkH,EAAI5H,QAGpB4H,EAAIqE,UAAU/J,KAAK,YAAa,eAAgB5D,KAAKkK,MAAMZ,EAAIxH,OAAS,GAAI,KAC5EwH,EAAIsE,aAAahK,KAAK,YAAa,eAAgB0F,EAAIxH,OAAS,EAAI,EAAG,KAEvEwH,EAAIyE,YACDnK,KAAK,KAAM,GACXA,KAAK,KAAM0F,EAAI5H,OAClB4H,EAAI0E,eACDpK,KAAK,KAAM,GACXA,KAAK,KAAM0F,EAAI5H,OAElB4H,EAAIoE,UACD9J,KAAK,YAAa,eAAgB0F,EAAIxH,OAAO,EAAG,KAEnDwH,EAAIoE,UAAUjK,UAAU,QACrBG,KAAK,IAAK,SAAS7D,GAAK,OAAQuJ,EAAIpH,EAAEnC,GAAK,IAE9CuJ,EAAI6E,eAAevK,KAAK,IAAK0F,EAAI5H,OAC9BkC,KAAK,IAAK0F,EAAIxH,OAAS,GAG1BwH,EAAIc,SAGGd,GAGTzL,WAAWmL,UAAUoB,OAAS,WAC5B,GAAId,GAAMvL,IAEVuL,GAAIuF,gBACJvF,EAAIwF,cAGNjR,WAAWmL,UAAU8F,WAAa,WAChC,GAAIxF,GAAMvL,KAENgR,EAAUpO,GAAGE,KAAKyI,EAAItB,QAASsB,EAAIrB,aACnC+G,EAAUrO,GAAGC,KAAK0I,EAAItB,QAASsB,EAAIrB,YAEvCqB,GAAIoE,UAAUjK,UAAU,QACrBG,KAAK,cAAe,SAAS7D,GAC5B,MAAQA,IAAKiP,GAAgBD,GAALhP,EAAgB,OAAS,aAIvDlC,WAAWmL,UAAU6F,cAAgB,WACnC,GAAIvF,GAAMvL,KAENkR,EAAY3F,EAAIqE,UAAUlK,UAAU,UAAU/E,MAAM4K,EAAItB,SAE5DiH,GAAU7K,QACPb,OAAO,UACLK,KAAK,IAAK0F,EAAIiE,OAAOC,QACrB1P,GAAG,YAAa,WAAYwL,EAAI4F,kBAAkBD,EAAW3F,EAAIpB,OAAOC,QAAQ7G,IAAI8G,SACpFtK,GAAG,WAAY,WAAYwL,EAAI4F,kBAAkBD,EAAW3F,EAAIpB,OAAOC,QAAQ7G,IAAI+G,UACnF5D,KAAK6E,EAAI+E,eAEdY,EAAUlI,aAAa3I,SAAS,KAC7BwF,KAAK,KAAM0F,EAAIpH,EAElB,IAAIiN,GAAe7F,EAAIsE,aAAanK,UAAU,UAAU/E,MAAM4K,EAAIrB,YAElEkH,GAAa/K,QACVb,OAAO,UACLK,KAAK,IAAK0F,EAAIiE,OAAOC,QACrB1P,GAAG,YAAa,WAAYwL,EAAI4F,kBAAkBC,EAAc7F,EAAIpB,OAAOC,QAAQ3G,OAAO4G,SAC1FtK,GAAG,WAAY,WAAYwL,EAAI4F,kBAAkBC,EAAc7F,EAAIpB,OAAOC,QAAQ3G,OAAO6G,UACzF5D,KAAK6E,EAAIqF,kBAEdQ,EAAapI,aAAa3I,SAAS,KAChCwF,KAAK,KAAM0F,EAAIpH,IAGpBrE,WAAWmL,UAAUkG,kBAAoB,SAAS3B,EAAQ/K,GACxD+K,EAAO3J,KAAK,OAAQpB,IAGtB3E,WAAWmL,UAAUG,aAAe,SAASjD,GAC3CnI,KAAKiM,UAOPnM,WAAWmL,UAAUwF,yBAA2B,SAASzO,GACvDhC,KAAKqR,eAAiB,YACtBrR,KAAKsR,aAAe,UACpBtR,KAAKuR,sBAAsBvP,IAG7BlC,WAAWmL,UAAU4F,4BAA8B,SAAS7O,GAC1DhC,KAAKqR,eAAiB,eACtBrR,KAAKsR,aAAe,aACpBtR,KAAKuR,sBAAsBvP,IAG7BlC,WAAWmL,UAAUsG,sBAAwB,SAASvP,GACpDhC,KAAKA,KAAKqR,gBAAgB3L,UAAU,UAAUgG,QAAQ,YAAY,IAGpE5L,WAAWmL,UAAUyF,cAAgB,SAAS1O,GAC5C,GAAIuJ,GAAMvL,KAGNmE,EAAIvB,GAAGC,KAAKD,GAAGE,KAAKF,GAAGuF,MAAMhE,EAAG,IAAKoH,EAAI5H,OAC7C4H,GAAIA,EAAI8F,gBAAgBxN,OAAO,UAAUgC,KAAK,KAAM1B,GACpDoH,EAAIA,EAAI+F,cAAgBrP,KAAKwF,MAAM8D,EAAIpH,EAAEmE,OAAOnE,IAChDoH,EAAIwF,cAGNjR,WAAWmL,UAAU0F,oBAAsB,SAAS3O,GAGlDhC,KAAKA,KAAKqR,gBAAgB3L,UAAU,UAAUgG,QAAQ,YAAY,GAClE1L,KAAK8Q,gBACL9Q,KAAKR,eAAec,WAClBC,KAAK,SACLH,SACEtB,OAAQI,UAAUc,KAAKiK,QAAQuH,YAAatS,UAAUc,KAAKkK,WAAWsH,iBAK5E1R,WAAWmL,UAAUoF,gBAAkB,WACrCrQ,KAAKR,eAAec,WAClBC,KAAK,mBACLH","file":"main.min.js","sourcesContent":["  \n// convert year strings to date objects\nvar formatYear = d3.time.format('%Y');\nvar parseYear = formatYear.parse;\n\nvar formatPercent = d3.format('%');\nvar formatCurrency = d3.format('$');\nvar formatIdentity = function(str) { return str; };\n\n// universal color scale\ncolorbrewer.Purples[6].unshift('#ffffff');\nvar colors = d3.scale.quantile()\n  .range(colorbrewer.Purples[6]);\n    \n/***---------------------***\n *** LOAD AND PARSE DATA ***\n ***---------------------***/\n  \n// load all data before cleaning\nvar dataLoaded = false;\nd3_queue.queue()\n  .defer(d3.json, 'data/topo_usa.json')\n  .defer(d3.json, 'data/state_deaths.json')\n  .defer(d3.json, 'data/state_income.json')\n  .defer(d3.json, 'data/state_unemployment.json')\n  .await(loadData);\n  \n// globals for data\nfunction loadData(error, topo, deaths, income, unemployment) {\n  if (error) {\n    console.log(error);\n  } else {\n    topo.objects.usa.geometries.sort(function(a,b) {\n      if (a.id < b.id) return -1;\n      if (a.id > b.id) return 1;\n      return 0;\n    });\n    \n    // convert death data from strings to numbers and dates\n    deaths.forEach(function(state) {\n      state.years.forEach(function(year) {\n        year.death_rate = +year.death_rate;\n        year.deaths = +year.deaths;\n        year.population = +year.population;\n        year.year = parseYear(year.year);\n      });\n    });\n    // convert income data from strings to numbers and dates\n    income.forEach(function(state) {\n      state.years.forEach(function(year) {\n        year.median_income = +year.median_income / 1000,\n        year.year = parseYear(year.year)\n      });\n    });\n    \n    unemployment.forEach(function(state) {\n      state.years.forEach(function(year) {\n        year.unemployment = +year.unemployment;\n        year.year = parseYear(year.year);\n      })\n    })\n    // update data loading status\n    dataLoaded = true;\n    // create visualizations\n    createVis(topo, deaths, income, unemployment);\n  }\n}\n\n/***--------------------------------***\n *** DRAW AND UPDATE VISUALIZATIONS ***\n ***--------------------------------***/\n\nvar handler = new EventHandler();\nd3.select(window).on('resize', function() {handler.broadcast({name: 'resize'})});\n\n// creates and initializes all visualizations \nfunction createVis(topo, deaths, income, unemployment) {\n  \n  choropleth = new Choropleth('choropleth', topo, deaths);\n  choropleth.eventHandler(handler).initVis();\n  \n  scatterplot = new Scatterplot('scatterplot', 'median_income', deaths, income, unemployment);\n  scatterplot.eventHandler(handler).initVis();\n  \n  yearSlider = new YearSlider('year-slider', [2002, 2014]);\n  yearSlider.eventHandler(handler).initVis();\n  handler.on('question-clicked', this, displaySliderDescription);\n}\n\n// update visualizations based on selected options\nfunction updateFactor(factor) {\n  if (dataLoaded) {\n    // build options\n    options = {\n      factor: factor,\n      duration: 1000\n    };\n    \n    handler.broadcast({ name: 'update', options: options});\n  }\n}\n\nfunction displaySliderDescription() {\n  $('#slider-modal').modal();\n}\n/*--------------------*\n *** INITIALIZATION ***\n *--------------------*/\n\n/**\n * Creates a new choropleth\n *\n * @param parentElem  The dom element within which the visualization should be\n *                    appended\n * @param topo        The topojson data for the choropleth's map\n * @param data        The death data with which to color the map\n * @return Choropleth\n */\nfunction Choropleth(parentElem, topo, data) {\n  this.parentElem = parentElem;\n  this.topo = topo;\n  this.data = data;\n  this.displayData = {};\n  \n  this.sizeGroup = \"medium\";\n  this.default = {\n    duration: 1000\n  };\n}\n\n/**\n * If an event handler is specified sets the choropleth's handler and adds \n * the choropleth's listener callbacks. Returns the choropleth\n * If no event handler is specified returns the choropleth's current handler.\n *\n * @param handler The event handler to use with the choropleth\n * @return Choropleth|EventHandler\n */\nChoropleth.prototype.eventHandler = function(handler) {\n  if (handler) {\n    this._eventHandler = handler;\n    this._eventHandler.on('update', this, this.handleUpdate);\n    this._eventHandler.on('resize', this, this.handleResize);\n    this._eventHandler.on('mouseoverState', this, this.drawHighlight);\n    this._eventHandler.on('mouseoutState', this, this.removeHighlight);\n    return this;\n  }\n  \n  return this._eventHandler;\n}\n\n/**\n * Creates SVG and initializes visualization variables.\n *\n * @return Choropleth\n */\nChoropleth.prototype.initVis = function() {\n  var vis = this;\n  \n  /* DRAWING PARAMETERS */\n  vis.margin = { top: 40, right: 20, bottom: 20, left: 20 };\n  vis.keyHeight = 80;\n  vis.keyRectHeight = 20;\n  \n  /* ** CREATE DRAWING AREA ** */\n  vis.svg = d3.select('#'+vis.parentElem).append('svg')\n    .classed('us-map', true);\n  vis.graph = vis.svg.append('g');\n  vis.key = vis.svg.append('g').classed('key', true);\n  vis.keyTitle = vis.key.append('text')\n    .text('Deaths Per 100,000')\n    .classed('key-title', true)\n    .attr('text-anchor', 'middle');\n      \n  /*** MAP DRAWING FUNCTIONS ***/\n  vis.projection = d3.geo.albersUsa();\n  vis.path = d3.geo.path()\n    .projection(vis.projection);\n  \n  vis.resize();\n  // return vis for chaining\n  return vis;\n}\n\n\n/*------------*\n *** SIZING ***\n *------------*/\n\n/**\n * Resizes the visualization and redraws it within its parent element.\n *\n * @return Choropleth\n */\nChoropleth.prototype.resize = function() {\n  var vis = this;\n  \n  /* set width and height based on container */\n  vis.width = parseInt(d3.select('#'+vis.parentElem).style('width')) - vis.margin.left - vis.margin.right;\n  vis.height = vis.width * .8 - vis.margin.top - vis.margin.bottom;\n  vis.sizeGroup = (vis.width > 468) ? 'medium' : 'small';\n  \n  /* update margin transformations */\n  vis.svg.attr('width', vis.width + vis.margin.left + vis.margin.right)\n    .attr('height', vis.height + vis.margin.top + vis.margin.bottom + vis.keyHeight);\n    \n  vis.key.attr('transform', 'translate(0,10)');\n  vis.keyTitle.attr('x', vis.width/2)\n    .attr('y', 10);\n      \n  vis.graph.attr('transform', 'translate('+ vis.margin.left +','+ vis.margin.top +')');\n  \n  /* Rescale drawing parameters */\n  vis.keyWidth = Math.floor((1/6)*vis.width);\n  vis.projection.scale(vis.width * 1.35)\n    .translate([vis.width/2, vis.height/2]);\n    \n  vis.update({ duration: 0 });\n  \n  return vis;\n}\n\n/**\n * Returns the correct offset based on the visualization's current size group\n *\n * @return Number\n */\nChoropleth.prototype.keyLabelOffset = function() {\n  if (this.sizeGroup == 'medium') {\n    return 55;\n  } else {\n    return 50;\n  }\n}\n\n/**\n * Returns the correct font size based on the visualizations current size group\n *\n * @return String\n */\nChoropleth.prototype.fontSize = function() {\n  if (this.sizeGroup == \"medium\") {\n    return '14px';\n  } else {\n    return '12px';\n  }\n}\n\n/*---------------------------*\n *** DRAWING VISUALIZATION ***\n *---------------------------*/\n \n/**\n * Coerces data into an array the state's ID and death rate.\n * Accepted Options:\n *  years: Array of date objects, first date should be the year for death rate \n *\n * @param options The options for wrangling data\n */\nChoropleth.prototype.wrangleData = function(options) {\n  var vis = this;\n  if (!options || !options.years) {\n    vis.deathRateYear = parseYear('2014');\n  } else {\n    vis.deathRateYear = options.years[0];\n  }\n  \n  // empty object to hold filtered data\n  vis.displayData = vis.data.map(function(state) {\n    // filter out years falling beyond given date range\n    return {\n      id: state.id,\n      death_rate: state.years.reduce(function(prev, year) {\n        return prev + (year.year.getTime() == vis.deathRateYear.getTime() ? year.death_rate : 0);\n      }, 0)\n    };\n  });\n}\n\n\n/**\n * Updates the visualization according to the new data year\n * Accepted Options:\n *  years:    An array of year objects where the first year corresponds with \n *            death rate data\n *  duration: The duration (in milliseconds) that transitions should last\n *\n * @param options Options for redrawing the visualization \n * @return Choropleth\n */\nChoropleth.prototype.update = function(options) {\n  var vis = this;\n  vis.wrangleData(options);\n  \n  var duration = options.duration ? options.duration : vis.default.duration;\n  // change colors domain\n  colors.domain([0, 1, 5, 10, 15, 20]);\n  \n  vis.keyTitle.html('Deaths Per 100,000 <tspan class=\"death-rate-year\">('+ \n    formatYear(vis.deathRateYear) +')</tspan>');\n  \n  var keyRects = vis.key.selectAll('rect').data(colors.domain());\n  keyRects.enter().append('rect')\n    .classed('key-rect', true);\n  keyRects.transition().duration(duration)\n    .attr('x', function(d, i) { return i * vis.keyWidth; })\n    .attr('y', vis.keyRectHeight)\n    .attr('width', vis.keyWidth)\n    .attr('height', vis.keyRectHeight)\n    .attr('fill', function(d) { return colors(d); });\n  \n  var keyLabels = vis.key.selectAll('.key-label').data(colors.domain())\n  keyLabels.enter().append('text')\n    .classed('key-label', true);\n  keyLabels.transition().duration(duration)\n    .text(function(d, i) { \n      if (i == colors.domain().length - 1) return d +'+';\n      return d; \n    })\n    .attr('x', function(d,i) { return i * vis.keyWidth + 2;})\n    .attr('y', vis.keyLabelOffset())\n    .attr('font-size', vis.fontSize());\n    \n  \n  vis.states = vis.graph.selectAll('path')\n    .data(topojson.feature(vis.topo, vis.topo.objects.usa).features);\n  vis.states.enter()\n    .append('path')\n      .classed('state', true)\n      .on('mouseover', function(d) { vis.highlightState(d); })\n      .on('mouseout', function(d) { vis.unhighlightState(d); });\n  vis.states.transition().duration(duration)\n    .attr('d', vis.path)\n    .attr('fill', function(d, i) { \n      return colors(vis.displayData[i].death_rate); });\n  \n  return vis;\n}\n\n\n/*--------------------*\n *** EVENT HANDLERS ***\n *--------------------*/\n\n/**\n * Responds to resize events by calling the visualization's resize method\n */\nChoropleth.prototype.handleResize = function(event) {\n  this.resize();\n}\n\n/**\n * Handles update events by calling the visualizations update method\n */\nChoropleth.prototype.handleUpdate = function(event) {\n  this.update(event.options);\n}\n\n/**\n * Draws a highlight around the given state and broadcasts the highlight event\n *\n * @param d The state topojson path that triggered the highlight event\n */\nChoropleth.prototype.highlightState = function(d) {\n  this.drawHighlight(d).eventHandler().broadcast({ name: 'mouseoverState', id: d.id }, this);\n}\n\n/**\n * Removes the highlight from the given state and broadcasts the unhighlight \n * event\n *\n * @param d The state topojson path that triggered the unhighlight event\n */\nChoropleth.prototype.unhighlightState = function(d) {\n  this.removeHighlight(d).eventHandler().broadcast({ name: 'mouseoutState', id: d.id }, this);\n}\n\n/**\n * Draws a red ring around the highlighted state\n *\n * @param d The path of the state being highlighted\n * @return Choropleth\n */\nChoropleth.prototype.drawHighlight = function(d) {\n  var vis = this;\n  vis.states.filter(function(state) { return state.id == d.id})\n    .classed('highlighted', true);\n  return vis;\n}\n\n/**\n * Removes the red ring from the unhighlighted state\n *\n * @param d The path of the state having its highlight removed\n * @return Choropleth\n */\nChoropleth.prototype.removeHighlight = function(d) {\n  var vis = this;\n  this.states.filter(function(state) { return state.id == d.id; })\n    .classed('highlighted', false);\n  return vis;\n}\n\n\n\n/**\n * Creates a new EventHanlder object\n *\n * @return EventHandler\n */\nfunction EventHandler() {\n  this.listeners = {};\n}\n\n/**\n * Adds an event listener for events with the given name. Note that\n * this method does not check for uniqueness. If a listener registers\n * for an event multiple times it will receive multiple notifications\n * when the event occurs.\n *\n * @param eventName   The name of the event being listened for\n * @param listener    The object interested in listening for the event\n * @param callback    The callback for handling the event, which is passed\n *                    to the callback as the only parameter\n *\n * @return EventHandler\n */\nEventHandler.prototype.on = function(eventName, listener, callback) {\n  var listeners = this.listeners[eventName];\n  if (!listeners) {\n    listeners = [];\n  }\n  listeners.push({listener: listener, callback: callback.bind(listener)});\n  this.listeners[eventName] = listeners;\n  \n  return this;\n}\n\n/**\n * Informs all interested listeners of the occurrence of a given event. \n * If the caller provides a value for sender, the sender will not be \n * informed of the event.\n *\n * @param event   An object containing important event properties. \n *                'name' is the only required property.\n * @param sender  (Optional) The object that broadcast the event. If \n *                specified then the sender will not have any of its\n *                callbacks fired.\n *\n * @return EventHandler\n */\nEventHandler.prototype.broadcast = function(event, sender) {\n  var listeners = this.listeners[event.name];\n  if (listeners) {\n    listeners.forEach(function(listener) {\n      if (listener.listener != sender) {\n        listener.callback(event);\n      }\n    });\n  }\n  return this;\n}\n\n// code found at http://bl.ocks.org/benvandyke/8459843\nfunction Regression() {\n  this.xSeries = function(xSeries) {\n    if (!xSeries) {\n      return this._xSeries;\n    }\n    \n    this._xSeries = xSeries;\n    return this;\n  };\n  \n  this.ySeries = function(ySeries) {\n    if (!ySeries) {\n      return this._ySeries;\n    }\n    \n    this._ySeries = ySeries;\n    return this;\n  };\n  \n  this.reduceSum = function(prev, cur) {\n    return prev + cur;\n  };\n  \n  this.coefficients = function() {\n    var self = this;\n    var xBar = this._xSeries.reduce(this.reduceSum) * 1.0 / this._xSeries.length;\n    var yBar = this._ySeries.reduce(this.reduceSum) * 1.0 / this._ySeries.length;\n\n    var ssXX = this._xSeries.map(function(d) { return Math.pow(d - xBar, 2); })\n      .reduce(this.reduceSum);\n    \n    var ssYY = this._ySeries.map(function(d) { return Math.pow(d - yBar, 2); })\n      .reduce(this.reduceSum);\n      \n    var ssXY = this._xSeries.map(function(d, i) { return (d - xBar) * (self._ySeries[i] - yBar); })\n      .reduce(this.reduceSum);\n      \n    var slope = ssXY / ssXX;\n    var intercept = yBar - (xBar * slope);\n    var rSquare = Math.pow(ssXY, 2) / (ssXX * ssYY);\n    \n    return [slope, intercept, rSquare];\n  };\n}\n\n/*--------------------*\n *** INITIALIZATION ***\n *--------------------*/\n\n/**\n * Creates a new Scatterplot visualization\n *\n * @param parentElem    The ID of the DOM element within which the visualization\n *                      should be drawn.\n * @param handler       The event handler for the visualization\n * @param deaths        An array of death data sorted alphabetically by state\n * @param income        An array of income data sorted alphabetically by state\n * @param unemployment  An array of unemployment data sorted alphabetically by \n *                      state\n * @return Scatterplot\n */\nfunction Scatterplot(parentElem, factor, deaths, income, unemployment) {\n  this.parentElem = parentElem;\n  this.data = {\n    'death_rate': {\n      data: deaths,\n      name: 'Deaths Per 100,000',\n      format: formatIdentity,\n      domain: [\n        d3.min(deaths, function(d) { return d3.min(d.years, function(d) {return d.death_rate; }); }),\n        d3.max(deaths, function(d) { return d3.max(d.years, function(d) {return d.death_rate; }); })\n      ]\n    },\n    'median_income': {\n      data: income,\n      name: 'Median Income (1000s)',\n      shortName: 'Median Income',\n      format: formatCurrency,\n      domain: [\n        d3.min(income, function(d) { return d3.min(d.years, function(d) {return d.median_income; }); }),\n        d3.max(income, function(d) { return d3.max(d.years, function(d) {return d.median_income; }); })\n      ]\n    },\n    'unemployment': {\n      data: unemployment,\n      name: 'Unemployment Rate',\n      shortName: 'Unemployment Rate',\n      format: formatPercent,\n      domain: [\n        d3.min(unemployment, function(d) { return d3.min(d.years, function(d) {return d.unemployment; }); }),\n        d3.max(unemployment, function(d) { return d3.max(d.years, function(d) {return d.unemployment; }); })\n      ]\n    }\n  };\n  \n  this.factor = factor;\n  this.factorYear = parseYear('2014');\n  this.deathRateYear = parseYear('2014');\n  \n  this.displayData = {};\n  this.regression = new Regression();\n  \n  this.sizeGroup = \"medium\";\n  this.default = {\n    duration: 1000\n  }\n}\n\n/**\n * If a handler is specified the Scatterplot updates its event handler and \n * registers listeners for the events for which it's interested. The receiving\n * object is returned.\n * If no handler is given returns the objects current handler.\n *\n * @param handler (Optional) The event handler for the object\n * @return EventHandler|Scatterplot\n */\nScatterplot.prototype.eventHandler = function(handler) {\n  if (handler) {\n    this._eventHandler = handler;\n    this._eventHandler.on('update', this, this.handleUpdate);\n    this._eventHandler.on('resize', this, this.handleResize);\n    this._eventHandler.on('mouseoverState', this, this.drawHighlight);\n    this._eventHandler.on('mouseoutState', this, this.removeHighlight);\n  \n    return this;\n  }\n  return this._eventHandler;\n}\n\n/**\n * Initalizes the visualization by appending and sizing the containing SVG \n * before defining scales and axes. Should only be called once on a given \n * scatter plot.\n *\n * @return Scatterplot\n */\nScatterplot.prototype.initVis = function() {\n  // grab reference to self\n  var vis = this;\n  \n  /*** SVG DRAWING AREA ***/\n  vis.margin = {top: 20, right: 20, bottom: 40, left: 70};\n  vis.padding = {x: 10, y: 10};\n      \n  vis.svg = d3.select('#'+vis.parentElem).append('svg');\n  vis.graph = vis.svg.append('g');\n  \n  vis.title = vis.graph.append('text')\n    .text('What Factors Influence Drug Deaths?')\n    .attr('text-anchor', 'middle')\n    .attr('font-weight', 'bold');\n      \n  /*** CHART DATA ELEMENTS ***/\n  vis.scatter = vis.graph.append('g')\n    .classed('scatter-plot', true);\n    \n  vis.bfl = vis.graph.append('g')\n    .classed('best-fit', true);\n    \n  vis.x = d3.scale.linear();\n  vis.y = d3.scale.linear();\n    \n  /*** CHART AXES ***/\n  vis.xAxisG = vis.graph.append('g')\n    .classed('axis x-axis', true);\n    \n  vis.yAxisG = vis.graph.append('g')\n    .classed('axis y-axis', true);\n    \n  vis.xAxis = d3.svg.axis()\n    .scale(vis.x)\n    .ticks(6)\n    .orient('bottom');\n    \n  vis.yAxis = d3.svg.axis()\n    .scale(vis.y)\n    .orient('left');\n    \n  vis.xTitle = vis.xAxisG.append('text')\n    .classed('axis-label', true)\n    .attr('text-anchor', 'middle');\n    \n  vis.yTitle = vis.yAxisG.append('text')\n    .classed('axis-label', true)\n    .attr('transform', 'rotate(-90)')\n    .attr('text-anchor', 'middle')\n    .text('Deaths per 100,000');\n    \n  vis.stateTip = d3.tip()\n    .attr('class', 'd3-tip')\n    .direction('s')\n    .offset([5,0])\n    .html(function(d) {\n      return ''+\n        '<h4>'+ d.id +'</h4><p>'+\n          '<span class=\"tip-header\">Death Rate: <span class=\"death-rate\">'+ \n            d.death_rate +'</span></span><br>'+\n          '<span class=\"tip-header\">'+ vis.data[vis.factor].name +\n            ': <span class=\"factor\">'+ vis.data[vis.factor].format(d.factor) +'</span></span></p>';\n    });\n  vis.graph.call(vis.stateTip);\n  \n  vis.bflTip = d3.tip()\n    .attr('class', 'd3-tip')\n    .direction('s')\n    .offset([5,0])\n    .html(function(d) {\n      return ''+\n        '<span class=\"tip-header\">Death Rate <span class=\"tip-death-rate\">('\n          + formatYear(vis.deathRateYear) +')</span></span><br>'+\n        '<span class=\"tip-header\">'+ vis.data[vis.factor].shortName +\n          ' <span class=\"tip-factor\">('+ formatYear(vis.factorYear) +')</span></span><br>'+\n        '<span class=\"tip-header\">Correlation: '+ formatCurrency(d.correlation * 1000) +'</span>'+\n        '<span class=\"more-info\">Click for detailed information</span>';\n    });\n  vis.graph.call(vis.bflTip);\n  \n  vis.resize();\n  \n  // return vis for chaining\n  return vis;\n}\n\n/*------------*\n *** SIZING ***\n *------------*/\n\nScatterplot.prototype.labelFontSize = function() {\n  if (this.sizeGroup == 'medium') return '10pt'; \n  return '8pt';\n}\n\nScatterplot.prototype.yAxisTicks = function() {\n  if (this.sizeGroup == 'medium') return 10;\n  return 4;\n}\n\n/**\n * Resizes the visualization according to its parent within the DOM. \n *\n * @return Scatterplot\n */\nScatterplot.prototype.resize = function() {\n  var vis = this;\n  \n  // grab width of current container\n  vis.width = parseInt(d3.select('#'+vis.parentElem).style('width')) - vis.margin.left - vis.margin.right;\n  vis.height = vis.width;\n  \n  // update size group\n  vis.sizeGroup = (vis.width > 256) ? 'medium' : 'small';\n    \n  // resize svg, reset margin\n  vis.svg.attr('width', vis.width + vis.margin.left + vis.margin.right)\n    .attr('height', vis.height + vis.margin.top + vis.margin.bottom);\n  vis.graph.attr('transform', 'translate('+ vis.margin.left +','+ vis.margin.top +')');\n  \n  vis.title.attr('x', vis.width/2)\n    .attr('y', 6)\n    .attr('font-size', vis.labelFontSize());\n  // change scale drawing range\n  vis.x.range([vis.padding.x, vis.width-vis.padding.x]);\n  vis.y.range([vis.height-vis.padding.y, vis.padding.y]);\n  // update axis offests and title positions\n  vis.xAxisG.attr('transform', 'translate(0, '+ vis.height +')');\n  vis.xTitle.attr('x', vis.width/2)\n    .attr('y', vis.margin.bottom-2);\n    \n  vis.yAxis.ticks(vis.yAxisTicks());\n  vis.yTitle.attr('x', -vis.width/2)\n    .attr('y', -vis.margin.left * (3/4) );\n  \n  // update vis with default options now that svg has been resized\n  vis.update(vis.default);\n  \n  // return vis for chaining\n  return vis;\n}\n\n\n/*---------------------------*\n *** DRAWING VISUALIZATION ***\n *---------------------------*/\n\n/**\n * Filters the visualizations data by year according to the given options \n * Accepted Options:\n *  year: The year for which to show data on the x axis\n *\n * @param options (Optional) An object containing options for manipulating data \n * @return Scatterplot\n */\nScatterplot.prototype.wrangleData = function(options) {\n  var vis = this;\n  \n  if (!options) {\n    // create local shadow variable so shared object doesn't change\n    var options = {};\n  }\n  \n  vis.deathRateYear = options.years ? options.years[0] : vis.deathRateYear; \n  vis.factorYear = options.years ? options.years[1] : vis.factorYear;\n  vis.factor = options.factor ? options.factor : vis.factor;\n  \n  // wrangled data is placed into variable displayData\n  vis.displayData = vis.data[vis.factor].data.reduce(function(prev, current, i) {\n    // skip any national data\n    if (current.id === 'United States') {\n      return prev;\n    }\n    \n    // grab corresponding state death and factor data\n    var deaths = vis.data['death_rate'].data[i];\n    var factorData = vis.data[vis.factor].data[i];\n    \n    // get data only from specified year\n    deathYearData = deaths.years.filter(function(y) { \n      return y.year.getTime() == vis.deathRateYear.getTime(); })[0];\n    factorYearData = factorData.years.filter(function(y) {\n      return y.year.getTime() == vis.factorYear.getTime(); })[0];\n    \n    // add an object with the state's data to the array\n    prev.push({\n      id: current.id,\n      death_rate: deathYearData.death_rate,\n      factor: factorYearData[vis.factor]\n    });\n    return prev; \n  }, []);\n  \n  // return vis for chaining\n  return vis;\n}\n\n/**\n * Updates the visualization by updating display data according to the given\n * options and redrawing the scatterplot accordingly.\n * Accepted Options:\n *  year: The year to use when drawing the x axis (default is most recent)\n *  duration: The duration of any trasnitions (default is 0)\n *\n * @param options The options for updating the scatterplot.\n * @return Scatterplot\n */\nScatterplot.prototype.update = function(options) {\n  var vis = this;\n  \n  // update display data\n  vis.wrangleData(options);\n  \n  var duration = options.duration ? options.duration : vis.default.duration;\n  // update x and y domains according to new data\n  vis.x.domain(vis.data[vis.factor].domain);\n  vis.y.domain([0, 35]);\n  \n  // redraw axes\n  vis.xTitle\n    .html(vis.data[vis.factor].name +\n      ' <tspan class=\"factor\">('+ formatYear(vis.factorYear) +')</tspan>')\n    .attr('font-size', vis.labelFontSize());\n    \n  vis.yTitle\n    .html(vis.data.death_rate.name +\n      ' <tspan class=\"death_rate\">('+ formatYear(vis.deathRateYear) +')</tspan>')\n    .attr('font-size', vis.labelFontSize());\n  \n  vis.xAxis.tickFormat(vis.data[vis.factor].format);\n  vis.xAxisG.transition().duration(duration)\n    .call(vis.xAxis);\n  vis.yAxisG.transition().duration(duration)\n    .call(vis.yAxis);\n  // update scatter plot dots data\n  vis.dots = vis.scatter.selectAll('circle').data(vis.displayData);\n  // draw any new dots \n  vis.dots.enter()\n    .append('circle')\n      .attr('class', function(d) { return 'dot '+d.id.replace(' ', ''); })\n      .attr('r', 5)\n      .on('mouseover', vis.highlightState.bind(vis))\n      .on('mouseout', vis.unhighlightState.bind(vis));\n  // move existing dots into new position according to display data  \n  vis.dots.transition().duration(duration)\n    .attr('cx', function(d) { return vis.x(d.factor); })\n    .attr('cy', function(d) { return vis.y(d.death_rate); })\n    .attr('fill', function(d) { return colors(d.death_rate)});\n      \n  // get variables to pass to regression calculator\n  var xSeries = vis.displayData.map(function(d) { return d.factor; });\n  var ySeries = vis.displayData.map(function(d) { return d.death_rate;});\n  var coeff = vis.regression.xSeries(xSeries)\n    .ySeries(ySeries)\n    .coefficients();\n  \n  // calculate best fit line path\n  var bflData = [{x1: vis.x.domain()[0], y1: coeff[1],\n                  x2: vis.x.domain()[1], y2: coeff[0] * vis.x.domain()[1] + coeff[1],\n                  correlation: Math.sqrt(coeff[2])}];\n  vis.regLine = vis.bfl.selectAll('line').data(bflData);\n  // append best fit line (if necessary) or redraw with new data\n  vis.regLine.enter().append('line')\n    .classed('best-fit', true)\n    .on('mouseover', function(d) { vis.highlightBFL(d); })\n    .on('mouseout', function(d) { vis.unhighlightBFL(d); });\n  vis.regLine.transition().duration(duration)\n    .attr('x1', function(d) { return vis.x(d.x1); })\n    .attr('y1', function(d) { return vis.y(d.y1); }) \n    .attr('x2', function(d) { return vis.x(d.x2); })\n    .attr('y2', function(d) { return vis.y(d.y2); });\n}\n\n/*--------------------*\n *** EVENT HANDLERS ***\n *--------------------*/\n\n/**\n * Handles 'resize' events by calling the visualizations resize method. \n *\n * @param event The event object\n */\nScatterplot.prototype.handleResize = function(event) {\n  this.resize();\n}\n \n/**\n * Handles 'update' events by calling the visualizations 'update' method\n *\n * @param event The event object created by the object that fired the event\n */\nScatterplot.prototype.handleUpdate = function(event) {\n  this.update(event.options);\n}\n\n\n/**\n * Draws a red ring around highlighted dot and increases its size\n *\n * @return Scatterplot\n */\nScatterplot.prototype.drawHighlight = function(d) {\n  var vis = this;\n  vis.dots.filter(function(state) { return state.id == d.id; })\n    .classed('highlighted', true)\n    .attr('r', 10);\n  vis.stateTip.show(vis.displayData[vis.stateIndex(d)]);\n  // return vis for chaining\n  return vis;\n}\n\n/**\n * Removes red ring around highlighted state and reduces its size back to the \n * starting amount.\n *\n * @return Scatterplot\n */\nScatterplot.prototype.removeHighlight = function(d) {\n  var vis = this;\n  vis.dots.filter(function(state) { return state.id == d.id; })\n    .classed('highlighted', false)\n    .attr('r', 5);\n  vis.stateTip.hide();\n  // return vis for chaining\n  return vis;\n}\n\nScatterplot.prototype.highlightBFL = function(d) {\n  this.regLine.classed('highlighted', true);\n  this.bflTip.show(d);  \n}\n\nScatterplot.prototype.unhighlightBFL = function(d) {\n  this.regLine.classed('highlighted', false);\n  this.bflTip.hide();\n}\n\n/**\n * Draws highlight around selected state and broadcasts event \n *\n * @param d The dot of the state being highlighted\n */\nScatterplot.prototype.highlightState = function(d) {\n  this.drawHighlight(d).eventHandler().broadcast({ name: 'mouseoverState', id: d.id }, this);\n}\n\n/**\n * Removes highlight from deselected state and broadcasts event\n *\n * @param d The dot of the state having its highlight removed\n */\nScatterplot.prototype.unhighlightState = function(d) {\n  this.removeHighlight(d).eventHandler().broadcast({ name: 'mouseoutState', id: d.id }, this);\n}\n\nScatterplot.prototype.stateIndex = function(d) {\n  for (var i = 0; i < this.displayData.length; i++) {\n    if (this.displayData[i].id == d.id) return i;\n  }\n  return 0;\n}\n\nfunction loadStackedArea(){\n\n    var margin = {top: 10, right: 100, bottom: 30, left: 100},\n        width = parseInt(d3.select('#treemap-area').style('width')) - margin.left - margin.right,\n        height = width * .55 - margin.top - margin.bottom;\n\n    var parseDate = d3.time.format(\"%Y\").parse,\n        formatPercent = d3.format(\".0%\");\n\n    var x = d3.time.scale()\n        .range([0, width]);\n\n    var y = d3.scale.linear()\n        .range([height, 0]);\n\n    var axisYScale = d3.scale.linear()\n        .domain([0, 2100000])\n        .range([height, 0]);\n\n\n    var color = d3.scale.category20();\n\n    var xAxis = d3.svg.axis()\n        .scale(x)\n        .orient(\"bottom\");\n\n    var yAxis = d3.svg.axis()\n        .orient(\"left\")\n        .scale(axisYScale)\n        .tickFormat(d3.format(\",.0f\"));\n\n\n    var area = d3.svg.area()\n        .x(function(d) { return x(d.date); })\n        .y0(function(d) { return y(d.y0); })\n        .y1(function(d) { return y(d.y0 + d.y); });\n\n    var stack = d3.layout.stack()\n        .values(function(d) { return d.values; });\n\n    var title = d3.select(\"#title\")\n        .append(\"h3\")\n        .text(\"Admission to Drug Treatment Programs by Subtance and Year\");\n    var svg = d3.select(\"#treemap-area\");\n    svg.selectAll(\"*\").remove();\n\n    var legend = d3.select(\"#treemap-area\")\n        .append(\"svg\")\n        .attr(\"class\", \"legend\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height/9)\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + 0 + \")\");\n\n\n    var svg = d3.select(\"#treemap-area\")\n        .append(\"svg\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n        .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    d3.tsv(\"data/treatment2003_2013.tsv\", function(error, data) {\n        if (error) throw error;\n\n        color.domain(d3.keys(data[0]).filter(function(key) { return key !== \"date\"; }));\n\n        data.forEach(function(d) {\n            d.date = parseDate(d.date);\n        });\n\n        var substances = stack(color.domain().map(function(name) {\n            return {\n                name: name,\n                values: data.map(function(d) {\n                    return {date: d.date, y: d[name]/2100000\n                }\n                })\n            };\n        }));\n\n        x.domain(d3.extent(data, function(d) { return d.date; }));\n\n        var legendElements = legend.selectAll(\"g\")\n            .data(substances)\n            .enter().append(\"svg:g\")\n            .attr(\"class\", \"legend\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + 0 + \")\");\n\n        legendElements.append(\"svg:rect\")\n            .attr(\"x\", function(d,i) {\n                return i * (width*0.9)/(substances.length) +25; })\n            .attr(\"y\", 10)\n            .attr(\"width\", 10 )\n            .attr(\"height\", 10 )\n            .style(\"fill\", function(d) { return color(d.name); });\n\n        legendElements.append(\"svg:text\")\n            .attr(\"x\", function(d,i) {\n                return i * (width*0.9)/(substances.length) +30; })\n            .attr(\"y\", 30)\n            .attr(\"dy\", \".35em\")\n            .attr(\"text-anchor\", \"middle\")\n            .text(function(d) { return d.name; });\n\n        var substance = svg.selectAll(\".browser\")\n            .data(substances)\n            .enter().append(\"g\")\n            .attr(\"class\", \"browser\");\n\n        substance.append(\"path\")\n            .attr(\"class\", \"area\")\n            .attr(\"d\", function(d) { return area(d.values); })\n            .style(\"fill\", function(d) { return color(d.name); })\n            .on('mouseover', tip.show)\n            .on('mouseout', tip.hide);\n\n        substance.call(tip);\n\n        svg.append(\"g\")\n            .attr(\"class\", \"x axis\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(xAxis);\n\n        svg.append(\"g\")\n            .attr(\"class\", \"y axis\")\n            .call(yAxis);\n\n    });\n\n    var tip = d3.tip().attr('class', 'd3-tip').html(function(d) {\n\n        var name = d.name.replace('_', ' ');\n        var number = d.values;\n\n        function makeTable(data){\n            table = \"<tr><td>Year</td><td>Admissions to Treatment</td>\";\n\n            for(var i=0;i<number.length;i++){\n                table += \"<tr>\"+\n                        \"<td>\" + data[i].date.getFullYear() + \"</td>\" +\n                        \"<td>\" + (parseInt(data[i].y*2100000)) + \"</td>\" +\n                    \"</tr>\";\n            }\n            return table;\n        }\n\n        var table = \"<table>\" + \"<th>Substance Type : \"+ name +\"</th>\" + makeTable(number)+ \"</table>\";\n        return table;\n\n    });\n\n\n}\nvar change = true;\n\nfunction changeToOther() {\n    var svg = d3.select(\"#treemap-area\");\n    svg.selectAll(\"*\").remove();\n\n    var title = d3.select(\"#title\");\n    title.selectAll(\"*\").remove();\n\n    if(change){\n        loadStackedArea();\n        change = false;\n    }\n    else{\n        loadTreemap();\n        change = true;\n    }\n}\n\n\n\nfunction loadTreemap() {\n\n    //used to get data for the correct year for a node\n    var year_index = 0\n\n    var margin = {top: 25, right: 100, bottom: 30, left: 100};\n\n    var width = parseInt(d3.select('#treemap-area').style('width')) - margin.left - margin.right,\n        height = width * .66 - margin.top - margin.bottom,\n        x = d3.scale.linear().range([0, width]),\n        y = d3.scale.linear().range([0, height]),\n        color = d3.scale.category20(),\n        root,\n        node;\n\n    var treemap = d3.layout.treemap()\n        .round(false)\n        .size([width, height])\n        .sticky(true)\n        .value(function(d) { return d.size[year_index]; });\n\n    var title = d3.select(\"#title\");\n    title.select(\"*\").remove();\n    title\n        .append(\"h3\")\n        .text(\"Proportional Admission to Drug Treatment Programs by Subtance and Year\");\n\n\n    var svg = d3.select(\"#treemap-area\");\n    svg.select(\"*\").remove();\n\n    var brushedSlider = d3.select(\"#treemap-area\")\n        .append(\"svg\")\n        .attr(\"class\", \"slider\")\n        .attr(\"width\", width)\n        .attr(\"height\", height/9)\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    var legend = d3.select(\"#treemap-area\")\n        .append(\"svg\")\n        .attr(\"class\", \"legend\")\n        .attr(\"width\", width * 0.9)\n        .attr(\"height\", height/9)\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + 0 + \")\");\n\n    svg = d3.select(\"#treemap-area\")\n        .append(\"svg\")\n        .attr(\"class\", \"chart\")\n        .attr(\"width\", width)\n        .attr(\"height\", height)\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    d3.json(\"data/betterTreeMapData.json\", function(data) {\n        node = root = data;\n\n        var nodes = treemap.nodes(root)\n            .filter(function(d) { return !d.children; });\n        var cell = svg.selectAll(\"g\")\n            .data(nodes)\n            .enter().append(\"svg:g\")\n            .attr(\"class\", \"cell\")\n            .attr(\"transform\", function(d) { return \"translate(\" + ( d.x) + \",\" + ( + d.y) + \")\"; })\n            .on(\"click\", function(d) { return zoom(node == d.parent ? root : d.parent); });\n\n        cell.append(\"svg:rect\")\n            .attr(\"width\", function(d) { return d.dx - 1; })\n            .attr(\"height\", function(d) { return d.dy - 1; })\n            .style(\"fill\", function(d) { return color(d.parent.name); });\n\n        cell.append(\"svg:text\")\n            .attr(\"x\", function(d) { return d.dx / 2; })\n            .attr(\"y\", function(d) { return d.dy / 2; })\n            .attr(\"dy\", \".35em\")\n            .attr(\"text-anchor\", \"middle\")\n            .text(function(d) { return d.name; })\n            .style(\"opacity\", function(d) { d.w = this.getComputedTextLength(); return d.dx > d.w ? 1 : 0; });\n\n        d3.select(window).on(\"click\", function() { zoom(root); });\n\n        function getNames(items){\n            a = [];\n            for (var i = 0; i < items.length; i++) {\n                a[i] = items[i].name\n            }\n            return a;\n        }\n\n        var legendElements = legend.selectAll(\"g\")\n            .data(getNames(node.children))\n            .enter().append(\"svg:g\")\n            .attr(\"class\", \"legend\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + 0 + \")\");\n\n        legendElements.append(\"svg:rect\")\n            .attr(\"x\", function(d,i) {\n                return i * (width*0.8)/(getNames(node.children).length) +25; })\n            .attr(\"y\", 10)\n            .attr(\"width\", 10 )\n            .attr(\"height\", 10 )\n            .style(\"fill\", function(d) { return color(d); });\n\n        legendElements.append(\"svg:text\")\n            .attr(\"x\", function(d,i) {\n                return i * (width*0.8)/(getNames(node.children).length) +30; })\n            .attr(\"y\", 30)\n            .attr(\"dy\", \".35em\")\n            .attr(\"text-anchor\", \"middle\")\n            .text(function(d) { return d.replace('_', ' '); });\n\n\n        //x scale for the slider\n        var sliderX = d3.scale.linear()\n            .domain([2003, 2013])\n            .range([0, width-margin.left-margin.right])\n            .clamp(true);\n\n        var brush = d3.svg.brush()\n            .x(sliderX)\n            .extent([0, 0])\n            .on(\"brush\", brushed);\n\n        //adding the slider to the page\n        brushedSlider.append(\"rect\")\n            .attr(\"class\", \"slider_background\")\n            .attr(\"height\", 4)\n            .attr(\"width\", width-margin.left-margin.right)\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n        ;\n\n        brushedSlider.append(\"g\")\n            .attr(\"class\", \"x axis\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n            .call(d3.svg.axis()\n                .scale(sliderX)\n                .orient(\"bottom\")\n                .tickFormat(function (d) {\n                    return +d;\n                })\n                .tickSize(0)\n                .tickPadding(12))\n            .select(\".domain\")\n            .select(function () {\n                return this.parentNode.appendChild(this.cloneNode(true));\n            })\n            .attr(\"class\", \"halo\");\n\n        var slider = brushedSlider.append(\"g\")\n            .attr(\"class\", \"slider\")\n            .call(brush);\n\n\n        slider.select(\".background\")\n            .attr(\"height\", 100);\n\n        var handle = slider.append(\"circle\")\n            .attr(\"class\", \"handle\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\")\n            .attr(\"r\", 9);\n\n        slider\n            .call(brush.event)\n            .transition() // gratuitous intro!\n            .duration(750)\n            .call(brush.extent([2013, 2013]))\n            .call(brush.event);\n        function brushed() {\n            var initialValue = value = Math.round(brush.extent()[0]);\n            if (d3.event.sourceEvent) { // not a programmatic event\n                value = Math.round(sliderX.invert(d3.mouse(this)[0]-margin.left));\n                console.log(value);\n                brush.extent([value, value]);\n            }\n\n            if ((value > 2002) && (value < 2014)) {\n                year_index = value - 2003\n                var year = function (d) {\n                    return d.size[year_index];\n                };\n                treemap.value(year).nodes(root);\n                zoom(node);\n            }\n            handle.attr(\"cx\", sliderX(value));\n        }\n\n        //If an area is clicked, zoom in on that area\n        //if the year is changed transition to the data for the new year\n        function zoom(d) {\n\n            var kx = (width) / d.dx, ky = (height) / d.dy;\n            x.domain([d.x, d.x + d.dx]);\n            y.domain([d.y, d.y + d.dy]);\n\n            var t = svg.selectAll(\"g.cell\").transition()\n                .duration(d3.event.altKey ? 7500 : 750)\n                .attr(\"transform\", function (d) {\n                    return \"translate(\" + x(d.x ) + \",\" + y(d.y ) + \")\";\n                });\n\n            t.select(\"rect\")\n                .attr(\"width\", function (d) {\n                    return kx * d.dx - 1;\n                })\n                .attr(\"height\", function (d) {\n                    return ky * d.dy - 1;\n                })\n\n            t.select(\"text\")\n                .attr(\"x\", function (d) {\n                    return kx * d.dx / 2;\n                })\n                .attr(\"y\", function (d) {\n                    return ky * d.dy / 2;\n                })\n                .style(\"opacity\", function (d) {\n                    return kx * d.dx > d.w ? 1 : 0;\n                });\n\n            node = d;\n            //no need to stop propogation on brush events\n            if(d3.event.type != \"brush\"){d3.event.stopPropagation();}\n        }\n    });\n}\n\n\nfunction YearSlider(parentElem, range) {\n  this.parentElem = parentElem;\n  this.range = range;\n  this.years = d3.range(range[0], range[1]+1);\n  this.topYear = range[1];\n  this.bottomYear = range[1];\n  \n  this.colors = {\n    markers: {\n      top: {\n        hover: '#756BB1',\n        normal: '#54278F'\n      },\n      bottom: {\n        hover: '#6CD16C',\n        normal: '#23A923' \n      }\n    }\n  };\n}\n\nYearSlider.prototype.question = function(text) {\n  if (text) {\n    this.descriptiveText = text;\n    return this;\n  }\n  \n  return this.descriptiveText;\n}\n\nYearSlider.prototype.eventHandler = function(handler) {\n  if (handler) {\n    this._eventHandler = handler;\n    this._eventHandler.on('resize', this, this.handleResize);\n    \n    return this;\n  }\n  \n  return this._eventHandler;\n}\n\nYearSlider.prototype.initVis = function() {\n  // grab reference to vis\n  var vis = this;\n  \n  /*** SIZES AND SVG ***/\n  vis.margin = { top: 10, right: 20, bottom: 10, left: 20};\n  vis.marker = {radius: 10};\n  vis.axis = {tick: {height: 10}};\n  \n  vis.svg = d3.select('#'+vis.parentElem).append('svg');\n  vis.slider = vis.svg.append('g');\n  \n  /*** SCALE ***/\n  vis.x = d3.scale.linear()\n    .domain(vis.range);\n  \n  /* * DRAWING GROUPS ***/\n  vis.yearsText = vis.slider.append('g').classed('years', true);\n  \n  vis.topSlider = vis.slider.append('g').classed('slider top', true);\n  vis.bottomSlider = vis.slider.append('g').classed('slider bottom', true);\n  \n  vis.topAxis = vis.topSlider.append('g').classed('axis top-axis', true);\n  vis.bottomAxis = vis.bottomSlider.append('g').classed('axis bottom', true);\n    \n  vis.topAxisLine = vis.topAxis.append('line').attr('stroke-width', 4);\n  vis.bottomAxisLine = vis.bottomAxis.append('line').attr('stroke-width', 4);\n  \n  /*** SLIDER TEXT ***/\n  vis.topText = vis.topSlider.append('text')\n    .classed('axis-label top', true)\n    .text('Death Rate')\n    .attr('text-anchor', 'middle');\n  vis.bottomText = vis.bottomSlider.append('text')\n    .classed('axis-label bottom', true)\n    .text('Factor Data')\n    .attr('text-anchor', 'middle');\n  \n  vis.questionButton = vis.slider.append('text')\n    .classed('slider question', true)\n    .html('&#xf29c')\n    .on('click', function(d) {vis.questionClicked();});\n  \n  vis.yearsText.selectAll('text')\n    .data(vis.years).enter()\n    .append('text')\n      .text(function(d) { return d; })\n      .attr('text-anchor', 'middle')\n      .attr('transform', 'rotate(90)')\n  \n  /*** DRAG BEHAVIOR ***/\n  vis.dragTopMarker = d3.behavior.drag()\n    .on('dragstart', function(d) { vis.topMarkerStartedDragging(d); })\n    .on('drag', function(d) { vis.markerDragged(d); })\n    .on('dragend', function(d) { vis.markerEndedDragging(d); });\n  vis.dragBottomMarker = d3.behavior.drag()\n    .on('dragstart', function(d) { vis.bottomMarkerStartedDragging(d); })\n    .on('drag', function(d) { vis.markerDragged(d); })\n    .on('dragend', function(d) { vis.markerEndedDragging(d); });\n  \n  // resize within bounds\n  vis.resize();\n\n  // return vis for chaining\n  return vis;\n}\n\nYearSlider.prototype.resize = function() {\n  // grab reference to vis\n  var vis = this;\n  \n  // update width with new parameters\n  vis.width = parseInt(d3.select('#'+vis.parentElem).style('width')) - vis.margin.left - vis.margin.right;\n  vis.height = (1/3) * vis.width;\n  \n  /*** RESIZE SVG AND MAIN GROUP ***/\n  vis.svg\n    .attr('width', vis.width + vis.margin.left + vis.margin.right)\n    .attr('height', vis.height + vis.margin.top + vis.margin.bottom);\n  vis.slider\n    .attr('transform', 'translate('+ vis.margin.left +','+ vis.margin.top +')');\n    \n  vis.topText.attr('x', vis.width/2)\n    .attr('y', -15);\n  vis.bottomText.attr('x', vis.width/2)\n    .attr('y', 25);\n  /*** UPDATE SCALE ***/\n  vis.x.range([0, vis.width]);\n  \n  /*** RESIZE DRAWING GROUPS ***/\n  vis.topSlider.attr('transform', 'translate(0,'+ Math.floor(vis.height / 4) +')');\n  vis.bottomSlider.attr('transform', 'translate(0,'+ vis.height / 4 * 3 +')');\n  \n  vis.topAxisLine\n    .attr('x0', 0)\n    .attr('x1', vis.width);\n  vis.bottomAxisLine\n    .attr('x0', 0)\n    .attr('x1', vis.width);\n  \n  vis.yearsText\n    .attr('transform', 'translate(0,'+ vis.height/2 +')');     \n    \n  vis.yearsText.selectAll('text')\n    .attr('y', function(d) { return -vis.x(d) + 4; });\n  \n  vis.questionButton.attr('x', vis.width)\n    .attr('y', vis.height + 5);\n  \n  // update visualization now that size is set\n  vis.update();\n  \n  // return vis for chaining\n  return vis;\n}\n\nYearSlider.prototype.update = function() {\n  var vis = this;\n  \n  vis.updateMarkers();\n  vis.updateText();\n}\n\nYearSlider.prototype.updateText = function() {\n  var vis = this;\n  \n  var maxYear = d3.max([vis.topYear, vis.bottomYear]);\n  var minYear = d3.min([vis.topYear, vis.bottomYear]);\n  \n  vis.yearsText.selectAll('text')\n    .attr('font-weight', function(d) {\n      return (d >= minYear && d <= maxYear) ? 'bold' : 'lighter';\n    });\n}\n\nYearSlider.prototype.updateMarkers = function() {\n  var vis = this;\n  \n  var topMarker = vis.topSlider.selectAll('circle').data([vis.topYear]);\n  // enter\n  topMarker.enter()\n    .append('circle')\n      .attr('r', vis.marker.radius)\n      .on('mouseover', function() {vis.changeMarkerColor(topMarker, vis.colors.markers.top.hover);})\n      .on('mouseout', function() {vis.changeMarkerColor(topMarker, vis.colors.markers.top.normal);})\n      .call(vis.dragTopMarker);\n  // update  \n  topMarker.transition().duration(250)\n    .attr('cx', vis.x);\n    \n  var bottomMarker = vis.bottomSlider.selectAll('circle').data([vis.bottomYear]);\n  // enter\n  bottomMarker.enter()\n    .append('circle')\n      .attr('r', vis.marker.radius)\n      .on('mouseover', function() {vis.changeMarkerColor(bottomMarker, vis.colors.markers.bottom.hover);})\n      .on('mouseout', function() {vis.changeMarkerColor(bottomMarker, vis.colors.markers.bottom.normal);})\n      .call(vis.dragBottomMarker);\n  // update\n  bottomMarker.transition().duration(250)\n    .attr('cx', vis.x);\n}\n\nYearSlider.prototype.changeMarkerColor = function(marker, color) {\n  marker.attr('fill', color);\n}\n\nYearSlider.prototype.handleResize = function(event) {\n  this.resize();\n}\n\n/***--------------------------***\n *** MARKER DRAGGING BEHAVIOR ***\n ***--------------------------***/\n \nYearSlider.prototype.topMarkerStartedDragging = function(d) {\n  this.draggingSlider = 'topSlider';\n  this.draggingYear = 'topYear';\n  this.markerStartedDragging(d);\n}\n\nYearSlider.prototype.bottomMarkerStartedDragging = function(d) {\n  this.draggingSlider = 'bottomSlider';\n  this.draggingYear = 'bottomYear';\n  this.markerStartedDragging(d);\n}\n\nYearSlider.prototype.markerStartedDragging = function(d) {\n  this[this.draggingSlider].selectAll('circle').classed('dragging', true);\n}\n\nYearSlider.prototype.markerDragged = function(d) {\n  var vis = this;\n  // redraw objects as drag moves\n  // dragging should not extend objects outside of the slider's svg\n  var x = d3.min([d3.max([d3.event.x, 0]), vis.width]);\n  vis[vis.draggingSlider].select('circle').attr('cx', x);\n  vis[vis.draggingYear] = Math.round(vis.x.invert(x));\n  vis.updateText();\n}\n\nYearSlider.prototype.markerEndedDragging = function(d) {\n  // set new year values and call update to animate transition into stopping point\n  // broadcast new year values\n  this[this.draggingSlider].selectAll('circle').classed('dragging', false);\n  this.updateMarkers();\n  this.eventHandler().broadcast({\n    name:'update', \n    options:{\n      years: [parseYear(this.topYear.toString()), parseYear(this.bottomYear.toString())]\n    }\n  });\n}\n\nYearSlider.prototype.questionClicked = function() {\n  this.eventHandler().broadcast({\n    name:'question-clicked',\n    options: {}\n  });\n}\n\n\n\n\n\n\n\n\n\n\n\n\n"],"sourceRoot":"/source/"}