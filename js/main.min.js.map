{"version":3,"sources":["main.min.js"],"names":["loadData","error","topo","deaths","income","unemployment","console","log","objects","usa","geometries","sort","a","b","id","forEach","state","years","year","death_rate","population","parseYear","median_income","dataLoaded","createVis","choropleth","Choropleth","eventHandler","handler","initVis","scatterplot","Scatterplot","yearSlider","YearSlider","updateFactor","factor","options","duration","broadcast","name","parentElem","data","this","displayData","EventHandler","listeners","Regression","xSeries","_xSeries","ySeries","_ySeries","reduceSum","prev","cur","coefficients","self","xBar","reduce","length","yBar","ssXX","map","d","Math","pow","ssYY","ssXY","i","slope","intercept","rSquare","domain","d3","min","max","factorYear","deathRateYear","regression","range","topYear","bottomYear","formatYear","time","format","parse","colors","scale","quantize","colorbrewer","Purples","d3_queue","queue","defer","json","await","select","window","on","prototype","_eventHandler","handleUpdate","handleResize","drawHighlight","removeHighlight","vis","margin","top","right","bottom","left","svg","append","classed","graph","projection","geo","albersUsa","path","resize","event","width","parseInt","style","height","attr","translate","update","wrangleData","getTime","states","selectAll","topojson","feature","features","enter","highlightState","unhighlightState","transition","filter","eventName","listener","callback","push","bind","sender","padding","x","y","title","text","scatter","bfl","linear","xAxisG","yAxisG","xAxis","axis","ticks","orient","yAxis","xTitle","yTitle","current","factorData","deathYearData","factorYearData","html","call","dots","replace","coeff","bflData","x1","y1","x2","y2","regLine","marker","radius","tick","slider","topText","bottomText","yearsText","topSlider","bottomSlider","topAxis","bottomAxis","topAxisLine","bottomAxisLine","dragTopMarker","behavior","drag","topMarkerStartedDragging","markerDragged","markerEndedDragging","dragBottomMarker","bottomMarkerStartedDragging","floor","updateMarkers","updateText","maxYear","minYear","topMarker","bottomMarker","draggingSlider","draggingYear","markerStartedDragging","round","invert","toString","handleLagDragStart","handleLagDrag","handleLagDragEnd"],"mappings":"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","file":"main.min.js","sourcesContent":["  \n// convert year strings to date objects\nvar formatYear = d3.time.format('%Y');\nvar parseYear = formatYear.parse;\n\n// universal color scale\nvar colors = d3.scale.quantize()\n  .range(colorbrewer.Purples[6]);\n    \n/***---------------------***\n *** LOAD AND PARSE DATA ***\n ***---------------------***/\n  \n// used by scatterplot and choropleth\n// function percentageDelta(years, factor) {\n//   var first = years[0],\n//       last = years[years.length - 1];\n//   var delta = (last[factor]- first[factor]) / first[factor];\n//   return delta;\n// }\n// \n// function average(years, factor) {\n//   var total = years.reduce(function(prev, current) { return prev + current[factor];}, 0);\n//   return total / years.length;\n// }\n\n// load all data before cleaning\nvar dataLoaded = false;\nd3_queue.queue()\n  .defer(d3.json, 'data/topo_usa.json')\n  .defer(d3.json, 'data/state_deaths.json')\n  .defer(d3.json, 'data/state_income.json')\n  .defer(d3.json, 'data/state_unemployment.json')\n  .await(loadData);\n  \n// globals for data\nfunction loadData(error, topo, deaths, income, unemployment) {\n  if (error) {\n    console.log(error);\n  } else {\n    topo.objects.usa.geometries.sort(function(a,b) {\n      if (a.id < b.id) return -1;\n      if (a.id > b.id) return 1;\n      return 0;\n    });\n    \n    // convert death data from strings to numbers and dates\n    deaths.forEach(function(state) {\n      state.years.forEach(function(year) {\n        year.death_rate = +year.death_rate;\n        year.deaths = +year.deaths;\n        year.population = +year.population;\n        year.year = parseYear(year.year);\n      });\n    });\n    // convert income data from strings to numbers and dates\n    income.forEach(function(state) {\n      state.years.forEach(function(year) {\n        year.median_income = +year.median_income,\n        year.year = parseYear(year.year)\n      });\n    });\n    \n    unemployment.forEach(function(state) {\n      state.years.forEach(function(year) {\n        year.unemployment = +year.unemployment;\n        year.year = parseYear(year.year);\n      })\n    })\n    // update data loading status\n    dataLoaded = true;\n    // create visualizations\n    createVis(topo, deaths, income, unemployment);\n  }\n}\n\n/***--------------------------------***\n *** DRAW AND UPDATE VISUALIZATIONS ***\n ***--------------------------------***/\n\nvar handler = new EventHandler();\nd3.select(window).on('resize', function() {handler.broadcast({name: 'resize'})});\n\n// creates and initializes all visualizations \nfunction createVis(topo, deaths, income, unemployment) {\n  \n  choropleth = new Choropleth('choropleth', topo, deaths);\n  choropleth.eventHandler(handler).initVis();\n  \n  scatterplot = new Scatterplot('scatterplot', 'median_income', deaths, income, unemployment);\n  scatterplot.eventHandler(handler).initVis();\n  \n  yearSlider = new YearSlider('year-slider', [2002, 2014]);\n  yearSlider.eventHandler(handler).initVis();\n}\n\n// updates the visualizations size within the dom\n// function resize() {\n//   choropleth.resize();\n//   scatterplot.resize();\n// }\n\n// update visualizations based on selected options\nfunction updateFactor(factor) {\n  if (dataLoaded) {\n    // build options\n    options = {\n      factor: factor,\n      duration: 1000\n    };\n    \n    handler.broadcast({ name: 'update', options: options});\n  }\n}\n\n/**\n * Creates a new choropleth\n *\n * @param parentElem  The dom element within which the visualization should be\n *                    appended\n * @param topo        The topojson data for the choropleth's map\n * @param data        The death data with which to color the map\n * @return Choropleth\n */\nfunction Choropleth(parentElem, topo, data) {\n  this.parentElem = parentElem;\n  this.topo = topo;\n  this.data = data;\n  this.displayData = {};\n  \n  this.default = {\n    duration: 1000\n  };\n}\n\n/**\n * If an event handler is specified sets the choropleth's handler and adds \n * the choropleth's listener callbacks. Returns the choropleth\n * If no event handler is specified returns the choropleth's current handler.\n *\n * @param handler The event handler to use with the choropleth\n * @return Choropleth|EventHandler\n */\nChoropleth.prototype.eventHandler = function(handler) {\n  if (handler) {\n    this._eventHandler = handler;\n    this._eventHandler.on('update', this, this.handleUpdate);\n    this._eventHandler.on('resize', this, this.handleResize);\n    this._eventHandler.on('mouseoverState', this, this.drawHighlight);\n    this._eventHandler.on('mouseoutState', this, this.removeHighlight);\n    return this;\n  }\n  \n  return this._eventHandler;\n}\n\n/**\n * Creates SVG and initializes visualization variables.\n *\n * @return Choropleth\n */\nChoropleth.prototype.initVis = function() {\n  var vis = this;\n  \n  /* ** CREATE DRAWING AREA ** */\n  vis.margin = { top: 20, right: 20, bottom: 20, left: 20 };\n  vis.svg = d3.select('#'+vis.parentElem).append('svg')\n    .classed('us-map', true);\n  vis.graph = vis.svg.append('g');\n      \n  /*** MAP DRAWING FUNCTIONS ***/\n  vis.projection = d3.geo.albersUsa();\n  vis.path = d3.geo.path()\n    .projection(vis.projection);\n    \n  vis.resize();\n  // return vis for chaining\n  return vis;\n}\n\n/**\n * Responds to resize events by calling the visualization's resize method\n */\nChoropleth.prototype.handleResize = function(event) {\n  this.resize();\n}\n\n/**\n * Resizes the visualization and redraws it within its parent element.\n *\n * @return Choropleth\n */\nChoropleth.prototype.resize = function() {\n  var vis = this;\n  \n  vis.width = parseInt(d3.select('#'+vis.parentElem).style('width')) - vis.margin.left - vis.margin.right;\n  vis.height = vis.width * .65 - vis.margin.top - vis.margin.bottom;\n  \n  vis.svg.attr('width', vis.width + vis.margin.left + vis.margin.right)\n    .attr('height', vis.height + vis.margin.top + vis.margin.bottom);\n      \n  vis.graph.attr('transform', 'translate('+ vis.margin.left +','+ vis.margin.top +')');\n    \n  vis.projection.scale(vis.width * 1.2)\n    .translate([vis.width/2, vis.height/2]);\n    \n  vis.update({ duration: 0, });\n  \n  return vis;\n}\n\n\nChoropleth.prototype.wrangleData = function(options) {\n  var deathRateYear;\n  if (!options || !options.years) {\n    deathRateYear = parseYear('2014');\n  } else {\n    deathRateYear = options.years[0];\n  }\n  \n  var vis = this;\n  // empty object to hold filtered data\n  vis.displayData = vis.data.map(function(state) {\n    // filter out years falling beyond given date range\n    return {\n      id: state.id,\n      death_rate: state.years.reduce(function(prev, year) {\n        return prev + (year.year.getTime() == deathRateYear.getTime() ? year.death_rate : 0);\n      }, 0)\n    };\n  });\n}\n\n/**\n * Handles update events by calling the visualizations update method\n */\nChoropleth.prototype.handleUpdate = function(event) {\n  this.update(event.options);\n}\n\n/**\n * Updates the visualization according to the new data year\n * Accepted Options:\n *  years:    An array of year objects where the first year corresponds with \n *            death rate data\n *  duration: The duration (in milliseconds) that transitions should last\n *\n * @param options Options for redrawing the visualization \n * @return Choropleth\n */\nChoropleth.prototype.update = function(options) {\n  var vis = this;\n  vis.wrangleData(options);\n  \n  var duration = options.duration ? options.duration : vis.default.duration;\n  // change colors domain\n  colors.domain([0, 20]);\n  \n  vis.states = vis.graph.selectAll('path')\n    .data(topojson.feature(vis.topo, vis.topo.objects.usa).features);\n  vis.states.enter()\n    .append('path')\n      .classed('state', true)\n      .attr('stroke', '#666')\n      .attr('stroke-width', 0.5)\n      .on('mouseover', function(d) { vis.highlightState(d); })\n      .on('mouseout', function(d) { vis.unhighlightState(d); });\n  vis.states.transition().duration(duration)\n    .attr('d', vis.path)\n    .attr('fill', function(d, i) { \n      return colors(vis.displayData[i].death_rate); });\n  \n  return vis;\n}\n\n/**\n * Draws a highlight around the given state and broadcasts the highlight event\n *\n * @param d The state topojson path that triggered the highlight event\n */\nChoropleth.prototype.highlightState = function(d) {\n  this.drawHighlight(d).eventHandler().broadcast({ name: 'mouseoverState', id: d.id }, this);\n}\n\n/**\n * Removes the highlight from the given state and broadcasts the unhighlight \n * event\n *\n * @param d The state topojson path that triggered the unhighlight event\n */\nChoropleth.prototype.unhighlightState = function(d) {\n  this.removeHighlight(d).eventHandler().broadcast({ name: 'mouseoutState', id: d.id }, this);\n}\n\n/**\n * Draws a red ring around the highlighted state\n *\n * @param d The path of the state being highlighted\n * @return Choropleth\n */\nChoropleth.prototype.drawHighlight = function(d) {\n  this.states.filter(function(state) { return state.id == d.id})\n    .classed('highlighted', true);\n  return this;\n}\n\n/**\n * Removes the red ring from the unhighlighted state\n *\n * @param d The path of the state having its highlight removed\n * @return Choropleth\n */\nChoropleth.prototype.removeHighlight = function(d) {\n  this.states.filter(function(state) { return state.id == d.id; })\n    .classed('highlighted', false);\n  return this;\n}\n\n\n/**\n * Creates a new EventHanlder object\n *\n * @return EventHandler\n */\nfunction EventHandler() {\n  this.listeners = {};\n}\n\n/**\n * Adds an event listener for events with the given name. Note that\n * this method does not check for uniqueness. If a listener registers\n * for an event multiple times it will receive multiple notifications\n * when the event occurs.\n *\n * @param eventName   The name of the event being listened for\n * @param listener    The object interested in listening for the event\n * @param callback    The callback for handling the event, which is passed\n *                    to the callback as the only parameter\n *\n * @return EventHandler\n */\nEventHandler.prototype.on = function(eventName, listener, callback) {\n  var listeners = this.listeners[eventName];\n  if (!listeners) {\n    listeners = [];\n  }\n  listeners.push({listener: listener, callback: callback.bind(listener)});\n  this.listeners[eventName] = listeners;\n  \n  return this;\n}\n\n/**\n * Informs all interested listeners of the occurrence of a given event. \n * If the caller provides a value for sender, the sender will not be \n * informed of the event.\n *\n * @param event   An object containing important event properties. \n *                'name' is the only required property.\n * @param sender  (Optional) The object that broadcast the event. If \n *                specified then the sender will not have any of its\n *                callbacks fired.\n *\n * @return EventHandler\n */\nEventHandler.prototype.broadcast = function(event, sender) {\n  var listeners = this.listeners[event.name];\n  if (listeners) {\n    listeners.forEach(function(listener) {\n      if (listener.listener != sender) {\n        listener.callback(event);\n      }\n    });\n  }\n  return this;\n}\n\n// code found at http://bl.ocks.org/benvandyke/8459843\nfunction Regression() {\n  this.xSeries = function(xSeries) {\n    if (!xSeries) {\n      return this._xSeries;\n    }\n    \n    this._xSeries = xSeries;\n    return this;\n  };\n  \n  this.ySeries = function(ySeries) {\n    if (!ySeries) {\n      return this._ySeries;\n    }\n    \n    this._ySeries = ySeries;\n    return this;\n  };\n  \n  this.reduceSum = function(prev, cur) {\n    return prev + cur;\n  };\n  \n  this.coefficients = function() {\n    var self = this;\n    var xBar = this._xSeries.reduce(this.reduceSum) * 1.0 / this._xSeries.length;\n    var yBar = this._ySeries.reduce(this.reduceSum) * 1.0 / this._ySeries.length;\n\n    var ssXX = this._xSeries.map(function(d) { return Math.pow(d - xBar, 2); })\n      .reduce(this.reduceSum);\n    \n    var ssYY = this._ySeries.map(function(d) { return Math.pow(d - yBar, 2); })\n      .reduce(this.reduceSum);\n      \n    var ssXY = this._xSeries.map(function(d, i) { return (d - xBar) * (self._ySeries[i] - yBar); })\n      .reduce(this.reduceSum);\n      \n    var slope = ssXY / ssXX;\n    var intercept = yBar - (xBar * slope);\n    var rSquare = Math.pow(ssXY, 2) / (ssXX * ssYY);\n    \n    return [slope, intercept, rSquare];\n  };\n}\n/**\n * Creates a new Scatterplot visualization\n *\n * @param parentElem    The ID of the DOM element within which the visualization\n *                      should be drawn.\n * @param handler       The event handler for the visualization\n * @param deaths        An array of death data sorted alphabetically by state\n * @param income        An array of income data sorted alphabetically by state\n * @param unemployment  An array of unemployment data sorted alphabetically by \n *                      state\n * @return Scatterplot\n */\nfunction Scatterplot(parentElem, factor, deaths, income, unemployment) {\n  this.parentElem = parentElem;\n  this.data = {\n    'death_rate': {\n      data: deaths,\n      name: 'Deaths Per 100,000',\n      domain: [\n        d3.min(deaths, function(d) { return d3.min(d.years, function(d) {return d.death_rate; }); }),\n        d3.max(deaths, function(d) { return d3.max(d.years, function(d) {return d.death_rate; }); })\n      ]\n    },\n    'median_income': {\n      data: income,\n      name: 'Median Income',\n      domain: [\n        d3.min(income, function(d) { return d3.min(d.years, function(d) {return d.median_income; }); }),\n        d3.max(income, function(d) { return d3.max(d.years, function(d) {return d.median_income; }); })\n      ]\n    },\n    'unemployment': {\n      data: unemployment,\n      name: 'Unemployment Rate',\n      domain: [\n        d3.min(unemployment, function(d) { return d3.min(d.years, function(d) {return d.unemployment; }); }),\n        d3.max(unemployment, function(d) { return d3.max(d.years, function(d) {return d.unemployment; }); })\n      ]\n    }\n  };\n  \n  this.factor = factor;\n  this.factorYear = parseYear('2014');\n  this.deathRateYear = parseYear('2014');\n  \n  this.displayData = {};\n  this.regression = new Regression();\n  \n  this.default = {\n    duration: 1000\n  }\n}\n\n/**\n * If a handler is specified the Scatterplot updates its event handler and \n * registers listeners for the events for which it's interested. The receiving\n * object is returned.\n * If no handler is given returns the objects current handler.\n *\n * @param handler (Optional) The event handler for the object\n * @return EventHandler|Scatterplot\n */\nScatterplot.prototype.eventHandler = function(handler) {\n  if (handler) {\n    this._eventHandler = handler;\n    this._eventHandler.on('update', this, this.handleUpdate);\n    this._eventHandler.on('resize', this, this.handleResize);\n    this._eventHandler.on('mouseoverState', this, this.drawHighlight);\n    this._eventHandler.on('mouseoutState', this, this.removeHighlight);\n  \n    return this;\n  }\n  return this._eventHandler;\n}\n\n/**\n * Initalizes the visualization by appending and sizing the containing SVG \n * before defining scales and axes. Should only be called once on a given \n * scatter plot.\n *\n * @return Scatterplot\n */\nScatterplot.prototype.initVis = function() {\n  // grab reference to self\n  var vis = this;\n  \n  /*** SVG DRAWING AREA ***/\n  vis.margin = {top: 20, right: 20, bottom: 40, left: 70};\n  vis.padding = {x: 10, y: 10};\n      \n  vis.svg = d3.select('#'+vis.parentElem).append('svg');\n  vis.graph = vis.svg.append('g');\n  \n  vis.title = vis.graph.append('text')\n    .text('What Factors Influence Drug Deaths?')\n    .attr('text-anchor', 'middle')\n    .attr('font-weight', 'bold');\n      \n  /*** CHART DATA ELEMENTS ***/\n  vis.scatter = vis.graph.append('g')\n    .classed('scatter-plot', true);\n    \n  vis.bfl = vis.graph.append('g')\n    .classed('best-fit', true);\n    \n  vis.x = d3.scale.linear();\n  vis.y = d3.scale.linear();\n    \n  /*** CHART AXES ***/\n  vis.xAxisG = vis.graph.append('g')\n    .classed('axis x-axis', true);\n    \n  vis.yAxisG = vis.graph.append('g')\n    .classed('axis y-axis', true);\n    \n  vis.xAxis = d3.svg.axis()\n    .scale(vis.x)\n    .ticks(6)\n    .orient('bottom');\n    \n  vis.yAxis = d3.svg.axis()\n    .scale(vis.y)\n    .ticks(10)\n    .orient('left');\n    \n  vis.xTitle = vis.xAxisG.append('text')\n    .classed('axis-label', true)\n    .attr('text-anchor', 'middle');\n    \n  vis.yTitle = vis.yAxisG.append('text')\n    .classed('axis-label', true)\n    .attr('transform', 'rotate(-90)')\n    .attr('text-anchor', 'middle')\n    .text('Deaths per 100,000');\n  \n  vis.resize();\n  \n  // return vis for chaining\n  return vis;\n}\n\n/**\n * Handles 'resize' events by calling the visualizations resize method. \n *\n * @param event The event object\n */\nScatterplot.prototype.handleResize = function(event) {\n  this.resize();\n}\n\n/**\n * Resizes the visualization according to its parent within the DOM. \n *\n * @return Scatterplot\n */\nScatterplot.prototype.resize = function() {\n  var vis = this;\n  \n  // grab width of current container\n  vis.width = parseInt(d3.select('#'+vis.parentElem).style('width')) - vis.margin.left - vis.margin.right;\n  vis.height = vis.width;\n    \n  // resize svg, reset margin\n  vis.svg.attr('width', vis.width + vis.margin.left + vis.margin.right)\n    .attr('height', vis.height + vis.margin.top + vis.margin.bottom);\n  vis.graph.attr('transform', 'translate('+ vis.margin.left +','+ vis.margin.top +')');\n  \n  vis.title.attr('x', vis.width/2)\n    .attr('y', 6);\n  // change scale drawing range\n  vis.x.range([vis.padding.x, vis.width-vis.padding.x]);\n  vis.y.range([vis.height-vis.padding.y, vis.padding.y]);\n  // update axis offests and title positions\n  vis.xAxisG.attr('transform', 'translate(0, '+ vis.height +')');\n  vis.xTitle.attr('x', vis.width/2)\n    .attr('y', vis.margin.bottom-2);\n  vis.yTitle.attr('x', -vis.width/2)\n    .attr('y', -vis.margin.left * (3/4) );\n  \n  // update vis with default options now that svg has been resized\n  vis.update(vis.default);\n  \n  // return vis for chaining\n  return vis;\n}\n\n/**\n * Filters the visualizations data by year according to the given options \n * Accepted Options:\n *  year: The year for which to show data on the x axis\n *\n * @param options (Optional) An object containing options for manipulating data \n * @return Scatterplot\n */\nScatterplot.prototype.wrangleData = function(options) {\n  var vis = this;\n  \n  if (!options) {\n    // create local shadow variable so shared object doesn't change\n    var options = {};\n  }\n  \n  vis.deathRateYear = options.years ? options.years[0] : vis.deathRateYear; \n  vis.factorYear = options.years ? options.years[1] : vis.factorYear;\n  vis.factor = options.factor ? options.factor : vis.factor;\n  \n  // wrangled data is placed into variable displayData\n  vis.displayData = vis.data[vis.factor].data.reduce(function(prev, current, i) {\n    // skip any national data\n    if (current.id === 'United States') {\n      return prev;\n    }\n    \n    // grab corresponding state death and factor data\n    var deaths = vis.data['death_rate'].data[i];\n    var factorData = vis.data[vis.factor].data[i];\n    \n    // get data only from specified year\n    deathYearData = deaths.years.filter(function(y) { \n      return y.year.getTime() == vis.deathRateYear.getTime(); })[0];\n    factorYearData = factorData.years.filter(function(y) {\n      return y.year.getTime() == vis.factorYear.getTime(); })[0];\n    \n    // add an object with the state's data to the array\n    prev.push({\n      id: current.id,\n      death_rate: deathYearData.death_rate,\n      factor: factorYearData[vis.factor]\n    });\n    return prev; \n  }, []);\n  \n  // return vis for chaining\n  return vis;\n}\n\n/**\n * Handles 'update' events by calling the visualizations 'update' method\n *\n * @param event The event object created by the object that fired the event\n */\nScatterplot.prototype.handleUpdate = function(event) {\n  this.update(event.options);\n}\n\n/**\n * Updates the visualization by updating display data according to the given\n * options and redrawing the scatterplot accordingly.\n * Accepted Options:\n *  year: The year to use when drawing the x axis (default is most recent)\n *  duration: The duration of any trasnitions (default is 0)\n *\n * @param options The options for updating the scatterplot.\n * @return Scatterplot\n */\nScatterplot.prototype.update = function(options) {\n  var vis = this;\n  \n  // update display data\n  vis.wrangleData(options);\n  \n  var duration = options.duration ? options.duration : vis.default.duration;\n  // update x and y domains according to new data\n  vis.x.domain(vis.data[vis.factor].domain);\n  vis.y.domain([0, 35]);\n  \n  // redraw axes\n  vis.xTitle\n    .html(vis.data[vis.factor].name +\n      ' <tspan class=\"factor\">('+ formatYear(vis.factorYear) +')</tspan>');\n    \n  vis.yTitle\n    .html(vis.data.death_rate.name +\n      ' <tspan class=\"death_rate\">('+ formatYear(vis.deathRateYear) +')</tspan>');\n  \n  \n  vis.xAxisG.transition().duration(duration)\n    .call(vis.xAxis);\n  vis.yAxisG.transition().duration(duration)\n    .call(vis.yAxis);\n  // update scatter plot dots data\n  vis.dots = vis.scatter.selectAll('circle').data(vis.displayData);\n  // draw any new dots \n  vis.dots.enter()\n    .append('circle')\n      .attr('class', function(d) { return 'dot '+d.id.replace(' ', ''); })\n      .attr('r', 5)\n      .on('mouseover', vis.highlightState.bind(vis))\n      .on('mouseout', vis.unhighlightState.bind(vis));\n  // move existing dots into new position according to display data  \n  vis.dots.transition().duration(duration)\n    .attr('cx', function(d) { return vis.x(d.factor); })\n    .attr('cy', function(d) { return vis.y(d.death_rate); })\n    .attr('fill', function(d) { return colors(d.death_rate)});\n      \n  // get variables to pass to regression calculator\n  var xSeries = vis.displayData.map(function(d) { return d.factor; });\n  var ySeries = vis.displayData.map(function(d) { return d.death_rate;});\n  var coeff = vis.regression.xSeries(xSeries)\n    .ySeries(ySeries)\n    .coefficients();\n  \n  // calculate best fit line path\n  var bflData = [{x1: vis.x.domain()[0], y1: coeff[1],\n                  x2: vis.x.domain()[1], y2: coeff[0] * vis.x.domain()[1] + coeff[1]}];\n  var regLine = vis.bfl.selectAll('line').data(bflData);\n  // append best fit line (if necessary) or redraw with new data\n  regLine.enter().append('line');\n  regLine.transition().duration(duration)\n    .attr('x1', function(d) { return vis.x(d.x1); })\n    .attr('y1', function(d) { return vis.y(d.y1); }) \n    .attr('x2', function(d) { return vis.x(d.x2); })\n    .attr('y2', function(d) { return vis.y(d.y2); });\n}\n\n/**\n * Draws a red ring around highlighted dot and increases its size\n *\n * @return Scatterplot\n */\nScatterplot.prototype.drawHighlight = function(d) {\n  this.dots.filter(function(state) { return state.id == d.id; })\n    .classed('highlighted', true)\n    .attr('r', 10);\n  // return vis for chaining\n  return this;\n}\n\n/**\n * Removes red ring around highlighted state and reduces its size back to the \n * starting amount.\n *\n * @return Scatterplot\n */\nScatterplot.prototype.removeHighlight = function(d) {\n  this.dots.filter(function(state) { return state.id == d.id; })\n    .classed('highlighted', false)\n    .attr('r', 5);\n  // return vis for chaining\n  return this;\n}\n\n/**\n * Draws highlight around selected state and broadcasts event \n *\n * @param d The dot of the state being highlighted\n */\nScatterplot.prototype.highlightState = function(d) {\n  this.drawHighlight(d).eventHandler().broadcast({ name: 'mouseoverState', id: d.id }, this);\n}\n\n/**\n * Removes highlight from deselected state and broadcasts event\n *\n * @param d The dot of the state having its highlight removed\n */\nScatterplot.prototype.unhighlightState = function(d) {\n  this.removeHighlight(d).eventHandler().broadcast({ name: 'mouseoutState', id: d.id }, this);\n}\nfunction YearSlider(parentElem, range) {\n  this.parentElem = parentElem;\n  this.range = range;\n  this.years = d3.range(range[0], range[1]+1);\n  this.topYear = range[1];\n  this.bottomYear = range[1];\n}\n\nYearSlider.prototype.eventHandler = function(handler) {\n  if (handler) {\n    this._eventHandler = handler;\n    this._eventHandler.on('resize', this, this.handleResize);\n    \n    return this;\n  }\n  \n  return this._eventHandler;\n}\n\nYearSlider.prototype.initVis = function() {\n  // grab reference to vis\n  var vis = this;\n  \n  /*** SIZES AND SVG ***/\n  vis.margin = { top: 10, right: 20, bottom: 10, left: 20};\n  vis.marker = {radius: 10};\n  vis.axis = {tick: {height: 10}};\n  \n  vis.svg = d3.select('#'+vis.parentElem).append('svg');\n  vis.slider = vis.svg.append('g');\n  \n  /*** SLIDER TEXT ***/\n  vis.topText = vis.slider.append('text')\n    .text('Death Rate')\n    .attr('text-anchor', 'middle');\n  vis.bottomText = vis.slider.append('text')\n    .text('Factor Data')\n    .attr('text-anchor', 'middle');\n  \n  /*** SCALE ***/\n  vis.x = d3.scale.linear()\n    .domain(vis.range);\n  \n  /* * DRAWING GROUPS ***/\n  vis.yearsText = vis.slider.append('g').classed('years', true);\n  \n  vis.topSlider = vis.slider.append('g').classed('slider top', true);\n  vis.bottomSlider = vis.slider.append('g').classed('slider bottom', true);\n  \n  vis.topAxis = vis.topSlider.append('g').classed('axis top-axis', true);\n  vis.bottomAxis = vis.bottomSlider.append('g').classed('axis bottom', true);\n    \n  vis.topAxisLine = vis.topAxis.append('line').attr('stroke-width', 4);\n  vis.bottomAxisLine = vis.bottomAxis.append('line').attr('stroke-width', 4);\n  \n  vis.yearsText.selectAll('text')\n    .data(vis.years).enter()\n    .append('text')\n      .text(function(d) { return d; })\n      .attr('text-anchor', 'middle')\n      .attr('transform', 'rotate(90)')\n  \n  /*** DRAG BEHAVIOR ***/\n  vis.dragTopMarker = d3.behavior.drag()\n    .on('dragstart', function(d) { vis.topMarkerStartedDragging(d); })\n    .on('drag', function(d) { vis.markerDragged(d); })\n    .on('dragend', function(d) { vis.markerEndedDragging(d); });\n  vis.dragBottomMarker = d3.behavior.drag()\n    .on('dragstart', function(d) { vis.bottomMarkerStartedDragging(d); })\n    .on('drag', function(d) { vis.markerDragged(d); })\n    .on('dragend', function(d) { vis.markerEndedDragging(d); });\n  \n  // resize within bounds\n  vis.resize();\n\n  // return vis for chaining\n  return vis;\n}\n\nYearSlider.prototype.resize = function() {\n  // grab reference to vis\n  var vis = this;\n  \n  // update width with new parameters\n  vis.width = parseInt(d3.select('#'+vis.parentElem).style('width')) - vis.margin.left - vis.margin.right;\n  vis.height = (1/3) * vis.width;\n  \n  /*** RESIZE SVG AND MAIN GROUP ***/\n  vis.svg\n    .attr('width', vis.width + vis.margin.left + vis.margin.right)\n    .attr('height', vis.height + vis.margin.top + vis.margin.bottom);\n  vis.slider\n    .attr('transform', 'translate('+ vis.margin.left +','+ vis.margin.top +')');\n    \n  vis.topText.attr('x', vis.width/2)\n    .attr('y', 10);\n  vis.bottomText.attr('x', vis.width/2)\n    .attr('y', 100);\n  /*** UPDATE SCALE ***/\n  vis.x.range([0, vis.width]);\n  \n  /*** RESIZE DRAWING GROUPS ***/\n  vis.topSlider.attr('transform', 'translate(0,'+ Math.floor(vis.height / 4) +')');\n  vis.bottomSlider.attr('transform', 'translate(0,'+ vis.height / 4 * 3 +')');\n  \n  vis.topAxisLine\n    .attr('x0', 0)\n    .attr('x1', vis.width);\n  vis.bottomAxisLine\n    .attr('x0', 0)\n    .attr('x1', vis.width);\n  \n  vis.yearsText\n    .attr('transform', 'translate(0,'+ vis.height/2 +')');     \n    \n  vis.yearsText.selectAll('text')\n    .attr('y', function(d) { return -vis.x(d) + 4; });\n  \n  // update visualization now that size is set\n  vis.update();\n  \n  // return vis for chaining\n  return vis;\n}\n\nYearSlider.prototype.update = function() {\n  var vis = this;\n  \n  vis.updateMarkers();\n  vis.updateText();\n}\n\nYearSlider.prototype.updateText = function() {\n  var vis = this;\n  \n  var maxYear = d3.max([vis.topYear, vis.bottomYear]);\n  var minYear = d3.min([vis.topYear, vis.bottomYear]);\n  \n  vis.yearsText.selectAll('text')\n    .attr('font-weight', function(d) {\n      return (d >= minYear && d <= maxYear) ? 'bold' : 'lighter';\n    });\n}\n\nYearSlider.prototype.updateMarkers = function() {\n  var vis = this;\n  \n  var topMarker = vis.topSlider.selectAll('circle').data([vis.topYear]);\n  // enter\n  topMarker.enter()\n    .append('circle')\n      .attr('fill', '#54278F')\n      .attr('r', vis.marker.radius)\n      .call(vis.dragTopMarker);\n  // update  \n  topMarker.transition().duration(250)\n    .attr('cx', vis.x);\n    \n  var bottomMarker = vis.bottomSlider.selectAll('circle').data([vis.bottomYear]);\n  // enter\n  bottomMarker.enter()\n    .append('circle')\n      .attr('fill', '#23A923')\n      .attr('r', vis.marker.radius)\n      .call(vis.dragBottomMarker);\n  // update\n  bottomMarker.transition().duration(250)\n    .attr('cx', vis.x);\n}\n\nYearSlider.prototype.handleResize = function(event) {\n  this.resize();\n}\n\n/***--------------------------***\n *** MARKER DRAGGING BEHAVIOR ***\n ***--------------------------***/\n \nYearSlider.prototype.topMarkerStartedDragging = function(d) {\n  this.draggingSlider = 'topSlider';\n  this.draggingYear = 'topYear';\n  this.markerStartedDragging(d);\n}\n\nYearSlider.prototype.bottomMarkerStartedDragging = function(d) {\n  this.draggingSlider = 'bottomSlider';\n  this.draggingYear = 'bottomYear';\n  this.markerStartedDragging(d);\n}\n\nYearSlider.prototype.markerStartedDragging = function(d) {\n  this[this.draggingSlider].selectAll('circle').classed('dragging', true);\n}\n\nYearSlider.prototype.markerDragged = function(d) {\n  var vis = this;\n  // redraw objects as drag moves\n  // dragging should not extend objects outside of the slider's svg\n  var x = d3.min([d3.max([d3.event.x, 0]), vis.width]);\n  vis[vis.draggingSlider].select('circle').attr('cx', x);\n  vis[vis.draggingYear] = Math.round(vis.x.invert(x));\n  vis.updateText();\n}\n\nYearSlider.prototype.markerEndedDragging = function(d) {\n  // set new year values and call update to animate transition into stopping point\n  // broadcast new year values\n  this[this.draggingSlider].selectAll('circle').classed('dragging', false);\n  this.updateMarkers();\n  this.eventHandler().broadcast({\n    name:'update', \n    options:{\n      years: [parseYear(this.topYear.toString()), parseYear(this.bottomYear.toString())]\n    }\n  });\n}\n\n\nYearSlider.prototype.handleLagDragStart = function(d) {\n  // set initial parameters\n}\n\nYearSlider.prototype.handleLagDrag = function(d) {\n  // redraw lag box and markers\n  // should not extend past edge of svg\n}\n\nYearSlider.prototype.handleLagDragEnd = function(d) {\n  // set new year values and animate transition to stopping point\n  // broadcast new year values\n}\n\n\n\n\n\n\n\n\n\n\n\n\n"],"sourceRoot":"/source/"}